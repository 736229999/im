
/* Result Sets Interface */
#ifndef SQL_CRSR
#  define SQL_CRSR
  struct sql_cursor
  {
    unsigned int curocn;
    void *ptr1;
    void *ptr2;
    unsigned int magic;
  };
  typedef struct sql_cursor sql_cursor;
  typedef struct sql_cursor SQL_CURSOR;
#endif /* SQL_CRSR */

/* Thread Safety */
typedef void * sql_context;
typedef void * SQL_CONTEXT;

/* Object support */
struct sqltvn
{
  unsigned char *tvnvsn; 
  unsigned short tvnvsnl; 
  unsigned char *tvnnm;
  unsigned short tvnnml; 
  unsigned char *tvnsnm;
  unsigned short tvnsnml;
};
typedef struct sqltvn sqltvn;

struct sqladts
{
  unsigned int adtvsn; 
  unsigned short adtmode; 
  unsigned short adtnum;  
  sqltvn adttvn[1];       
};
typedef struct sqladts sqladts;

static struct sqladts sqladt = {
  1,1,0,
};

/* Binding to PL/SQL Records */
struct sqltdss
{
  unsigned int tdsvsn; 
  unsigned short tdsnum; 
  unsigned char *tdsval[1]; 
};
typedef struct sqltdss sqltdss;
static struct sqltdss sqltds =
{
  1,
  0,
};

/* File name & Package Name */
struct sqlcxp
{
  unsigned short fillen;
           char  filnam[18];
};
static const struct sqlcxp sqlfpn =
{
    17,
    "./DatabaseMini.pc"
};


static unsigned int sqlctx = 6818979;


static struct sqlexd {
   unsigned long  sqlvsn;
   unsigned int   arrsiz;
   unsigned int   iters;
   unsigned int   offset;
   unsigned short selerr;
   unsigned short sqlety;
   unsigned int   occurs;
      const short *cud;
   unsigned char  *sqlest;
      const char  *stmt;
   sqladts *sqladtp;
   sqltdss *sqltdsp;
   unsigned char  **sqphsv;
   unsigned long  *sqphsl;
            int   *sqphss;
            short **sqpind;
            int   *sqpins;
   unsigned long  *sqparm;
   unsigned long  **sqparc;
   unsigned short  *sqpadto;
   unsigned short  *sqptdso;
   unsigned int   sqlcmax;
   unsigned int   sqlcmin;
   unsigned int   sqlcincr;
   unsigned int   sqlctimeout;
   unsigned int   sqlcnowait;
            int   sqfoff;
   unsigned int   sqcmod;
   unsigned int   sqfmod;
   unsigned char  *sqhstv[15];
   unsigned long  sqhstl[15];
            int   sqhsts[15];
            short *sqindv[15];
            int   sqinds[15];
   unsigned long  sqharm[15];
   unsigned long  *sqharc[15];
   unsigned short  sqadto[15];
   unsigned short  sqtdso[15];
} sqlstm = {12,15};

// Prototypes
extern "C" {
  void sqlcxt (void **, unsigned int *,
               struct sqlexd *, const struct sqlcxp *);
  void sqlcx2t(void **, unsigned int *,
               struct sqlexd *, const struct sqlcxp *);
  void sqlbuft(void **, char *);
  void sqlgs2t(void **, char *);
  void sqlorat(void **, unsigned int *, void *);
}

// Forms Interface
static const int IAPSUCC = 0;
static const int IAPFAIL = 1403;
static const int IAPFTL  = 535;
extern "C" { void sqliem(unsigned char *, signed int *); }

 static const char *sq0120 = 
"select MsgId ,SENDER ,SENDTIME ,MSGTYPE ,MSGLEN ,MSG  from IM_CLUSTERTALKMS\
G where (ClusterId=:b1 and MsgId>:b2) order by MsgId            ";

 static const char *sq0122 = 
"select MsgId ,SendTime ,MsgType ,MsgLen ,MSG  from IM_CLUSTERSYSMSG where C\
lusterId=:b1           ";

 static const char *sq0127 = 
"select Sender ,((((cast((cast(SendTime as  timestamp ) at time zone 'gmt') \
as date )-to_date('19700101 00:00:00','yyyymmdd hh24:mi:ss'))* 24)* 60)* 60) \
SendTime ,MsgType ,MsgLen ,MSG  from IM_OFFLINETALKMSG where Receiver=:b1 ord\
er by SendTime            ";

 static const char *sq0129 = 
"select Sender ,SendTime ,MsgType ,MsgLen ,MSG  from IM_OFFLINESYSMSG where \
Receiver=:b1           ";

 static const char *sq0133 = 
"select Msgid ,msg ,TO_CHAR(PubTime,'YYYY/MM/DD HH24:MI:SS')  from IM_SYSTEM\
MSG where (Msgid>:b1 and ExpireTime>=sysdate) order by MSGID            ";

 static const char *sq0142 = 
"select t1.MsgId ,t1.Receiver ,t1.Sender ,((((cast((cast(t1.SendTime as  tim\
estamp ) at time zone 'gmt') as date )-to_date('19700101 00:00:00','yyyymmdd \
hh24:mi:ss'))* 24)* 60)* 60) SendTime ,t1.MsgType ,t1.MsgLen ,t1.Msg ,t1.Send\
erName ,t1.Text  from IM_OFFLINETALKMSG t1 ,IM_USERONLINE t2 where (((t2.Serv\
erNo=:b1 and t2.status=1) and t1.Receiver=t2.UserId) and rownum<=:b2) order b\
y t1.Receiver,t1.MsgId            ";

typedef struct { unsigned short len; unsigned char arr[1]; } VARCHAR;
typedef struct { unsigned short len; unsigned char arr[1]; } varchar;

/* cud (compilation unit data) array */
static const short sqlcud0[] =
{12,4138,852,0,0,
5,0,0,0,0,0,568,104,0,0,1,1,0,1,0,3,102,0,0,
24,0,0,1,91,0,1542,108,0,0,4,4,0,0,128,3,68,0,0,3,102,0,0,3,3,0,0,3,68,0,0,1,9,
0,0,
59,0,0,0,0,0,527,117,0,0,1,1,0,1,0,1,102,0,0,
78,0,0,0,0,0,527,133,0,0,1,1,0,1,0,1,102,0,0,
97,0,0,0,0,0,590,134,0,0,1,1,0,1,0,3,102,0,0,
116,0,0,0,0,0,525,141,0,0,4,1,0,1,0,1,102,0,0,2,3,0,0,2,3,0,0,2,9,0,0,
147,0,0,0,0,0,527,168,0,0,1,1,0,1,0,1,102,0,0,
166,0,0,0,0,0,590,169,0,0,1,1,0,1,0,3,102,0,0,
185,0,0,2,233,0,1542,216,0,0,14,14,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,
3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,3,9,0,0,3,9,0,0,3,9,0,0,
3,68,0,0,1,9,0,0,
260,0,0,3,128,0,1542,272,0,0,7,7,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,3,
68,0,0,3,9,0,0,3,3,0,0,1,9,0,0,
307,0,0,4,103,0,1542,323,0,0,5,5,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,3,
3,0,0,1,9,0,0,
346,0,0,0,0,0,568,378,0,0,1,1,0,1,0,3,102,0,0,
365,0,0,5,94,0,1542,379,0,0,4,4,0,0,128,3,68,0,0,3,68,0,0,3,102,0,0,3,3,0,0,1,
9,0,0,
400,0,0,0,0,0,527,388,0,0,1,1,0,1,0,1,102,0,0,
419,0,0,0,0,0,527,403,0,0,1,1,0,1,0,1,102,0,0,
438,0,0,0,0,0,590,404,0,0,1,1,0,1,0,3,102,0,0,
457,0,0,0,0,0,525,410,0,0,6,1,0,1,0,1,102,0,0,2,68,0,0,2,68,0,0,2,9,0,0,2,9,0,
0,2,9,0,0,
496,0,0,0,0,0,527,439,0,0,1,1,0,1,0,1,102,0,0,
515,0,0,0,0,0,590,440,0,0,1,1,0,1,0,3,102,0,0,
534,0,0,0,0,0,568,476,0,0,1,1,0,1,0,3,102,0,0,
553,0,0,6,111,0,1542,477,0,0,7,7,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,3,
68,0,0,3,102,0,0,3,3,0,0,1,9,0,0,
600,0,0,0,0,0,527,486,0,0,1,1,0,1,0,1,102,0,0,
619,0,0,0,0,0,527,501,0,0,1,1,0,1,0,1,102,0,0,
638,0,0,0,0,0,590,502,0,0,1,1,0,1,0,3,102,0,0,
657,0,0,0,0,0,525,508,0,0,10,1,0,1,0,1,102,0,0,2,68,0,0,2,68,0,0,2,68,0,0,2,68,
0,0,2,68,0,0,2,9,0,0,2,9,0,0,2,9,0,0,2,68,0,0,
712,0,0,0,0,0,527,545,0,0,1,1,0,1,0,1,102,0,0,
731,0,0,0,0,0,590,546,0,0,1,1,0,1,0,3,102,0,0,
750,0,0,0,0,0,568,593,0,0,1,1,0,1,0,3,102,0,0,
769,0,0,7,124,0,1542,594,0,0,7,7,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,0,3,
9,0,0,3,102,0,0,3,3,0,0,1,9,0,0,
816,0,0,0,0,0,527,603,0,0,1,1,0,1,0,1,102,0,0,
835,0,0,0,0,0,527,618,0,0,1,1,0,1,0,1,102,0,0,
854,0,0,0,0,0,590,619,0,0,1,1,0,1,0,3,102,0,0,
873,0,0,0,0,0,525,625,0,0,10,1,0,1,0,1,102,0,0,2,68,0,0,2,68,0,0,2,68,0,0,2,68,
0,0,2,68,0,0,2,9,0,0,2,9,0,0,2,9,0,0,2,68,0,0,
928,0,0,0,0,0,527,662,0,0,1,1,0,1,0,1,102,0,0,
947,0,0,0,0,0,590,663,0,0,1,1,0,1,0,3,102,0,0,
966,0,0,8,97,0,1542,703,0,0,4,4,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,3,0,0,1,9,
0,0,
1001,0,0,0,0,0,1605,788,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1024,0,0,9,63,0,1540,790,0,0,1,0,0,0,128,2,68,0,0,1,9,0,0,
1047,0,0,10,145,0,1539,791,0,0,6,6,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,68,0,0,
1,3,0,0,1,3,0,0,1,9,0,0,
1090,0,0,11,0,0,1567,810,0,0,0,0,0,0,128,1,9,0,0,
1109,0,0,0,0,0,1613,811,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1132,0,0,12,0,0,1565,815,0,0,0,0,0,0,128,1,9,0,0,
1151,0,0,13,70,0,1540,817,0,0,2,1,0,0,128,2,113,0,0,1,68,0,0,1,9,0,0,
1178,0,0,14,0,0,1567,837,0,0,0,0,0,0,128,1,9,0,0,
1197,0,0,0,0,0,1613,838,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1220,0,0,0,0,0,1648,845,0,0,5,5,0,0,128,3,3,0,0,1,95,0,0,1,3,0,0,3,113,0,0,1,
68,0,0,1,9,0,0,
1259,0,0,15,0,0,1567,865,0,0,0,0,0,0,128,1,9,0,0,
1278,0,0,0,0,0,1613,866,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1301,0,0,16,52,0,1541,872,0,0,2,2,0,0,128,1,113,0,0,1,68,0,0,1,9,0,0,
1328,0,0,17,0,0,1567,891,0,0,0,0,0,0,128,1,9,0,0,
1347,0,0,0,0,0,1613,892,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1370,0,0,18,0,0,1565,896,0,0,0,0,0,0,128,1,9,0,0,
1389,0,0,0,0,0,1613,897,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1412,0,0,19,0,0,1565,898,0,0,0,0,0,0,128,1,9,0,0,
1431,0,0,0,0,0,1605,969,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1454,0,0,20,71,0,1540,972,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
1481,0,0,0,0,0,1613,991,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1504,0,0,21,106,0,1538,1000,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
1527,0,0,0,0,0,1613,1018,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1550,0,0,22,0,0,1567,1019,0,0,0,0,0,0,128,1,9,0,0,
1569,0,0,23,0,0,1565,1022,0,0,0,0,0,0,128,1,9,0,0,
1588,0,0,24,59,0,1540,1025,0,0,2,1,0,0,128,2,9,0,0,1,68,0,0,1,9,0,0,
1615,0,0,25,59,0,1540,1026,0,0,2,1,0,0,128,2,9,0,0,1,68,0,0,1,9,0,0,
1642,0,0,26,64,0,1540,1027,0,0,1,0,0,0,128,2,68,0,0,1,9,0,0,
1665,0,0,27,195,0,1539,1029,0,0,10,10,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,68,
0,0,1,3,0,0,1,3,0,0,1,68,0,0,1,9,0,0,1,9,0,0,1,9,0,0,1,9,0,0,
1724,0,0,0,0,0,1613,1050,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1747,0,0,28,0,0,1567,1051,0,0,0,0,0,0,128,1,9,0,0,
1766,0,0,29,0,0,1565,1054,0,0,0,0,0,0,128,1,9,0,0,
1785,0,0,30,71,0,1540,1056,0,0,2,1,0,0,128,2,113,0,0,1,68,0,0,1,9,0,0,
1812,0,0,0,0,0,1613,1075,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1835,0,0,31,0,0,1567,1076,0,0,0,0,0,0,128,1,9,0,0,
1854,0,0,32,70,0,1540,1082,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
1881,0,0,0,0,0,1613,1101,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1904,0,0,33,104,0,1538,1106,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
1927,0,0,0,0,0,1613,1124,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
1950,0,0,34,0,0,1567,1125,0,0,0,0,0,0,128,1,9,0,0,
1969,0,0,35,0,0,1565,1128,0,0,0,0,0,0,128,1,9,0,0,
1988,0,0,36,63,0,1540,1131,0,0,1,0,0,0,128,2,68,0,0,1,9,0,0,
2011,0,0,37,148,0,1539,1133,0,0,8,8,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,68,0,
0,1,3,0,0,1,68,0,0,1,3,0,0,1,68,0,0,1,9,0,0,
2062,0,0,0,0,0,1613,1152,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2085,0,0,38,0,0,1567,1153,0,0,0,0,0,0,128,1,9,0,0,
2104,0,0,39,0,0,1565,1156,0,0,0,0,0,0,128,1,9,0,0,
2123,0,0,40,70,0,1540,1158,0,0,2,1,0,0,128,2,113,0,0,1,68,0,0,1,9,0,0,
2150,0,0,0,0,0,1613,1177,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2173,0,0,41,0,0,1567,1178,0,0,0,0,0,0,128,1,9,0,0,
2192,0,0,0,0,0,1648,1186,0,0,5,5,0,0,128,3,68,0,0,1,95,0,0,1,68,0,0,3,113,0,0,
1,68,0,0,1,9,0,0,
2231,0,0,0,0,0,1613,1205,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2254,0,0,42,0,0,1567,1206,0,0,0,0,0,0,128,1,9,0,0,
2273,0,0,43,53,0,1541,1214,0,0,2,2,0,0,128,1,113,0,0,1,68,0,0,1,9,0,0,
2300,0,0,0,0,0,1613,1233,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2323,0,0,44,0,0,1567,1234,0,0,0,0,0,0,128,1,9,0,0,
2342,0,0,45,0,0,1565,1237,0,0,0,0,0,0,128,1,9,0,0,
2361,0,0,46,52,0,1541,1241,0,0,2,2,0,0,128,1,113,0,0,1,68,0,0,1,9,0,0,
2388,0,0,0,0,0,1613,1260,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2411,0,0,47,0,0,1567,1261,0,0,0,0,0,0,128,1,9,0,0,
2430,0,0,48,0,0,1565,1266,0,0,0,0,0,0,128,1,9,0,0,
2449,0,0,0,0,0,1613,1267,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2472,0,0,49,0,0,1565,1268,0,0,0,0,0,0,128,1,9,0,0,
2491,0,0,50,72,0,1542,1304,0,0,2,2,0,0,128,3,68,0,0,3,3,0,0,1,9,0,0,
2518,0,0,51,90,0,1542,1356,0,0,3,3,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
2549,0,0,0,0,0,1605,1438,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2572,0,0,52,72,0,1540,1439,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
2599,0,0,0,0,0,1613,1458,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2622,0,0,53,70,0,1540,1465,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
2649,0,0,0,0,0,1613,1470,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2672,0,0,54,70,0,1540,1476,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
2699,0,0,0,0,0,1613,1481,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2722,0,0,55,150,0,1539,1489,0,0,8,8,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,68,0,
0,1,3,0,0,1,3,0,0,1,3,0,0,1,3,0,0,1,9,0,0,
2773,0,0,56,0,0,1567,1508,0,0,0,0,0,0,128,1,9,0,0,
2792,0,0,0,0,0,1613,1509,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2815,0,0,57,0,0,1565,1512,0,0,0,0,0,0,128,1,9,0,0,
2834,0,0,58,161,0,1541,1516,0,0,9,9,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,3,0,0,
1,3,0,0,1,3,0,0,1,3,0,0,1,68,0,0,1,68,0,0,1,9,0,0,
2889,0,0,59,0,0,1567,1536,0,0,0,0,0,0,128,1,9,0,0,
2908,0,0,0,0,0,1613,1537,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
2931,0,0,60,0,0,1565,1540,0,0,0,0,0,0,128,1,9,0,0,
2950,0,0,61,91,0,1540,1544,0,0,3,2,0,0,128,2,113,0,0,1,68,0,0,1,68,0,0,1,9,0,0,
2981,0,0,62,0,0,1567,1563,0,0,0,0,0,0,128,1,9,0,0,
3000,0,0,0,0,0,1613,1564,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
3023,0,0,63,0,0,1567,1567,0,0,0,0,0,0,128,1,9,0,0,
3042,0,0,64,143,0,1538,1568,0,0,0,0,0,0,128,1,9,0,0,
3061,0,0,65,91,0,1540,1570,0,0,3,2,0,0,128,2,113,0,0,1,68,0,0,1,68,0,0,1,9,0,0,
3092,0,0,0,0,0,1648,1580,0,0,5,5,0,0,128,3,3,0,0,1,95,0,0,1,3,0,0,3,113,0,0,1,
68,0,0,1,9,0,0,
3131,0,0,66,0,0,1567,1599,0,0,0,0,0,0,128,1,9,0,0,
3150,0,0,0,0,0,1613,1600,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
3173,0,0,67,73,0,1541,1607,0,0,3,3,0,0,128,1,113,0,0,1,68,0,0,1,68,0,0,1,9,0,0,
3204,0,0,68,0,0,1567,1626,0,0,0,0,0,0,128,1,9,0,0,
3223,0,0,0,0,0,1613,1627,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
3246,0,0,69,0,0,1565,1631,0,0,0,0,0,0,128,1,9,0,0,
3265,0,0,0,0,0,1613,1632,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
3288,0,0,70,0,0,1565,1633,0,0,0,0,0,0,128,1,9,0,0,
3307,0,0,71,83,0,1542,1660,0,0,3,3,0,0,128,3,68,0,0,3,4,0,0,3,3,0,0,1,9,0,0,
3338,0,0,72,97,0,1542,1735,0,0,5,5,0,0,128,3,68,0,0,3,3,0,0,3,9,0,0,3,3,0,0,3,
3,0,0,1,9,0,0,
3377,0,0,73,92,0,1542,1802,0,0,4,4,0,0,128,3,68,0,0,3,9,0,0,3,9,0,0,3,3,0,0,1,
9,0,0,
3412,0,0,74,108,0,1542,1871,0,0,5,5,0,0,128,3,68,0,0,3,9,0,0,3,9,0,0,3,9,0,0,3,
3,0,0,1,9,0,0,
3451,0,0,75,105,0,1542,1935,0,0,5,5,0,0,128,3,68,0,0,3,9,0,0,3,9,0,0,3,9,0,0,3,
3,0,0,1,9,0,0,
3490,0,0,76,97,0,1542,2007,0,0,5,5,0,0,128,3,68,0,0,3,9,0,0,3,9,0,0,3,68,0,0,3,
3,0,0,1,9,0,0,
3529,0,0,0,0,0,568,2075,0,0,1,1,0,1,0,3,102,0,0,
3548,0,0,77,145,0,1542,2076,0,0,9,9,0,0,128,3,68,0,0,3,9,0,0,3,9,0,0,3,68,0,0,
3,68,0,0,3,68,0,0,3,68,0,0,3,102,0,0,3,3,0,0,1,9,0,0,
3603,0,0,0,0,0,527,2085,0,0,1,1,0,1,0,1,102,0,0,
3622,0,0,0,0,0,527,2101,0,0,1,1,0,1,0,1,102,0,0,
3641,0,0,0,0,0,590,2102,0,0,1,1,0,1,0,3,102,0,0,
3660,0,0,0,0,0,525,2108,0,0,5,1,0,1,0,1,102,0,0,2,9,0,0,2,9,0,0,2,9,0,0,2,9,0,
0,
3695,0,0,0,0,0,527,2137,0,0,1,1,0,1,0,1,102,0,0,
3714,0,0,0,0,0,590,2138,0,0,1,1,0,1,0,3,102,0,0,
3733,0,0,78,91,0,1542,2170,0,0,4,4,0,0,128,3,68,0,0,3,3,0,0,3,9,0,0,3,3,0,0,1,
9,0,0,
3768,0,0,79,74,0,1542,2225,0,0,3,3,0,0,128,3,68,0,0,3,3,0,0,3,3,0,0,1,9,0,0,
3799,0,0,80,108,0,1542,2291,0,0,5,5,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,3,3,0,0,
3,3,0,0,1,9,0,0,
3838,0,0,81,70,0,1542,2344,0,0,2,2,0,0,128,3,68,0,0,3,3,0,0,1,9,0,0,
3865,0,0,82,73,0,1542,2395,0,0,2,2,0,0,128,3,3,0,0,3,3,0,0,1,9,0,0,
3892,0,0,83,97,0,1542,2455,0,0,4,4,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,3,3,0,0,1,
9,0,0,
3927,0,0,84,83,0,1542,2523,0,0,3,3,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
3958,0,0,85,87,0,1542,2575,0,0,3,3,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
3989,0,0,86,0,0,1565,2600,0,0,0,0,0,0,128,1,9,0,0,
4008,0,0,87,89,0,1542,2630,0,0,3,3,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
4039,0,0,88,0,0,1565,2654,0,0,0,0,0,0,128,1,9,0,0,
4058,0,0,89,98,0,1540,2696,0,0,4,1,0,0,128,2,68,0,0,2,3,0,0,2,4,0,0,1,68,0,0,1,
9,0,0,
4093,0,0,90,156,0,1539,2724,0,0,6,6,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,4,0,0,
1,3,0,0,1,4,0,0,1,9,0,0,
4136,0,0,91,0,0,1565,2747,0,0,0,0,0,0,128,1,9,0,0,
4155,0,0,92,129,0,1539,2752,0,0,5,5,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,4,0,0,
1,4,0,0,1,9,0,0,
4194,0,0,93,0,0,1565,2760,0,0,0,0,0,0,128,1,9,0,0,
4213,0,0,94,209,0,1541,2785,0,0,6,6,0,0,128,1,68,0,0,1,68,0,0,1,4,0,0,1,3,0,0,
1,4,0,0,1,68,0,0,1,9,0,0,
4256,0,0,95,0,0,1565,2794,0,0,0,0,0,0,128,1,9,0,0,
4275,0,0,96,181,0,1541,2799,0,0,5,5,0,0,128,1,68,0,0,1,68,0,0,1,4,0,0,1,4,0,0,
1,68,0,0,1,9,0,0,
4314,0,0,97,0,0,1565,2807,0,0,0,0,0,0,128,1,9,0,0,
4333,0,0,98,169,0,1541,2812,0,0,5,5,0,0,128,1,68,0,0,1,68,0,0,1,4,0,0,1,4,0,0,
1,68,0,0,1,9,0,0,
4372,0,0,99,0,0,1565,2820,0,0,0,0,0,0,128,1,9,0,0,
4391,0,0,100,193,0,1541,2831,0,0,6,6,0,0,128,1,68,0,0,1,68,0,0,1,4,0,0,1,3,0,0,
1,4,0,0,1,68,0,0,1,9,0,0,
4434,0,0,101,0,0,1565,2840,0,0,0,0,0,0,128,1,9,0,0,
4453,0,0,102,165,0,1541,2845,0,0,5,5,0,0,128,1,68,0,0,1,68,0,0,1,4,0,0,1,4,0,0,
1,68,0,0,1,9,0,0,
4492,0,0,103,0,0,1565,2853,0,0,0,0,0,0,128,1,9,0,0,
4511,0,0,104,68,0,1541,2873,0,0,2,2,0,0,128,1,3,0,0,1,68,0,0,1,9,0,0,
4538,0,0,105,0,0,1565,2880,0,0,0,0,0,0,128,1,9,0,0,
4557,0,0,106,68,0,1541,2886,0,0,2,2,0,0,128,1,3,0,0,1,68,0,0,1,9,0,0,
4584,0,0,107,0,0,1565,2893,0,0,0,0,0,0,128,1,9,0,0,
4603,0,0,108,68,0,1541,2907,0,0,2,2,0,0,128,1,3,0,0,1,68,0,0,1,9,0,0,
4630,0,0,109,0,0,1565,2914,0,0,0,0,0,0,128,1,9,0,0,
4649,0,0,110,68,0,1541,2928,0,0,2,2,0,0,128,1,3,0,0,1,68,0,0,1,9,0,0,
4676,0,0,111,0,0,1565,2935,0,0,0,0,0,0,128,1,9,0,0,
4695,0,0,112,193,0,1541,2942,0,0,6,6,0,0,128,1,68,0,0,1,68,0,0,1,4,0,0,1,3,0,0,
1,4,0,0,1,68,0,0,1,9,0,0,
4738,0,0,113,0,0,1565,2951,0,0,0,0,0,0,128,1,9,0,0,
4757,0,0,114,165,0,1541,2956,0,0,5,5,0,0,128,1,68,0,0,1,68,0,0,1,4,0,0,1,4,0,0,
1,68,0,0,1,9,0,0,
4796,0,0,115,0,0,1565,2964,0,0,0,0,0,0,128,1,9,0,0,
4815,0,0,116,99,0,1542,2994,0,0,4,4,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,3,0,0,
1,9,0,0,
4850,0,0,117,94,0,1542,3043,0,0,4,4,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,3,0,0,
1,9,0,0,
4885,0,0,118,71,0,1542,3095,0,0,2,2,0,0,128,3,68,0,0,3,3,0,0,1,9,0,0,
4912,0,0,119,88,0,1540,3153,0,0,3,2,0,0,128,2,68,0,0,1,68,0,0,1,68,0,0,1,9,0,0,
4943,0,0,120,139,0,1545,3183,0,0,2,2,0,0,128,1,68,0,0,1,68,0,0,1,9,0,0,
4970,0,0,120,0,0,1551,3187,0,0,0,0,0,0,128,1,9,0,0,
4989,0,0,120,0,0,1551,3203,0,0,0,0,0,0,128,1,9,0,0,
5008,0,0,0,0,0,1605,3207,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5031,0,0,120,0,0,1551,3211,0,0,0,0,0,0,128,1,9,0,0,
5050,0,0,0,0,0,1613,3226,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5073,0,0,120,0,0,1551,3227,0,0,0,0,0,0,128,1,9,0,0,
5092,0,0,120,0,0,1549,3241,0,0,6,0,0,0,128,2,68,0,0,2,68,0,0,2,68,0,0,2,3,0,0,
2,68,0,0,2,113,0,0,1,9,0,0,
5135,0,0,120,0,0,1551,3245,0,0,0,0,0,0,128,1,9,0,0,
5154,0,0,0,0,0,1613,3262,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5177,0,0,120,0,0,1551,3263,0,0,0,0,0,0,128,1,9,0,0,
5196,0,0,0,0,0,1646,3278,0,0,5,5,0,0,128,3,68,0,0,1,113,0,0,1,68,0,0,3,95,0,0,
1,68,0,0,1,9,0,0,
5235,0,0,0,0,0,1613,3288,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5258,0,0,120,0,0,1551,3289,0,0,0,0,0,0,128,1,9,0,0,
5277,0,0,121,71,0,1540,3324,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
5304,0,0,122,98,0,1545,3353,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
5327,0,0,122,0,0,1551,3357,0,0,0,0,0,0,128,1,9,0,0,
5346,0,0,122,0,0,1551,3372,0,0,0,0,0,0,128,1,9,0,0,
5365,0,0,0,0,0,1605,3376,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5388,0,0,122,0,0,1551,3380,0,0,0,0,0,0,128,1,9,0,0,
5407,0,0,0,0,0,1613,3396,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5430,0,0,122,0,0,1551,3397,0,0,0,0,0,0,128,1,9,0,0,
5449,0,0,122,0,0,1549,3410,0,0,5,0,0,0,128,2,68,0,0,2,68,0,0,2,3,0,0,2,68,0,0,
2,113,0,0,1,9,0,0,
5488,0,0,122,0,0,1551,3414,0,0,0,0,0,0,128,1,9,0,0,
5507,0,0,0,0,0,1613,3430,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5530,0,0,122,0,0,1551,3432,0,0,0,0,0,0,128,1,9,0,0,
5549,0,0,123,50,0,1538,3435,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
5572,0,0,124,0,0,1565,3436,0,0,0,0,0,0,128,1,9,0,0,
5591,0,0,0,0,0,1646,3449,0,0,5,5,0,0,128,3,68,0,0,1,113,0,0,1,68,0,0,3,95,0,0,
1,68,0,0,1,9,0,0,
5630,0,0,125,50,0,1538,3457,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
5653,0,0,0,0,0,1613,3460,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5676,0,0,122,0,0,1551,3461,0,0,0,0,0,0,128,1,9,0,0,
5695,0,0,126,72,0,1540,3497,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
5722,0,0,127,255,0,1545,3527,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
5745,0,0,122,0,0,1551,3531,0,0,0,0,0,0,128,1,9,0,0,
5764,0,0,122,0,0,1551,3546,0,0,0,0,0,0,128,1,9,0,0,
5783,0,0,0,0,0,1605,3550,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5806,0,0,122,0,0,1551,3554,0,0,0,0,0,0,128,1,9,0,0,
5825,0,0,0,0,0,1613,3569,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5848,0,0,122,0,0,1551,3570,0,0,0,0,0,0,128,1,9,0,0,
5867,0,0,127,0,0,1549,3585,0,0,5,0,0,0,128,2,68,0,0,2,68,0,0,2,3,0,0,2,68,0,0,
2,113,0,0,1,9,0,0,
5906,0,0,127,0,0,1551,3589,0,0,0,0,0,0,128,1,9,0,0,
5925,0,0,0,0,0,1613,3605,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
5948,0,0,127,0,0,1551,3606,0,0,0,0,0,0,128,1,9,0,0,
5967,0,0,0,0,0,1646,3619,0,0,5,5,0,0,128,3,68,0,0,1,113,0,0,1,68,0,0,3,95,0,0,
1,68,0,0,1,9,0,0,
6006,0,0,0,0,0,1613,3628,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6029,0,0,127,0,0,1551,3629,0,0,0,0,0,0,128,1,9,0,0,
6048,0,0,128,71,0,1540,3666,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
6075,0,0,129,98,0,1545,3694,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
6098,0,0,122,0,0,1551,3698,0,0,0,0,0,0,128,1,9,0,0,
6117,0,0,122,0,0,1551,3713,0,0,0,0,0,0,128,1,9,0,0,
6136,0,0,0,0,0,1605,3717,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6159,0,0,122,0,0,1551,3721,0,0,0,0,0,0,128,1,9,0,0,
6178,0,0,0,0,0,1613,3737,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6201,0,0,122,0,0,1551,3738,0,0,0,0,0,0,128,1,9,0,0,
6220,0,0,129,0,0,1549,3752,0,0,5,0,0,0,128,2,68,0,0,2,68,0,0,2,3,0,0,2,68,0,0,
2,113,0,0,1,9,0,0,
6259,0,0,129,0,0,1551,3757,0,0,0,0,0,0,128,1,9,0,0,
6278,0,0,0,0,0,1613,3773,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6301,0,0,129,0,0,1551,3774,0,0,0,0,0,0,128,1,9,0,0,
6320,0,0,0,0,0,1646,3787,0,0,5,5,0,0,128,3,68,0,0,1,113,0,0,1,68,0,0,3,95,0,0,
1,68,0,0,1,9,0,0,
6359,0,0,0,0,0,1613,3795,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6382,0,0,129,0,0,1551,3796,0,0,0,0,0,0,128,1,9,0,0,
6401,0,0,130,56,0,1540,3832,0,0,2,1,0,0,128,2,68,0,0,1,68,0,0,1,9,0,0,
6428,0,0,131,90,0,1539,3860,0,0,4,4,0,0,128,1,68,0,0,1,68,0,0,1,68,0,0,1,68,0,
0,1,9,0,0,
6463,0,0,132,0,0,1565,3881,0,0,0,0,0,0,128,1,9,0,0,
6482,0,0,133,147,0,1545,3887,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
6505,0,0,133,0,0,1549,3891,0,0,3,0,0,0,128,2,68,0,0,2,9,0,0,2,9,0,0,1,9,0,0,
6536,0,0,133,0,0,1551,3895,0,0,0,0,0,0,128,1,9,0,0,
6555,0,0,134,50,0,1541,3898,0,0,2,2,0,0,128,1,68,0,0,1,68,0,0,1,9,0,0,
6582,0,0,135,0,0,1565,3899,0,0,0,0,0,0,128,1,9,0,0,
6601,0,0,133,0,0,1551,3907,0,0,0,0,0,0,128,1,9,0,0,
6620,0,0,133,0,0,1551,3929,0,0,0,0,0,0,128,1,9,0,0,
6639,0,0,136,71,0,1542,3954,0,0,2,2,0,0,128,3,68,0,0,3,3,0,0,1,9,0,0,
6666,0,0,0,0,0,1605,4035,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6689,0,0,0,0,0,1648,4041,0,0,5,5,0,0,128,3,3,0,0,1,95,0,0,1,3,0,0,3,113,0,0,1,
68,0,0,1,9,0,0,
6728,0,0,137,0,0,1567,4060,0,0,0,0,0,0,128,1,9,0,0,
6747,0,0,0,0,0,1613,4061,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6770,0,0,138,145,0,1542,4068,0,0,8,8,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,
0,3,3,0,0,3,3,0,0,3,113,0,0,3,3,0,0,1,9,0,0,
6821,0,0,0,0,0,1613,4074,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6844,0,0,139,0,0,1565,4075,0,0,0,0,0,0,128,1,9,0,0,
6863,0,0,140,87,0,1542,4103,0,0,4,4,0,0,128,3,68,0,0,3,3,0,0,3,68,0,0,3,3,0,0,
1,9,0,0,
6898,0,0,141,154,0,1542,4149,0,0,8,8,0,0,128,3,68,0,0,3,68,0,0,3,68,0,0,3,68,0,
0,3,68,0,0,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
6949,0,0,0,0,0,1605,4214,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
6972,0,0,142,417,0,1545,4226,0,0,2,2,0,0,128,1,3,0,0,1,68,0,0,1,9,0,0,
6999,0,0,142,0,0,1551,4231,0,0,0,0,0,0,128,1,9,0,0,
7018,0,0,142,0,0,1551,4246,0,0,0,0,0,0,128,1,9,0,0,
7037,0,0,142,0,0,1551,4253,0,0,0,0,0,0,128,1,9,0,0,
7056,0,0,0,0,0,1613,4268,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
7079,0,0,142,0,0,1551,4269,0,0,0,0,0,0,128,1,9,0,0,
7098,0,0,142,0,0,1549,4287,0,0,9,0,0,0,128,2,68,0,0,2,68,0,0,2,68,0,0,2,68,0,0,
2,3,0,0,2,68,0,0,2,113,0,0,2,9,0,0,2,9,0,0,1,9,0,0,
7153,0,0,0,0,0,1613,4295,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
7176,0,0,142,0,0,1551,4296,0,0,0,0,0,0,128,1,9,0,0,
7195,0,0,143,0,0,1565,4298,0,0,0,0,0,0,128,1,9,0,0,
7214,0,0,0,0,0,1646,4314,0,0,5,5,0,0,128,3,68,0,0,1,113,0,0,1,68,0,0,3,95,0,0,
1,68,0,0,1,9,0,0,
7253,0,0,144,306,0,1539,4322,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
7276,0,0,145,47,0,1538,4330,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
7299,0,0,146,51,0,1541,4334,0,0,1,1,0,0,128,1,68,0,0,1,9,0,0,
7322,0,0,0,0,0,1613,4338,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
7345,0,0,142,0,0,1551,4339,0,0,0,0,0,0,128,1,9,0,0,
7364,0,0,0,0,0,1613,4345,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
7387,0,0,142,0,0,1551,4346,0,0,0,0,0,0,128,1,9,0,0,
7406,0,0,147,0,0,1565,4348,0,0,0,0,0,0,128,1,9,0,0,
7425,0,0,148,72,0,1542,4388,0,0,3,3,0,0,128,3,68,0,0,3,9,0,0,3,3,0,0,1,9,0,0,
7456,0,0,149,152,0,1542,4450,0,0,7,7,0,0,128,3,9,0,0,3,3,0,0,3,3,0,0,3,9,0,0,3,
68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
7503,0,0,150,166,0,1542,4530,0,0,8,8,0,0,128,3,3,0,0,3,9,0,0,3,9,0,0,3,9,0,0,3,
68,0,0,3,68,0,0,3,3,0,0,3,3,0,0,1,9,0,0,
7554,0,0,151,88,0,1542,4585,0,0,3,3,0,0,128,3,9,0,0,3,3,0,0,3,3,0,0,1,9,0,0,
7585,0,0,0,0,0,568,4640,0,0,1,1,0,1,0,3,102,0,0,
7604,0,0,152,76,0,1542,4646,0,0,2,2,0,0,128,3,102,0,0,3,3,0,0,1,9,0,0,
7631,0,0,0,0,0,527,4655,0,0,1,1,0,1,0,1,102,0,0,
7650,0,0,0,0,0,527,4671,0,0,1,1,0,1,0,1,102,0,0,
7669,0,0,0,0,0,590,4672,0,0,1,1,0,1,0,3,102,0,0,
7688,0,0,0,0,0,525,4679,0,0,4,1,0,1,0,1,102,0,0,2,9,0,0,2,68,0,0,2,68,0,0,
7719,0,0,0,0,0,527,4708,0,0,1,1,0,1,0,1,102,0,0,
7738,0,0,0,0,0,590,4709,0,0,1,1,0,1,0,3,102,0,0,
7757,0,0,0,0,0,568,4759,0,0,1,1,0,1,0,3,102,0,0,
7776,0,0,153,157,0,1542,4766,0,0,8,8,0,0,128,3,102,0,0,3,9,0,0,3,9,0,0,3,9,0,0,
3,3,0,0,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
7827,0,0,0,0,0,527,4775,0,0,1,1,0,1,0,1,102,0,0,
7846,0,0,0,0,0,527,4791,0,0,1,1,0,1,0,1,102,0,0,
7865,0,0,0,0,0,590,4792,0,0,1,1,0,1,0,3,102,0,0,
7884,0,0,0,0,0,525,4800,0,0,8,1,0,1,0,1,102,0,0,2,9,0,0,2,3,0,0,2,9,0,0,2,68,0,
0,2,9,0,0,2,3,0,0,2,3,0,0,
7931,0,0,0,0,0,527,4844,0,0,1,1,0,1,0,1,102,0,0,
7950,0,0,0,0,0,590,4845,0,0,1,1,0,1,0,3,102,0,0,
7969,0,0,0,0,0,568,4874,0,0,1,1,0,1,0,3,102,0,0,
7988,0,0,154,87,0,1542,4875,0,0,3,3,0,0,128,3,68,0,0,3,102,0,0,3,3,0,0,1,9,0,0,
8019,0,0,0,0,0,527,4884,0,0,1,1,0,1,0,1,102,0,0,
8038,0,0,0,0,0,527,4900,0,0,1,1,0,1,0,1,102,0,0,
8057,0,0,0,0,0,590,4901,0,0,1,1,0,1,0,3,102,0,0,
8076,0,0,0,0,0,525,4907,0,0,2,1,0,1,0,1,102,0,0,2,68,0,0,
8099,0,0,0,0,0,527,4922,0,0,1,1,0,1,0,1,102,0,0,
8118,0,0,0,0,0,590,4923,0,0,1,1,0,1,0,3,102,0,0,
8137,0,0,0,0,0,568,4952,0,0,1,1,0,1,0,3,102,0,0,
8156,0,0,155,80,0,1542,4953,0,0,3,3,0,0,128,3,68,0,0,3,102,0,0,3,3,0,0,1,9,0,0,
8187,0,0,0,0,0,527,4962,0,0,1,1,0,1,0,1,102,0,0,
14,1,0,0,0,0,527,4978,0,0,1,1,0,1,0,1,102,0,0,
33,1,0,0,0,0,590,4979,0,0,1,1,0,1,0,3,102,0,0,
52,1,0,0,0,0,525,4985,0,0,2,1,0,1,0,1,102,0,0,2,68,0,0,
75,1,0,0,0,0,527,5000,0,0,1,1,0,1,0,1,102,0,0,
94,1,0,0,0,0,590,5001,0,0,1,1,0,1,0,3,102,0,0,
113,1,0,156,85,0,1542,5024,0,0,3,3,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
144,1,0,0,0,0,568,5083,0,0,1,1,0,1,0,3,102,0,0,
163,1,0,157,81,0,1542,5084,0,0,3,3,0,0,128,3,68,0,0,3,102,0,0,3,3,0,0,1,9,0,0,
194,1,0,0,0,0,527,5093,0,0,1,1,0,1,0,1,102,0,0,
213,1,0,0,0,0,527,5109,0,0,1,1,0,1,0,1,102,0,0,
232,1,0,0,0,0,590,5110,0,0,1,1,0,1,0,3,102,0,0,
251,1,0,0,0,0,525,5116,0,0,4,1,0,1,0,1,102,0,0,2,68,0,0,2,68,0,0,2,3,0,0,
282,1,0,0,0,0,527,5138,0,0,1,1,0,1,0,1,102,0,0,
301,1,0,0,0,0,590,5139,0,0,1,1,0,1,0,3,102,0,0,
320,1,0,158,131,0,1542,5172,0,0,6,6,0,0,128,3,68,0,0,3,9,0,0,3,3,0,0,3,3,0,0,3,
3,0,0,3,3,0,0,1,9,0,0,
363,1,0,0,0,0,568,5246,0,0,1,1,0,1,0,3,102,0,0,
382,1,0,159,88,0,1542,5247,0,0,4,4,0,0,128,3,68,0,0,3,68,0,0,3,102,0,0,3,3,0,0,
1,9,0,0,
417,1,0,0,0,0,527,5256,0,0,1,1,0,1,0,1,102,0,0,
436,1,0,0,0,0,527,5271,0,0,1,1,0,1,0,1,102,0,0,
455,1,0,0,0,0,590,5272,0,0,1,1,0,1,0,3,102,0,0,
474,1,0,0,0,0,525,5279,0,0,5,1,0,1,0,1,102,0,0,2,68,0,0,2,68,0,0,2,9,0,0,2,9,0,
0,
509,1,0,0,0,0,527,5307,0,0,1,1,0,1,0,1,102,0,0,
528,1,0,0,0,0,590,5308,0,0,1,1,0,1,0,3,102,0,0,
547,1,0,160,79,0,1542,5332,0,0,3,3,0,0,128,3,68,0,0,3,68,0,0,3,3,0,0,1,9,0,0,
578,1,0,0,0,0,1605,5389,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
601,1,0,161,52,0,1539,5393,0,0,2,2,0,0,128,1,9,0,0,1,9,0,0,1,9,0,0,
628,1,0,0,0,0,1613,5398,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
651,1,0,162,0,0,1567,5399,0,0,0,0,0,0,128,1,9,0,0,
670,1,0,163,0,0,1565,5404,0,0,0,0,0,0,128,1,9,0,0,
689,1,0,0,0,0,1613,5405,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
712,1,0,164,65,0,1540,5411,0,0,2,1,0,0,128,2,113,0,0,1,9,0,0,1,9,0,0,
739,1,0,0,0,0,1613,5416,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
762,1,0,165,0,0,1567,5417,0,0,0,0,0,0,128,1,9,0,0,
781,1,0,0,0,0,1650,5424,0,0,2,1,0,0,128,1,113,0,0,2,3,0,7,1,9,0,0,
808,1,0,0,0,0,1613,5429,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
831,1,0,166,0,0,1567,5430,0,0,0,0,0,0,128,1,9,0,0,
850,1,0,0,0,0,1648,5437,0,0,5,5,0,0,128,3,3,0,0,1,23,0,0,1,3,0,0,3,113,0,0,1,3,
0,0,1,9,0,0,
889,1,0,0,0,0,1613,5443,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
912,1,0,167,0,0,1567,5444,0,0,0,0,0,0,128,1,9,0,0,
931,1,0,168,52,0,1539,5452,0,0,2,2,0,0,128,1,9,0,0,1,68,0,0,1,9,0,0,
958,1,0,0,0,0,1613,5457,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
981,1,0,169,0,0,1567,5458,0,0,0,0,0,0,128,1,9,0,0,
1000,1,0,170,0,0,1565,5463,0,0,0,0,0,0,128,1,9,0,0,
1019,1,0,0,0,0,1613,5464,0,0,1,1,0,0,128,3,113,0,0,1,9,0,0,
};


#include "stdafx.h"
#define SQLCA_NONE
#define ORACA_NONE
#include <sqlcpr.h>
// extern struct sqlca sqlca;
// extern struct oraca oraca;

/*#include <oci.h>*/
/*使用到的连接名与上下文
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);
    EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid];
*/

#include <stdio.h>
#include <sqlca.h>

#include "DatabaseMini.h"
#include <oci.h>

using namespace std;

/* EXEC SQL INCLUDE SQLCA;
 */ 
/*
 * $Header: sqlca.h 24-apr-2003.12:50:58 mkandarp Exp $ sqlca.h 
 */

/* Copyright (c) 1985, 2003, Oracle Corporation.  All rights reserved.  */
 
/*
NAME
  SQLCA : SQL Communications Area.
FUNCTION
  Contains no code. Oracle fills in the SQLCA with status info
  during the execution of a SQL stmt.
NOTES
  **************************************************************
  ***                                                        ***
  *** This file is SOSD.  Porters must change the data types ***
  *** appropriately on their platform.  See notes/pcport.doc ***
  *** for more information.                                  ***
  ***                                                        ***
  **************************************************************

  If the symbol SQLCA_STORAGE_CLASS is defined, then the SQLCA
  will be defined to have this storage class. For example:
 
    #define SQLCA_STORAGE_CLASS extern
 
  will define the SQLCA as an extern.
 
  If the symbol SQLCA_INIT is defined, then the SQLCA will be
  statically initialized. Although this is not necessary in order
  to use the SQLCA, it is a good pgming practice not to have
  unitialized variables. However, some C compilers/OS's don't
  allow automatic variables to be init'd in this manner. Therefore,
  if you are INCLUDE'ing the SQLCA in a place where it would be
  an automatic AND your C compiler/OS doesn't allow this style
  of initialization, then SQLCA_INIT should be left undefined --
  all others can define SQLCA_INIT if they wish.

  If the symbol SQLCA_NONE is defined, then the SQLCA variable will
  not be defined at all.  The symbol SQLCA_NONE should not be defined
  in source modules that have embedded SQL.  However, source modules
  that have no embedded SQL, but need to manipulate a sqlca struct
  passed in as a parameter, can set the SQLCA_NONE symbol to avoid
  creation of an extraneous sqlca variable.
 
MODIFIED
    lvbcheng   07/31/98 -  long to int
    jbasu      12/12/94 -  Bug 217878: note this is an SOSD file
    losborne   08/11/92 -  No sqlca var if SQLCA_NONE macro set 
  Clare      12/06/84 - Ch SQLCA to not be an extern.
  Clare      10/21/85 - Add initialization.
  Bradbury   01/05/86 - Only initialize when SQLCA_INIT set
  Clare      06/12/86 - Add SQLCA_STORAGE_CLASS option.
*/
 
#ifndef SQLCA
#define SQLCA 1
 
struct   sqlca
         {
         /* ub1 */ char    sqlcaid[8];
         /* b4  */ int     sqlabc;
         /* b4  */ int     sqlcode;
         struct
           {
           /* ub2 */ unsigned short sqlerrml;
           /* ub1 */ char           sqlerrmc[70];
           } sqlerrm;
         /* ub1 */ char    sqlerrp[8];
         /* b4  */ int     sqlerrd[6];
         /* ub1 */ char    sqlwarn[8];
         /* ub1 */ char    sqlext[8];
         };

#ifndef SQLCA_NONE 
#ifdef   SQLCA_STORAGE_CLASS
SQLCA_STORAGE_CLASS struct sqlca sqlca
#else
         struct sqlca sqlca
#endif
 
#ifdef  SQLCA_INIT
         = {
         {'S', 'Q', 'L', 'C', 'A', ' ', ' ', ' '},
         sizeof(struct sqlca),
         0,
         { 0, {0}},
         {'N', 'O', 'T', ' ', 'S', 'E', 'T', ' '},
         {0, 0, 0, 0, 0, 0},
         {0, 0, 0, 0, 0, 0, 0, 0},
         {0, 0, 0, 0, 0, 0, 0, 0}
         }
#endif
         ;
#endif
 
#endif
 
/* end SQLCA */
/* EXEC SQL INCLUDE ORACA;
 */ 
/*
 * $Header: oraca.h 24-apr-2003.12:50:59 mkandarp Exp $ oraca.h 
 */

/* Copyright (c) 1985, 2003, Oracle Corporation.  All rights reserved.  */
 
/*
NAME
  ORACA : Oracle Communications Area.
FUNCTION
  Contains no code. Provides supplementary communications to/from
  Oracle (in addition to standard SQLCA).
NOTES
  **************************************************************
  ***                                                        ***
  *** This file is SOSD.  Porters must change the data types ***
  *** appropriately on their platform.  See notes/pcport.doc ***
  *** for more information.                                  ***
  ***                                                        ***
  **************************************************************

  oracchf : Check cursor cache consistency flag. If set AND oradbgf
            is set, then directs SQLLIB to perform cursor cache
            consistency checks before every cursor operation
            (OPEN, FETCH, SELECT, INSERT, etc.).
  oradbgf : Master DEBUG flag. Used to turn all DEBUG options
            on or off.
  orahchf : Check Heap consistency flag. If set AND oradbgf is set,
            then directs SQLLIB to perform heap consistency checks
            everytime memory is dynamically allocated/free'd via
            sqlalc/sqlfre/sqlrlc. MUST BE SET BEFORE 1ST CONNECT
            and once set cannot be cleared (subsequent requests
            to change it are ignored).
  orastxtf: Save SQL stmt text flag. If set, then directs SQLLIB
            to save the text of the current SQL stmt in orastxt
            (in VARCHAR format).
  orastxt : Saved len and text of current SQL stmt (in VARCHAR
            format).
  orasfnm : Saved len and text of filename containing current SQL
            stmt (in VARCHAR format).
  oraslnr : Saved line nr within orasfnm of current SQL stmt.
 
  Cursor cache statistics. Set after COMMIT or ROLLBACK. Each
  CONNECT'd DATABASE has its own set of statistics.
 
  orahoc  : Highest Max Open OraCursors requested. Highest value
            for MAXOPENCURSORS by any CONNECT to this DATABASE.
  oramoc  : Max Open OraCursors required. Specifies the max nr
            of OraCursors required to run this pgm. Can be higher
            than orahoc if working set (MAXOPENCURSORS) was set
            too low, thus forcing the PCC to expand the cache.
  oracoc  : Current nr of OraCursors used.
  oranor  : Nr of OraCursor cache reassignments. Can show the
            degree of "thrashing" in the cache. Optimally, this
            nr should be kept as low as possible (time vs space
            optimization).
  oranpr  : Nr of SQL stmt "parses".
  oranex  : Nr of SQL stmt "executes". Optimally, the relation-
            ship of oranex to oranpr should be kept as high as
            possible.
 
 
  If the symbol ORACA_NONE is defined, then there will be no ORACA
  *variable*, although there will still be a struct defined.  This
  macro should not normally be defined in application code.

  If the symbol ORACA_INIT is defined, then the ORACA will be
  statically initialized. Although this is not necessary in order
  to use the ORACA, it is a good pgming practice not to have
  unitialized variables. However, some C compilers/OS's don't
  allow automatic variables to be init'd in this manner. Therefore,
  if you are INCLUDE'ing the ORACA in a place where it would be
  an automatic AND your C compiler/OS doesn't allow this style
  of initialization, then ORACA_INIT should be left undefined --
  all others can define ORACA_INIT if they wish.
 
OWNER
  Clare
DATE
  10/19/85
MODIFIED
    apopat     05/08/02  - [2362423] MVS PE to make lines shorter than 79
    apopat     07/31/99 -  [707588] TAB to blanks for OCCS
    lvbcheng   10/27/98 -  change long to int for oraca
    pccint     10/03/96 -  Add IS_OSD for linting
    jbasu      12/12/94 -  Bug 217878: note this is an SOSD file
    losborne   09/04/92 -  Make oraca variable optional 
    Osborne    05/24/90 - Add ORACA_STORAGE_CLASS construct
  Clare      02/20/86 - PCC [10101l] Feature: Heap consistency check.
  Clare      03/04/86 - PCC [10101r] Port: ORACA init ifdef.
  Clare      03/12/86 - PCC [10101ab] Feature: ORACA cuc statistics.
*/
/* IS_OSD */ 
#ifndef  ORACA
#define  ORACA     1
 
struct   oraca
         {
    /* text */ char oracaid[8];      /* Reserved                            */
    /* ub4  */ int oracabc;          /* Reserved                            */
 
    /*       Flags which are setable by User. */
 
   /* ub4 */ int  oracchf;           /* <> 0 if "check cur cache consistncy"*/
   /* ub4 */ int  oradbgf;           /* <> 0 if "do DEBUG mode checking"    */
   /* ub4 */ int  orahchf;           /* <> 0 if "do Heap consistency check" */
   /* ub4 */ int  orastxtf;          /* SQL stmt text flag                  */
#define  ORASTFNON 0                 /* = don't save text of SQL stmt       */
#define  ORASTFERR 1                 /* = only save on SQLERROR             */
#define  ORASTFWRN 2                 /* = only save on SQLWARNING/SQLERROR  */
#define  ORASTFANY 3                 /* = always save                       */
         struct
           {
  /* ub2  */ unsigned short orastxtl;
  /* text */ char  orastxtc[70];
           } orastxt;                /* text of last SQL stmt               */
         struct
           {
  /* ub2  */   unsigned short orasfnml;
  /* text */   char       orasfnmc[70];
           } orasfnm;                /* name of file containing SQL stmt    */
  /* ub4 */ int   oraslnr;           /* line nr-within-file of SQL stmt     */

  /* ub4 */ int   orahoc;            /* highest max open OraCurs requested  */
  /* ub4 */ int   oramoc;            /* max open OraCursors required        */
  /* ub4 */ int   oracoc;            /* current OraCursors open             */
  /* ub4 */ int   oranor;            /* nr of OraCursor re-assignments      */
  /* ub4 */ int   oranpr;            /* nr of parses                        */
  /* ub4 */ int   oranex;            /* nr of executes                      */
         };

#ifndef ORACA_NONE

#ifdef ORACA_STORAGE_CLASS
ORACA_STORAGE_CLASS struct oraca oraca
#else
struct oraca oraca
#endif
#ifdef ORACA_INIT
         =
         {
         {'O','R','A','C','A',' ',' ',' '},
         sizeof(struct oraca),
         0,0,0,0,
         {0,{0}},
         {0,{0}},
         0,
         0,0,0,0,0,0
         }
#endif
         ;

#endif

#endif
/* end oraca.h */


/* EXEC ORACLE OPTION (RELEASE_CURSOR = YES); */ 

/* EXEC ORACLE OPTION (ORACA=YES); */ 


extern struct oraca oraca;
extern void sqlgls(char*,size_t*,size_t *);

typedef struct long_varraw
{
    unsigned int len;
    char buf[1];
} long_varraw;
/* EXEC SQL TYPE long_varraw IS LONG VARRAW REFERENCE; */ 


//线程运行上下文
/* EXEC SQL BEGIN DECLARE SECTION; */ 

    extern sql_context m_ctx[ 200 ];
/* EXEC SQL END DECLARE SECTION; */ 



CDatabaseMini::CDatabaseMini(void)
{

}

CDatabaseMini::~CDatabaseMini(void)
{

}

void CDatabaseMini::SetConnectDB(char* uid, char* pwd, char* sid)
{
    strncpy(miniuid, uid,32);
    strncpy(minipwd,pwd,32);
    strncpy(minisid, sid,32);
}

bool CDatabaseMini::ConnectDB()
{
    return ConnectMini();
}

/*================================================================
*
* 函 数 名：Get_User_GroupInfo
** 根据用户名分组信息
* 参 数：
* const uint32 [[IN]] : 用户ID
* XT_GROUPINFO_GET_ACK::tagGroupInfo* pGroupInfo [IN,OUT]: 用户分组信息
* int &nGroupNum [IN,OUT] : 所要获取的分组数和返回的分组数，如果输入为0，则输出存在的数目。
* 返 回 值：int -   SUCCESS: DB_SUCCESS; 数据库错误:DB_ERROR;
*
================================================================*/
int CDatabaseMini::Get_User_GroupInfo(const uint32 c_iUserID, XT_GROUPINFO_GET_ACK::tagGroupInfo* pGroupInfo, uint8 &nGroupNum, uint8 flag)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_groupname[21]; */ 
struct { unsigned short len; unsigned char arr[21]; } var_groupname;

        unsigned int     i_UserId,i_flag;
        int             g_pid,g_id,ret_count;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
        SQL_CURSOR cur_group;
    /* EXEC SQL END DECLARE SECTION; */ 



    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    SET_INIT_NULL(var_groupname);
    i_UserId = c_iUserID ;
    i_flag = flag;

    ret_count = 0;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

    /* EXEC SQL ALLOCATE :cur_group; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 1;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_group;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.GetGroupInfo(:i_UserId,:cur_group,:retcode,:i_flag);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 5;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetGroupInfo ( :i_UserId , :cur_g\
roup , :retcode , :i_flag ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )24;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&i_UserId;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cur_group;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&i_flag;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_group; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 5;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )59;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_group;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        nGroupNum = 0;
        /* EXEC SQL CLOSE :cur_group; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 5;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )78;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_group;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_group; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 5;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )97;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_group;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {

        /* EXEC SQL FETCH :cur_group INTO :g_pid,:g_id,:var_groupname; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 5;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )116;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_group;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&g_pid;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&g_id;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&var_groupname;
        sqlstm.sqhstl[3] = (unsigned long )23;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            nGroupNum = ret_count;
            break;
        }

        if( ret_count >= nGroupNum )//指定获取的数目
        {
            break;
        }

        if( db_ret < 0 )
        {
            nGroupNum = ret_count;
            break;
        }
        SET_END_NULL(var_groupname);

        pGroupInfo[ret_count].nGroupPid = g_pid;
        pGroupInfo[ret_count].nGroupID = g_id;
        strncpy(pGroupInfo[ret_count].szGroupName, (char*)var_groupname.arr, MAX_GROUPNAME_LEN);

        ++ret_count;
    }

    /* EXEC SQL CLOSE :cur_group; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 5;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )147;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_group;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_group; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 5;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )166;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_group;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    return  DB_SUCCESS;

}

int CDatabaseMini::WebMsgSave(XT_TALK* msg,uint32 logintime)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int from_id,to_id,data_type,version,send_time,recv_flag,fontSize,fontColor,fontStyle,recv_logintime,retcode;
        /* VARCHAR var_fontName[50],var_nickname[41],var_msg[1315],db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[50]; } var_fontName;

struct { unsigned short len; unsigned char arr[41]; } var_nickname;

struct { unsigned short len; unsigned char arr[1315]; } var_msg;

struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    from_id = msg->from_id;
    to_id = msg->to_id;
    data_type = msg->data_type;
    version = msg->ver;
    send_time = msg->send_time;
    recv_flag = msg->recv_flag;
    fontSize = msg->fontSize;
    fontColor = msg->fontColor;
    fontStyle = msg->fontStyle;
    recv_logintime =logintime;

    SET_INIT_NULL(var_fontName);
    SET_INIT_NULL(var_nickname);
    SET_INIT_NULL(var_msg);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    strncpy((char*)var_nickname.arr,msg->from_nickname,MAX_NICKNAME_LEN+1);/*4*/
    var_nickname.len = (short)strlen((char *)var_nickname.arr);

    strncpy((char*)var_fontName.arr,msg->fontName,50);
    var_fontName.len = (short)strlen((char *)var_fontName.arr);

    strncpy((char*)var_msg.arr,msg->data,1315);
    var_msg.len = (short)strlen((char *)var_msg.arr);

    int db_ret;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

    int iReconnTimes;
    bool bReconn;

start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.WebIMMsgSave_20150708(:from_id,:to_id,:data_type,:version,:send_time,:recv_flag,:fontSize,:fontColor,:fontStyle,:recv_logintime,:var_fontName,:var_nickname,:var_msg,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . WebIMMsgSave_20150708 ( :from_id ,\
 :to_id , :data_type , :version , :send_time , :recv_flag , :fontSize , :font\
Color , :fontStyle , :recv_logintime , :var_fontName , :var_nickname , :var_m\
sg , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )185;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&from_id;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&to_id;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&data_type;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&version;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&send_time;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&recv_flag;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&fontSize;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&fontColor;
    sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqhstv[8] = (unsigned char  *)&fontStyle;
    sqlstm.sqhstl[8] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[8] = (         int  )0;
    sqlstm.sqindv[8] = (         short *)0;
    sqlstm.sqinds[8] = (         int  )0;
    sqlstm.sqharm[8] = (unsigned long )0;
    sqlstm.sqadto[8] = (unsigned short )0;
    sqlstm.sqtdso[8] = (unsigned short )0;
    sqlstm.sqhstv[9] = (unsigned char  *)&recv_logintime;
    sqlstm.sqhstl[9] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[9] = (         int  )0;
    sqlstm.sqindv[9] = (         short *)0;
    sqlstm.sqinds[9] = (         int  )0;
    sqlstm.sqharm[9] = (unsigned long )0;
    sqlstm.sqadto[9] = (unsigned short )0;
    sqlstm.sqtdso[9] = (unsigned short )0;
    sqlstm.sqhstv[10] = (unsigned char  *)&var_fontName;
    sqlstm.sqhstl[10] = (unsigned long )52;
    sqlstm.sqhsts[10] = (         int  )0;
    sqlstm.sqindv[10] = (         short *)0;
    sqlstm.sqinds[10] = (         int  )0;
    sqlstm.sqharm[10] = (unsigned long )0;
    sqlstm.sqadto[10] = (unsigned short )0;
    sqlstm.sqtdso[10] = (unsigned short )0;
    sqlstm.sqhstv[11] = (unsigned char  *)&var_nickname;
    sqlstm.sqhstl[11] = (unsigned long )43;
    sqlstm.sqhsts[11] = (         int  )0;
    sqlstm.sqindv[11] = (         short *)0;
    sqlstm.sqinds[11] = (         int  )0;
    sqlstm.sqharm[11] = (unsigned long )0;
    sqlstm.sqadto[11] = (unsigned short )0;
    sqlstm.sqtdso[11] = (unsigned short )0;
    sqlstm.sqhstv[12] = (unsigned char  *)&var_msg;
    sqlstm.sqhstl[12] = (unsigned long )1317;
    sqlstm.sqhsts[12] = (         int  )0;
    sqlstm.sqindv[12] = (         short *)0;
    sqlstm.sqinds[12] = (         int  )0;
    sqlstm.sqharm[12] = (unsigned long )0;
    sqlstm.sqadto[12] = (unsigned short )0;
    sqlstm.sqtdso[12] = (unsigned short )0;
    sqlstm.sqhstv[13] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[13] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[13] = (         int  )0;
    sqlstm.sqindv[13] = (         short *)0;
    sqlstm.sqinds[13] = (         int  )0;
    sqlstm.sqharm[13] = (unsigned long )0;
    sqlstm.sqadto[13] = (unsigned short )0;
    sqlstm.sqtdso[13] = (unsigned short )0;
    sqlstm.sqhstv[14] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[14] = (unsigned long )34;
    sqlstm.sqhsts[14] = (         int  )0;
    sqlstm.sqindv[14] = (         short *)0;
    sqlstm.sqinds[14] = (         int  )0;
    sqlstm.sqharm[14] = (unsigned long )0;
    sqlstm.sqadto[14] = (unsigned short )0;
    sqlstm.sqtdso[14] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (retcode == 1)
    {
        return DB_ERROR;
    }

    return DB_SUCCESS;
}

int CDatabaseMini::WebRecommSave(uint32 fid,uint32 did,uint16 recomm,uint32 time,uint32 logintime,char* msg)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int from_id,to_id,recomment,send_time,login_time;
        /* VARCHAR var_msgs[1315]; */ 
struct { unsigned short len; unsigned char arr[1315]; } var_msgs;

        int retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    from_id = fid;
    to_id = did;
    recomment = recomm;
    send_time = time;
    login_time = logintime;
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);
    SET_INIT_NULL(var_msgs);

    strncpy((char*)var_msgs.arr, msg,1315);
    var_msgs.len = (short)strlen((char*)var_msgs.arr);

    int db_ret;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

    int iReconnTimes;
    bool bReconn;

start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.WebRecommSave(:from_id,:to_id,:recomment,:send_time,:login_time,:var_msgs,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . WebRecommSave ( :from_id , :to_id \
, :recomment , :send_time , :login_time , :var_msgs , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )260;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&from_id;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&to_id;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&recomment;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&send_time;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&login_time;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&var_msgs;
    sqlstm.sqhstl[5] = (unsigned long )1317;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[7] = (unsigned long )34;
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (retcode == 1 || retcode == 1403)
    {
        return DB_ERROR;
    }

    return DB_SUCCESS;
}

int CDatabaseMini::WebServiceSave(uint32 fid,uint32 did,uint16 recomm,uint32 time)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int from_id,to_id,recomment,send_time;
        int retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    from_id = fid;
    to_id = did;
    recomment = recomm;
    send_time = time;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

    int iReconnTimes;
    bool bReconn;

start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.WebServiceSave(:from_id,:to_id,:recomment,:send_time,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . WebServiceSave ( :from_id , :to_id\
 , :recomment , :send_time , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )307;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&from_id;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&to_id;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&recomment;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&send_time;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (retcode == 1)
    {
        return DB_ERROR;
    }

    return DB_SUCCESS;
}

int CDatabaseMini::WebBusiListReq(XT_WEB_BUSI_LIST_REQ* BusiListReq,XT_WEB_BUSI_LIST_ACK::BusiList* pListInfo,uint32& nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32],var_nickname[41],var_headImg[101],var_usersign[250]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

struct { unsigned short len; unsigned char arr[41]; } var_nickname;

struct { unsigned short len; unsigned char arr[101]; } var_headImg;

struct { unsigned short len; unsigned char arr[250]; } var_usersign;

        unsigned int id,msgnum,list_id,c_time;
        int retcode;
        SQL_CURSOR cur_listInfo;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    id=BusiListReq->id;
    msgnum=BusiListReq->msgnum;

    SET_INIT_NULL(var_nickname);
    SET_INIT_NULL(var_headImg);
    SET_INIT_NULL(var_usersign);

    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_listInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )346;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_listInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.WebListReq_20151020(:id,:msgnum,:cur_listInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . WebListReq_20151020 ( :id , :msgnu\
m , :cur_listInfo , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )365;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&id;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&msgnum;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&cur_listInfo;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_listInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )400;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_listInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_listInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )419;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_listInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_listInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )438;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_listInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {
        /* EXEC SQL FETCH :cur_listInfo INTO :list_id,:c_time,:var_nickname,:var_headImg,:var_usersign; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )457;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_listInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&list_id;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&c_time;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&var_nickname;
        sqlstm.sqhstl[3] = (unsigned long )43;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&var_headImg;
        sqlstm.sqhstl[4] = (unsigned long )103;
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&var_usersign;
        sqlstm.sqhstl[5] = (unsigned long )252;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            nRetCount = iNum;
            break;
        }
        if (iNum >= nRetCount)
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            nRetCount = iNum;
            break;
        }
        pListInfo[iNum].id = list_id;
        pListInfo[iNum].time = c_time;

        SET_END_NULL(var_nickname);
        SET_END_NULL(var_headImg);
        SET_END_NULL(var_usersign);
        strncpy(pListInfo[iNum].nickname,(char*)var_nickname.arr,MAX_NICKNAME_LEN+1);
        strncpy(pListInfo[iNum].headImgUrl,(char*)var_headImg.arr,MAX_HEADURL_LEN+1);
        strncpy(pListInfo[iNum].usersign,(char*)var_usersign.arr,MAX_USERSIGN_LEN+1);

        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_listInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )496;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_listInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_listInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )515;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_listInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::WebMsgReq(XT_WEB_MORE_MSG_REQ* msgReq,XT_WEB_MORE_MSG_ACK::MsgInfo* msgInfo,uint32& nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32],var_fontName[50],var_nickName[41],var_data[1315]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

struct { unsigned short len; unsigned char arr[50]; } var_fontName;

struct { unsigned short len; unsigned char arr[41]; } var_nickName;

struct { unsigned short len; unsigned char arr[1315]; } var_data;

        unsigned int sid,did,msgtime,msgnum,msgid;
        unsigned int id,send_time,fontSize,fontColor,fontStyle;
        int retcode;
        SQL_CURSOR cur_msgInfo;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    sid=msgReq->sid;
    did=msgReq->did;
    msgtime=msgReq->msgtime;
    msgnum=msgReq->msgnum;
    msgid=msgReq->msgid;

    SET_INIT_NULL(var_fontName);
    SET_INIT_NULL(var_nickName);
    SET_INIT_NULL(var_data);


    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )534;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.WebMsgReq(:sid,:did,:msgtime,:msgid,:msgnum,:cur_msgInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . WebMsgReq ( :sid , :did , :msgtime\
 , :msgid , :msgnum , :cur_msgInfo , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )553;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&sid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&did;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&msgtime;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&msgid;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&msgnum;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[7] = (unsigned long )34;
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )600;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )619;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )638;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {
        /* EXEC SQL FETCH :cur_msgInfo INTO :id,:send_time,:fontSize,:fontColor,:fontStyle,:var_fontName,:var_nickName,:var_data,:msgid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )657;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&id;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&send_time;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&fontSize;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&fontColor;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&fontStyle;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&var_fontName;
        sqlstm.sqhstl[6] = (unsigned long )52;
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&var_nickName;
        sqlstm.sqhstl[7] = (unsigned long )43;
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqhstv[8] = (unsigned char  *)&var_data;
        sqlstm.sqhstl[8] = (unsigned long )1317;
        sqlstm.sqhsts[8] = (         int  )0;
        sqlstm.sqindv[8] = (         short *)0;
        sqlstm.sqinds[8] = (         int  )0;
        sqlstm.sqharm[8] = (unsigned long )0;
        sqlstm.sqadto[8] = (unsigned short )0;
        sqlstm.sqtdso[8] = (unsigned short )0;
        sqlstm.sqhstv[9] = (unsigned char  *)&msgid;
        sqlstm.sqhstl[9] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[9] = (         int  )0;
        sqlstm.sqindv[9] = (         short *)0;
        sqlstm.sqinds[9] = (         int  )0;
        sqlstm.sqharm[9] = (unsigned long )0;
        sqlstm.sqadto[9] = (unsigned short )0;
        sqlstm.sqtdso[9] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            nRetCount = iNum;
            break;
        }
        if (iNum >= nRetCount)
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            nRetCount = iNum;
            break;
        }
        msgInfo[iNum].id = id;
        msgInfo[iNum].send_time = send_time;
        msgInfo[iNum].fontSize = fontSize;
        msgInfo[iNum].fontColor = fontColor;
        msgInfo[iNum].fontStyle = fontStyle;
        msgInfo[iNum].msgid = msgid;

        SET_END_NULL(var_fontName);
        SET_END_NULL(var_nickName);
        SET_END_NULL(var_data);


        strncpy(msgInfo[iNum].fontName,(char*)var_fontName.arr,50);
        strncpy(msgInfo[iNum].nickName,(char*)var_nickName.arr,MAX_NICKNAME_LEN+1);
        strncpy(msgInfo[iNum].data,(char*)var_data.arr,1315);



        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )712;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )731;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::WebMsgMoreReq(XT_WEB_MORE_MSG_REQ* msgReq,XT_WEB_MORE_MSG_ACK::MsgInfo* msgInfo,std::vector<uint32_t> &ids, uint32& nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32],var_fontName[50],var_nickName[41],var_data[1315]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

struct { unsigned short len; unsigned char arr[50]; } var_fontName;

struct { unsigned short len; unsigned char arr[41]; } var_nickName;

struct { unsigned short len; unsigned char arr[1315]; } var_data;

        /* VARCHAR merchant_ids[1024]; */ 
struct { unsigned short len; unsigned char arr[1024]; } merchant_ids;

        unsigned int sid,msgtime,msgnum,msgid;
        unsigned int id,send_time,fontSize,fontColor,fontStyle;
        int retcode;
        SQL_CURSOR cur_msgInfo;
    /* EXEC SQL END DECLARE SECTION; */ 


    SET_INIT_NULL(merchant_ids);
    for(unsigned int i = 0; i < ids.size(); i++)
    {
        char buffer[64] = {0};
        strcat((char *)merchant_ids.arr,itoa(ids[i],buffer,10));
        strcat((char *)merchant_ids.arr,",");
    }
    merchant_ids.arr[(short)strlen((char*)merchant_ids.arr)-1] = '\0';
    merchant_ids.len = (short)strlen((char*)merchant_ids.arr);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    sid=msgReq->sid;
//  did=msgReq->did;
    msgtime=msgReq->msgtime;
    msgnum=msgReq->msgnum;
    msgid=msgReq->msgid;

    SET_INIT_NULL(var_fontName);
    SET_INIT_NULL(var_nickName);
    SET_INIT_NULL(var_data);


    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )750;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.WebMsgMoreReq(:sid,:msgtime,:msgid,:msgnum,:merchant_ids,:cur_msgInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . WebMsgMoreReq ( :sid , :msgtime , \
:msgid , :msgnum , :merchant_ids , :cur_msgInfo , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )769;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&sid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&msgtime;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&msgid;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&msgnum;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&merchant_ids;
    sqlstm.sqhstl[4] = (unsigned long )1026;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[7] = (unsigned long )34;
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )816;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )835;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )854;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {
        /* EXEC SQL FETCH :cur_msgInfo INTO :id,:send_time,:fontSize,:fontColor,:fontStyle,:var_fontName,:var_nickName,:var_data,:msgid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )873;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&id;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&send_time;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&fontSize;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&fontColor;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&fontStyle;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&var_fontName;
        sqlstm.sqhstl[6] = (unsigned long )52;
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&var_nickName;
        sqlstm.sqhstl[7] = (unsigned long )43;
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqhstv[8] = (unsigned char  *)&var_data;
        sqlstm.sqhstl[8] = (unsigned long )1317;
        sqlstm.sqhsts[8] = (         int  )0;
        sqlstm.sqindv[8] = (         short *)0;
        sqlstm.sqinds[8] = (         int  )0;
        sqlstm.sqharm[8] = (unsigned long )0;
        sqlstm.sqadto[8] = (unsigned short )0;
        sqlstm.sqtdso[8] = (unsigned short )0;
        sqlstm.sqhstv[9] = (unsigned char  *)&msgid;
        sqlstm.sqhstl[9] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[9] = (         int  )0;
        sqlstm.sqindv[9] = (         short *)0;
        sqlstm.sqinds[9] = (         int  )0;
        sqlstm.sqharm[9] = (unsigned long )0;
        sqlstm.sqadto[9] = (unsigned short )0;
        sqlstm.sqtdso[9] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            nRetCount = iNum;
            break;
        }
        if (iNum >= nRetCount)
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            nRetCount = iNum;
            break;
        }
        msgInfo[iNum].id = id;
        msgInfo[iNum].send_time = send_time;
        msgInfo[iNum].fontSize = fontSize;
        msgInfo[iNum].fontColor = fontColor;
        msgInfo[iNum].fontStyle = fontStyle;
        msgInfo[iNum].msgid = msgid;

        SET_END_NULL(var_fontName);
        SET_END_NULL(var_nickName);
        SET_END_NULL(var_data);


        strncpy(msgInfo[iNum].fontName,(char*)var_fontName.arr,50);
        strncpy(msgInfo[iNum].nickName,(char*)var_nickName.arr,MAX_NICKNAME_LEN+1);
        strncpy(msgInfo[iNum].data,(char*)var_data.arr,1315);



        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )928;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )947;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

/*================================================================
*
* 函 数 名：Get_Family_MaxMsgID
** 根据家族ID获取当前家族最大和最小消息ID
* 参 数：
* uint32 c_iFamilyID [[IN]] : 家族ID
* uint32 & nMsgID [IN,OUT]: 家族当前消息ID
* 返 回 值：int -   SUCCESS: DB_SUCCESS; 数据库错误:DB_ERROR;  如果家族创建后无任何消息，nMsgID = 0;
*
================================================================*/
int  CDatabaseMini::Get_Family_MaxMsgID(const uint32 c_iFamilyID, uint32 & nMaxMsgID, uint32 &nMinMsgID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int      nFamilyID;
        unsigned int      nmaxmsgid,nminmsgid;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    nMaxMsgID = 0;
    nFamilyID = c_iFamilyID;
    nmaxmsgid = 0;
    nminmsgid = 0;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.GetFamilyMsgID(:nFamilyID,:nmaxmsgid,:nminmsgid,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetFamilyMsgID ( :nFamilyID , :nm\
axmsgid , :nminmsgid , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )966;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nFamilyID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&nmaxmsgid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&nminmsgid;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 && db_ret != -1405) //数据库发生错误
    {
        sql_error(sqlca, oraca);
        CLog::Log("Get_Family_MaxMsgID",CLog::TYPE_ERROR,"获取家族最大消息ID失败,nFamilyID:%d, db_ret:%d",nFamilyID,db_ret);
        return DB_ERROR;
    }

    if( db_ret >= 0 && db_ret != 1403)
    {
        nMaxMsgID = nmaxmsgid;
        nMinMsgID = nminmsgid;
    }
    else    //初始ID从1开始
    {
        nMaxMsgID = 1;
        nMinMsgID = 0;
    }

    return DB_SUCCESS;
}

/*================================================================
*
* 函 数 名：Save_Family_RequestMsg
** 保存家族请求消息ID
* 参 数：
* uint32 c_iFamilyID    [IN] : 家族ID
* uint32 iSenderID      [IN] : 发送者ID
* uint32 iSendTime      [IN] : 请求时间
* char   *strMsg        [IN] : 请求内容
* int    iMsgLen        [IN] : 内容长度
* 返 回 值：int -   SUCCESS: DB_SUCCESS; 数据库错误:DB_ERROR;
*
================================================================*/
int CDatabaseMini::Save_Family_RequestMsg(const uint32 c_iFamilyID, uint32 iSenderID,uint32 iSendTime,const char *strMsg, int iMsgLen)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw * lvr;
        unsigned int     nFamilyID, nSenderID, nSendTime, nMsgSeq;
        int nMsgLen, nMsgType;
        char*   pmsg;
        OCIBlobLocator *blob;
        unsigned int offset = 1; /* attention: typedef ub4 unsigned int */
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);


    nFamilyID = c_iFamilyID;
    nSenderID = iSenderID;
    nSendTime = iSendTime;
    nMsgLen = iMsgLen;
    nMsgType = CMD_CLUSTER_AUTH_REQ;
    pmsg = (char*)strMsg;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1001;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    /* EXEC SQL AT :db_link_name SELECT IM_CLUSTERSYSMSG_SEQ_MSGID.nextval INTO :nMsgSeq FROM DUAL; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select IM_CLUSTERSYSMSG_SEQ_MSGID.nextval  into :b1  fro\
m DUAL ";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1024;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nMsgSeq;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name INSERT INTO IM_CLUSTERSYSMSG(MSGID, CLUSTERID,SENDER,SRCIP,SRCPORT,SENDTIME,MSGTYPE,MSGLEN,MSG)
       VALUES(:nMsgSeq, :nFamilyID,:nSenderID,0,0,:nSendTime,:nMsgType,:nMsgLen,empty_blob()); */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "insert into IM_CLUSTERSYSMSG (MSGID,CLUSTERID,SENDER,SRC\
IP,SRCPORT,SENDTIME,MSGTYPE,MSGLEN,MSG) values (:b1,:b2,:b3,0,0,:b4,:b5,:b6,e\
mpty_blob())";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1047;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nMsgSeq;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&nFamilyID;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&nSenderID;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&nSendTime;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&nMsgType;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[6] = (unsigned long )34;
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 || db_ret == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1090;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1109;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1132;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    /* EXEC SQL AT :db_link_name SELECT MSG INTO :blob  FROM IM_CLUSTERSYSMSG
       WHERE MSGID = :nMsgSeq FOR UPDATE; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select MSG into :b1  from IM_CLUSTERSYSMSG where MSGID=:\
b2 for update ";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1151;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&nMsgSeq;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 || db_ret == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1178;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1197;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    lvr = (long_varraw *)malloc(sizeof(ub4) + nMsgLen);
    lvr->len = nMsgLen;
    memcpy(lvr->buf,pmsg,nMsgLen);
    /* EXEC SQL AT :db_link_name LOB WRITE ONE :nMsgLen
        FROM :lvr WITH LENGTH :nMsgLen INTO :blob AT :offset; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1220;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)lvr;
    sqlstm.sqhstl[1] = (unsigned long )4;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&blob;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&offset;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 || db_ret == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1259;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1278;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        free(lvr);
        return DB_ERROR;
    }
    free(lvr);

    /* EXEC SQL AT :db_link_name UPDATE IM_CLUSTERSYSMSG SET MSG = :blob
       WHERE MSGID = :nMsgSeq; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "update IM_CLUSTERSYSMSG  set MSG=:b1 where MSGID=:b2";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1301;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&nMsgSeq;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 || db_ret == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1328;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1347;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    /* EXEC SQL AT :db_link_name COMMIT WORK; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1370;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1389;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1412;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    return DB_SUCCESS;
}

/*================================================================
*
* 函 数 名：Save_User_Msg
** 保存用户的消息，包括系统消息
* 参 数：
* uint32 iRecvID    [IN] : 家族ID
* uint32 iSendID        [IN] : 发送者ID
* uint32 iNatIP,uint16 iNatPort,uint32 iTime [IN]
* uint16 iMsgType       [IN] : 消息类型
* char   *strMsg        [IN] : 消息内容
* uint16     iMsgLen        [IN] : 内容长度
* 返 回 值：int -   SUCCESS: DB_SUCCESS; 数据库错误:DB_ERROR;
*
================================================================*/
int CDatabaseMini::Save_User_Msg(uint32 iRecvID,uint32 iSendID,uint32 iNatIP,uint16 iNatPort,uint32 iTime,uint16 iMsgType,const char *strMsg, uint16 iMsgLen,const char *strText)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw * lvr;
        unsigned int    nRecvID,nSendID, nTime,nMsgLen;
        unsigned int    int_tmp,natip;
        short   natport,nMsgType;
        char*   pmsg;
        OCIBlobLocator *blob;
        unsigned int offset = 1;  /* attention: typedef ub4 unsigned int */
        /* VARCHAR db_link_name[32], var_text[1315]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

struct { unsigned short len; unsigned char arr[1315]; } var_text;

        /* VARCHAR var_fromname[41], var_toname[41]; */ 
struct { unsigned short len; unsigned char arr[41]; } var_fromname;

struct { unsigned short len; unsigned char arr[41]; } var_toname;

    /* EXEC SQL END DECLARE SECTION; */ 

    CLog::Log("Save_User_Msg",CLog::TYPE_DEBUG,"iRecvID is %d,iSendID is %d,iNatIP is %d,iNatPort is %d,iTime is %d,iMsgType is %d,strMsg is %s,iMsgLen is %d,strText is %s",
              iRecvID,iSendID,iNatIP,iNatPort,iTime,iMsgType,strMsg,iMsgLen,strText);
    if( !strMsg )
    {
        CLog::Log("Save_User_Msg",CLog::TYPE_DEBUG,"strMsg is NULL");
        return DB_PARAM;
    }
    if(strlen(strText) == 0 )
    {
        CLog::Log("Save_User_Msg",CLog::TYPE_DEBUG,"strText len is 0");
        return DB_PARAM;
    }
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    SET_INIT_NULL(var_text);
    SET_INIT_NULL(var_fromname);
    SET_INIT_NULL(var_toname);

    nRecvID = iRecvID;
    nSendID = iSendID;
    nTime = iTime;
    nMsgLen = iMsgLen;
    nMsgType = iMsgType;
    pmsg = (char*)strMsg;
    strncpy((char *)var_text.arr,strText,1315);
    var_text.len=(unsigned short)strlen(strText);
    natport = iNatPort;
    natip = iNatIP;
    //delline = 3;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )1431;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    if( nMsgType == CMD_P2PMSG_SEND )
    {
        /* EXEC SQL AT :db_link_name SELECT COUNT(MSGID) INTO :int_tmp FROM IM_OFFLINETALKMSG
        WHERE RECEIVER=:nRecvID; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select count(MSGID) into :b1  from IM_OFFLINETALKMSG\
 where RECEIVER=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1454;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&nRecvID;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1481;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }

        if (db_ret == 1403)
            int_tmp = 0;

        if( int_tmp >= OFFLINE_MAX_MSGNUM  && nRecvID != MANAGER_ID)
        {
            /* EXEC SQL AT :db_link_name DELETE FROM IM_OFFLINETALKMSG WHERE  MSGID=(SELECT Min(MSGID) FROM IM_OFFLINETALKMSG WHERE RECEIVER=:nRecvID); */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "delete  from IM_OFFLINETALKMSG  where MSGID=(sel\
ect min(MSGID)  from IM_OFFLINETALKMSG where RECEIVER=:b1)";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1504;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&nRecvID;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            db_ret = sqlca.sqlcode;
            if (conn_error(db_ret))
            {
                iReconnTimes=0;
                bReconn=ConnectDB();
                while(!bReconn)
                {
                    iReconnTimes++;
                    sleep(iReconnTimes%10);
                    bReconn=ConnectDB();
                }
                goto start;
            }

            if( db_ret < 0  )
            {
                sql_error(sqlca, oraca);
                /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )1527;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&blob;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[1] = (unsigned long )34;
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )1550;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                return DB_ERROR;
            }
            /* EXEC SQL AT :db_link_name COMMIT; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1569;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        }

        /* EXEC SQL AT :db_link_name select nickname into :var_fromname from im_userinfo where userid=:nSendID; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select nickname into :b1  from im_userinfo where use\
rid=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1588;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&var_fromname;
        sqlstm.sqhstl[0] = (unsigned long )43;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&nSendID;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name select nickname into :var_toname from im_userinfo where userid=:nRecvID; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select nickname into :b1  from im_userinfo where use\
rid=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1615;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&var_toname;
        sqlstm.sqhstl[0] = (unsigned long )43;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&nRecvID;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name SELECT IM_OFFLINETALKMSG_SEQ_MSGID.nextval into :int_tmp FROM DUAL; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select IM_OFFLINETALKMSG_SEQ_MSGID.nextval  into :b1\
  from DUAL ";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1642;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* 如果要用IM服务器时间，则 sendtime=cast(from_tz(to_timestamp ('19700101000000', 'yyyymmddhh24miss')+ numtodsinterval(:nTime, 'second'), 'gmt') at time zone sessiontimezone as date) */
        /* EXEC SQL AT :db_link_name INSERT INTO IM_OFFLINETALKMSG(MSGID, RECEIVER,SENDER,SRCIP,SRCPORT,SENDTIME,
        MSGTYPE,MSGLEN,MSG,TEXT,SenderName,ReceiverName)
        VALUES(:int_tmp, :nRecvID,:nSendID,:natip,:natport,sysdate,
        :nMsgType,:nMsgLen,empty_blob(),:var_text,:var_fromname,:var_toname); */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "insert into IM_OFFLINETALKMSG (MSGID,RECEIVER,SENDER\
,SRCIP,SRCPORT,SENDTIME,MSGTYPE,MSGLEN,MSG,TEXT,SenderName,ReceiverName) valu\
es (:b1,:b2,:b3,:b4,:b5,sysdate,:b6,:b7,empty_blob(),:b8,:b9,:b10)";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1665;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&nRecvID;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&nSendID;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&natip;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&natport;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&nMsgType;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&nMsgLen;
        sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&var_text;
        sqlstm.sqhstl[7] = (unsigned long )1317;
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqhstv[8] = (unsigned char  *)&var_fromname;
        sqlstm.sqhstl[8] = (unsigned long )43;
        sqlstm.sqhsts[8] = (         int  )0;
        sqlstm.sqindv[8] = (         short *)0;
        sqlstm.sqinds[8] = (         int  )0;
        sqlstm.sqharm[8] = (unsigned long )0;
        sqlstm.sqadto[8] = (unsigned short )0;
        sqlstm.sqtdso[8] = (unsigned short )0;
        sqlstm.sqhstv[9] = (unsigned char  *)&var_toname;
        sqlstm.sqhstl[9] = (unsigned long )43;
        sqlstm.sqhsts[9] = (         int  )0;
        sqlstm.sqindv[9] = (         short *)0;
        sqlstm.sqinds[9] = (         int  )0;
        sqlstm.sqharm[9] = (unsigned long )0;
        sqlstm.sqadto[9] = (unsigned short )0;
        sqlstm.sqtdso[9] = (unsigned short )0;
        sqlstm.sqhstv[10] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[10] = (unsigned long )34;
        sqlstm.sqhsts[10] = (         int  )0;
        sqlstm.sqindv[10] = (         short *)0;
        sqlstm.sqinds[10] = (         int  )0;
        sqlstm.sqharm[10] = (unsigned long )0;
        sqlstm.sqadto[10] = (unsigned short )0;
        sqlstm.sqtdso[10] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 || db_ret == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1724;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1747;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
        /* EXEC SQL AT :db_link_name COMMIT; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1766;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



        /* EXEC SQL AT :db_link_name SELECT MSG INTO :blob  FROM IM_OFFLINETALKMSG
        WHERE MSGID = :int_tmp FOR UPDATE; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select MSG into :b1  from IM_OFFLINETALKMSG where MS\
GID=:b2 for update ";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1785;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( sqlca.sqlcode < 0 || sqlca.sqlcode == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1812;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1835;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
    }
    else
    {
        /* EXEC SQL AT :db_link_name SELECT COUNT(MSGID) INTO :int_tmp FROM IM_OFFLINESYSMSG
        WHERE RECEIVER=:nRecvID; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select count(MSGID) into :b1  from IM_OFFLINESYSMSG \
where RECEIVER=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1854;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&nRecvID;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1881;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
        if( int_tmp >= OFFLINE_MAX_MSGNUM )
        {
            /* EXEC SQL AT :db_link_name DELETE FROM IM_OFFLINESYSMSG WHERE  MSGID=(SELECT Min(MSGID) FROM IM_OFFLINESYSMSG WHERE RECEIVER=:nRecvID); */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "delete  from IM_OFFLINESYSMSG  where MSGID=(sele\
ct min(MSGID)  from IM_OFFLINESYSMSG where RECEIVER=:b1)";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1904;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&nRecvID;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            db_ret = sqlca.sqlcode;
            if (conn_error(db_ret))
            {
                iReconnTimes=0;
                bReconn=ConnectDB();
                while(!bReconn)
                {
                    iReconnTimes++;
                    sleep(iReconnTimes%10);
                    bReconn=ConnectDB();
                }
                goto start;
            }

            if( db_ret < 0 )
            {
                sql_error(sqlca, oraca);
                /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )1927;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&blob;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[1] = (unsigned long )34;
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )1950;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                return DB_ERROR;
            }
            /* EXEC SQL AT :db_link_name COMMIT; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )1969;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        }

        /* EXEC SQL AT :db_link_name SELECT IM_OFFLINESYSMSG_SEQ_MSGID.nextval into :int_tmp FROM DUAL; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select IM_OFFLINESYSMSG_SEQ_MSGID.nextval  into :b1 \
 from DUAL ";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )1988;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



        /* EXEC SQL AT :db_link_name INSERT INTO IM_OFFLINESYSMSG(MSGID, RECEIVER,SENDER,SRCIP,SRCPORT,SENDTIME,MSGTYPE,MSGLEN,MSG)
        VALUES(:int_tmp, :nRecvID,:nSendID,:natip,:natport,:nTime,:nMsgType,:nMsgLen,empty_blob()); */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "insert into IM_OFFLINESYSMSG (MSGID,RECEIVER,SENDER,\
SRCIP,SRCPORT,SENDTIME,MSGTYPE,MSGLEN,MSG) values (:b1,:b2,:b3,:b4,:b5,:b6,:b\
7,:b8,empty_blob())";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2011;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&nRecvID;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&nSendID;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&natip;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&natport;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&nTime;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&nMsgType;
        sqlstm.sqhstl[6] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&nMsgLen;
        sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqhstv[8] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[8] = (unsigned long )34;
        sqlstm.sqhsts[8] = (         int  )0;
        sqlstm.sqindv[8] = (         short *)0;
        sqlstm.sqinds[8] = (         int  )0;
        sqlstm.sqharm[8] = (unsigned long )0;
        sqlstm.sqadto[8] = (unsigned short )0;
        sqlstm.sqtdso[8] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 || db_ret == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2062;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2085;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
        /* EXEC SQL AT :db_link_name COMMIT; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2104;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



        /* EXEC SQL AT :db_link_name SELECT MSG INTO :blob  FROM IM_OFFLINESYSMSG
        WHERE MSGID = :int_tmp FOR UPDATE; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select MSG into :b1  from IM_OFFLINESYSMSG where MSG\
ID=:b2 for update ";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2123;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 || db_ret == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2150;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2173;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
    }

    lvr = (long_varraw *)malloc(sizeof(ub4) + nMsgLen);
    lvr->len = nMsgLen;
    memcpy(lvr->buf,pmsg,nMsgLen);
    /* EXEC SQL AT :db_link_name LOB WRITE ONE :nMsgLen
        FROM :lvr WITH LENGTH :nMsgLen INTO :blob AT :offset; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2192;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)lvr;
    sqlstm.sqhstl[1] = (unsigned long )4;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&blob;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&offset;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 || db_ret == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2231;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2254;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        free(lvr);
        return DB_ERROR;
    }
    free(lvr);

    if( nMsgType == CMD_P2PMSG_SEND )
    {
        /* EXEC SQL AT :db_link_name UPDATE IM_OFFLINETALKMSG SET MSG = :blob
        WHERE MSGID = :int_tmp; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "update IM_OFFLINETALKMSG  set MSG=:b1 where MSGID=:b\
2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2273;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 || db_ret == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2300;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2323;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
        /* EXEC SQL AT :db_link_name COMMIT; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2342;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    }
    else
    {
        /* EXEC SQL AT :db_link_name UPDATE IM_OFFLINESYSMSG SET MSG = :blob
        WHERE MSGID = :int_tmp; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "update IM_OFFLINESYSMSG  set MSG=:b1 where MSGID=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2361;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 || db_ret == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2388;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2411;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
    }

    /* EXEC SQL AT :db_link_name COMMIT WORK; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2430;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2449;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2472;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    return DB_SUCCESS;
}

/*================================================================
*
* 函 数 名：Delete_Family_Msg
** 删除家族的消息
* 参 数：
const uint32 iFamilyID  [IN] : 删除家族
* 返 回 值：int -   SUCCESS: DB_SUCCESS; 操作失败: DB_ERROR;
*
================================================================*/
int CDatabaseMini::Delete_Family_Msg(const uint32 iFamilyID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int      nFamilyID;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    nFamilyID       = iFamilyID;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.DeleteFamilyMsg(:nFamilyID,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . DeleteFamilyMsg ( :nFamilyID , :r\
etcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2491;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nFamilyID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    return DB_SUCCESS;

}
int CDatabaseMini::Delete_FamilyMem_RecvMsg(const uint32 iFamilyID, uint32 iUserID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int      nFamilyID, nUserID;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    nFamilyID       = iFamilyID;
    nUserID         = iUserID;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.DeleteFamilyMemRecvMsg(:nFamilyID,:nUserID,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . DeleteFamilyMemRecvMsg ( :nFamily\
ID , :nUserID , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2518;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nFamilyID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&nUserID;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    return DB_SUCCESS;
}

/*================================================================
*
* 函 数 名：Save_Family_Msg
** 保存家族请求消息ID获取当前家族最大消息ID
* 参 数：
* uint32 familyMsgID    [IN] : 家族消息ID
* uint32 familyID       [IN] : 家族ID
* uint32 senderID       [IN] : 发送者ID
* uint32 tm             [IN] : 发送时间
* int    msgType        [IN] : 消息类型
* char   *msg           [IN] : 消息内容
* int    msgLen         [IN] : 内容长度
* 返 回 值：int -   SUCCESS: DB_SUCCESS; 数据库错误:DB_ERROR;
*
================================================================*/
int CDatabaseMini::Save_Family_Msg(uint32 familyMsgID,uint32 familyID,uint32 senderID, int tm, int msgType,int msgLen,char *msg)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw * lvr;
        unsigned int    cid,sno;
        int             time,msglen;
        unsigned int int_tmp, cmid, minmsgid;
        unsigned int natip;
        short   natport,msgtype;
        char*   pmsg;
        OCIBlobLocator *blob;
        unsigned int offset = 1;  /* attention: typedef ub4 unsigned int */
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int_tmp = 0;

    cmid = familyMsgID;
    cid = familyID;
    sno = senderID;
    natip = 0;
    natport = 0;
    time = tm;
    msglen = msgLen;
    msgtype = msgType;
    pmsg = msg;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2549;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name SELECT COUNT(MSGID) INTO :int_tmp FROM IM_CLUSTERTALKMSG
       WHERE CLUSTERID=:cid; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select count(MSGID) into :b1  from IM_CLUSTERTALKMSG whe\
re CLUSTERID=:b2";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2572;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( sqlca.sqlcode < 0 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2599;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    bool isupdate = false;
    if( int_tmp >= FAMILE_MAX_MSGNUM )
    {
        /* EXEC SQL AT :db_link_name SELECT MIN(MSGID) INTO :minmsgid FROM IM_CLUSTERTALKMSG
        WHERE CLUSTERID=:cid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select min(MSGID) into :b1  from IM_CLUSTERTALKMSG w\
here CLUSTERID=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2622;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&minmsgid;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&cid;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret < 0)
        {
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2649;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
        isupdate = true;
    }

    /* EXEC SQL AT :db_link_name SELECT MAX(MSGID) INTO :int_tmp FROM IM_CLUSTERTALKMSG
       WHERE CLUSTERID=:cid; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select max(MSGID) into :b1  from IM_CLUSTERTALKMSG where\
 CLUSTERID=:b2";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2672;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if ((db_ret < 0 && db_ret != -1405) || db_ret == 1403)
    {
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2699;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }
    if (db_ret == -1405)
        int_tmp = 1;

    if (isupdate == false)
    {
        /* EXEC SQL AT :db_link_name INSERT INTO IM_CLUSTERTALKMSG(MSGID,CLUSTERID,SENDER,SRCIP,SRCPORT,SENDTIME,MSGTYPE,MSGLEN,MSG)
        VALUES(:cmid,:cid,:sno,:natip,:natport,:time,:msgtype,:msglen,empty_blob()); */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "insert into IM_CLUSTERTALKMSG (MSGID,CLUSTERID,SENDE\
R,SRCIP,SRCPORT,SENDTIME,MSGTYPE,MSGLEN,MSG) values (:b1,:b2,:b3,:b4,:b5,:b6,\
:b7,:b8,empty_blob())";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2722;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cmid;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&cid;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&sno;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&natip;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&natport;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&time;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&msgtype;
        sqlstm.sqhstl[6] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqhstv[8] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[8] = (unsigned long )34;
        sqlstm.sqhsts[8] = (         int  )0;
        sqlstm.sqindv[8] = (         short *)0;
        sqlstm.sqinds[8] = (         int  )0;
        sqlstm.sqharm[8] = (unsigned long )0;
        sqlstm.sqadto[8] = (unsigned short )0;
        sqlstm.sqtdso[8] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( sqlca.sqlcode < 0 || sqlca.sqlcode == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2773;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2792;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
        /* EXEC SQL AT :db_link_name COMMIT; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2815;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    }
    else
    {
        /* EXEC SQL AT :db_link_name UPDATE IM_CLUSTERTALKMSG
          SET MSGID=:cmid,SENDER=:sno,SRCIP=:natip,SRCPORT=:natport,SENDTIME=:time,MSGTYPE=:msgtype,MSGLEN=:msglen,MSG=empty_blob()
          where MSGID = :minmsgid and CLUSTERID = :cid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "update IM_CLUSTERTALKMSG  set MSGID=:b1,SENDER=:b2,S\
RCIP=:b3,SRCPORT=:b4,SENDTIME=:b5,MSGTYPE=:b6,MSGLEN=:b7,MSG=empty_blob() whe\
re (MSGID=:b8 and CLUSTERID=:b9)";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2834;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cmid;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&sno;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&natip;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&natport;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&time;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&msgtype;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&minmsgid;
        sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqhstv[8] = (unsigned char  *)&cid;
        sqlstm.sqhstl[8] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[8] = (         int  )0;
        sqlstm.sqindv[8] = (         short *)0;
        sqlstm.sqinds[8] = (         int  )0;
        sqlstm.sqharm[8] = (unsigned long )0;
        sqlstm.sqadto[8] = (unsigned short )0;
        sqlstm.sqtdso[8] = (unsigned short )0;
        sqlstm.sqhstv[9] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[9] = (unsigned long )34;
        sqlstm.sqhsts[9] = (         int  )0;
        sqlstm.sqindv[9] = (         short *)0;
        sqlstm.sqinds[9] = (         int  )0;
        sqlstm.sqharm[9] = (unsigned long )0;
        sqlstm.sqadto[9] = (unsigned short )0;
        sqlstm.sqtdso[9] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( sqlca.sqlcode < 0 || sqlca.sqlcode == 1403 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2889;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )2908;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return DB_ERROR;
        }
        /* EXEC SQL AT :db_link_name COMMIT; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2931;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    }

    /* EXEC SQL AT :db_link_name SELECT MSG INTO :blob  FROM IM_CLUSTERTALKMSG
       WHERE MSGID=:cmid AND CLUSTERID=:cid FOR UPDATE; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select MSG into :b1  from IM_CLUSTERTALKMSG where (MSGID\
=:b2 and CLUSTERID=:b3) for update ";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )2950;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cmid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&cid;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( sqlca.sqlcode < 0 || sqlca.sqlcode == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )2981;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3000;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        if( db_ret == -2112)
        {
            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )3023;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name delete IM_CLUSTERTALKMSG t where rowid > (
            select min(rowid) from IM_CLUSTERTALKMSG y where t.MSGID=y.msgid and t.CLUSTERID=y.clusterid ); */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "delete  from IM_CLUSTERTALKMSG t  where rowid>(s\
elect min(rowid)  from IM_CLUSTERTALKMSG y where (t.MSGID=y.msgid and t.CLUST\
ERID=y.clusterid))";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )3042;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name SELECT MSG INTO :blob  FROM IM_CLUSTERTALKMSG
            WHERE MSGID=:cmid AND CLUSTERID=:cid FOR UPDATE; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "select MSG into :b1  from IM_CLUSTERTALKMSG wher\
e (MSGID=:b2 and CLUSTERID=:b3) for update ";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )3061;
            sqlstm.selerr = (unsigned short)1;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&cmid;
            sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqhstv[2] = (unsigned char  *)&cid;
            sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[2] = (         int  )0;
            sqlstm.sqindv[2] = (         short *)0;
            sqlstm.sqinds[2] = (         int  )0;
            sqlstm.sqharm[2] = (unsigned long )0;
            sqlstm.sqadto[2] = (unsigned short )0;
            sqlstm.sqtdso[2] = (unsigned short )0;
            sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[3] = (unsigned long )34;
            sqlstm.sqhsts[3] = (         int  )0;
            sqlstm.sqindv[3] = (         short *)0;
            sqlstm.sqinds[3] = (         int  )0;
            sqlstm.sqharm[3] = (unsigned long )0;
            sqlstm.sqadto[3] = (unsigned short )0;
            sqlstm.sqtdso[3] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        }
        else
            return DB_ERROR;
    }

    lvr = (long_varraw *)malloc(sizeof(ub4) + msglen);
    lvr->len = msglen;
    memcpy(lvr->buf,pmsg,msglen);
    /* EXEC SQL AT :db_link_name LOB WRITE ONE :msglen
        FROM :lvr WITH LENGTH :msglen INTO :blob AT :offset; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3092;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&msglen;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)lvr;
    sqlstm.sqhstl[1] = (unsigned long )4;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&msglen;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&blob;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&offset;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( sqlca.sqlcode < 0 || sqlca.sqlcode == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3131;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3150;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        free(lvr);
        return DB_ERROR;
    }

    free(lvr);

    /* EXEC SQL AT :db_link_name UPDATE IM_CLUSTERTALKMSG SET MSG = :blob
       WHERE MSGID=:cmid AND CLUSTERID=:cid; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "update IM_CLUSTERTALKMSG  set MSG=:b1 where (MSGID=:b2 a\
nd CLUSTERID=:b3)";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3173;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cmid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&cid;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( sqlca.sqlcode < 0 || sqlca.sqlcode == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3204;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3223;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    /* EXEC SQL AT :db_link_name COMMIT WORK; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3246;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3265;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3288;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    return DB_SUCCESS;
}

int CDatabaseMini::Get_User_OnlineTime(uint32 iUserID,uint32 &OnlineTime)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int    nUserID;
        double          timelen;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);
    nUserID = iUserID;
    timelen = 0;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.GetUserOnlineTime(:nUserID,:timelen,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetUserOnlineTime ( :nUserID , :t\
imelen , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3307;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nUserID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&timelen;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(double);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if ((db_ret < 0  && db_ret != -1405)) //出错
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    OnlineTime = (uint32)timelen;
    return DB_SUCCESS;
}

/*================================================================
*
* 函 数 名：Add_Group
** 添加分组
* 参 数：
* uint32 iUserID [[IN]] : 用户ID
* uint8 &iGroupID [IN,OUT]: 组ID，输入指定的ID。输出数据库中存储的ID
* char * strGroupName   [IN] : 组名
* 返 回 值：int -   SUCCESS: DB_SUCCESS; 数据库错误:DB_ERROR;  用所能创建的组已满：DB_GROUP_FULL; 组名已经存在:DB_GROUP_EXIST;
*
================================================================*/
int CDatabaseMini::Add_Group(uint32 iUserID, uint8 &iGroupID, char * strGroupName, uint8 &iGroupPid)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_groupname[21]; */ 
struct { unsigned short len; unsigned char arr[21]; } var_groupname;

        unsigned int nUserID;
        int     g_id;
        int     g_pid;
        int     retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    SET_INIT_NULL(var_groupname);
    nUserID = iUserID;
    g_id = iGroupID;
    g_pid = iGroupPid;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    if( strlen(strGroupName) > 20 )
        return DB_PARAM;

    strncpy((char*)var_groupname.arr, strGroupName,MAX_GROUPNAME_LEN);
    var_groupname.len = (unsigned short)strlen(strGroupName);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
    begin
       Mini_Local_Pkg.AddGroup(:nUserID,:g_id,:var_groupname,:g_pid,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . AddGroup ( :nUserID , :g_id , :va\
r_groupname , :g_pid , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3338;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nUserID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&g_id;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_groupname;
    sqlstm.sqhstl[2] = (unsigned long )23;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&g_pid;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if ( db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    if( retcode == DB_GROUP_FULL )
        return DB_GROUP_FULL;

    if( retcode == DB_GROUP_EXIST )
        return DB_GROUP_EXIST;

    return DB_SUCCESS;
}

int CDatabaseMini::Mod_Cust_Info(uint32 id, char* account, char* time)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_account[40]; */ 
struct { unsigned short len; unsigned char arr[40]; } var_account;

        /* VARCHAR var_time[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } var_time;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        unsigned int nID;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    SET_INIT_NULL(var_account);
    SET_INIT_NULL(var_time);
    nID = id;

    var_account.len = (unsigned short)strlen(account);
    strncpy((char*)var_account.arr,account,MAX_CUST_ACCOUNT_LEN);

    var_time.len = (unsigned short)strlen(time);
    strncpy((char*)var_time.arr,time,MAX_CUST_TIME_LEN);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.ModifyCustInfo(:nID,:var_account,:var_time,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . ModifyCustInfo ( :nID , :var_acco\
unt , :var_time , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3377;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_account;
    sqlstm.sqhstl[1] = (unsigned long )42;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_time;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    if (retcode == 1)
        return DB_ERROR;

    return DB_SUCCESS;
}


int CDatabaseMini::Mod_Cust_Remark(uint32 id, char* account, char* time,char* remark)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_account[40]; */ 
struct { unsigned short len; unsigned char arr[40]; } var_account;

        /* VARCHAR var_time[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } var_time;

        /* VARCHAR var_remark[201]; */ 
struct { unsigned short len; unsigned char arr[201]; } var_remark;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        unsigned int nID;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    SET_INIT_NULL(var_account);
    SET_INIT_NULL(var_time);
    SET_INIT_NULL(var_remark);

    nID = id;

    var_account.len = (unsigned short)strlen(account);
    strncpy((char*)var_account.arr,account,MAX_CUST_ACCOUNT_LEN);

    var_time.len = (unsigned short)strlen(time);
    strncpy((char*)var_time.arr,time,MAX_CUST_TIME_LEN);

    var_remark.len = (unsigned short)strlen(remark);
    strncpy((char*)var_remark.arr,remark,MAX_CUST_REMAKE_LEN);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.ModifyCustRemark(:nID,:var_account,:var_time,:var_remark,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . ModifyCustRemark ( :nID , :var_ac\
count , :var_time , :var_remark , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3412;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_account;
    sqlstm.sqhstl[1] = (unsigned long )42;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_time;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&var_remark;
    sqlstm.sqhstl[3] = (unsigned long )203;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("CBusinessModCustRemark", CLog::TYPE_DEBUG, "id:%d, db_ret:%d, retcode:%d", id, db_ret, retcode);

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    if (retcode == 1)
        return DB_ERROR;

    return DB_SUCCESS;
}




int CDatabaseMini::Get_Cust_Remark(uint32 id, char* account, char* time, char* remark)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        /* VARCHAR var_account[40]; */ 
struct { unsigned short len; unsigned char arr[40]; } var_account;

        /* VARCHAR var_time[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } var_time;

        /* VARCHAR var_remark[201]; */ 
struct { unsigned short len; unsigned char arr[201]; } var_remark;

        unsigned int nID;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    strncpy((char*)var_account.arr, account,MAX_CUST_ACCOUNT_LEN);
    var_account.len = (short)strlen(account);

    nID=id;

    SET_INIT_NULL(var_time);
    SET_INIT_NULL(var_remark);

    int db_ret, iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.GetCustRemark(:nID,:var_account,:var_time,:var_remark,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetCustRemark ( :nID , :var_accou\
nt , :var_time , :var_remark , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3451;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_account;
    sqlstm.sqhstl[1] = (unsigned long )42;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_time;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&var_remark;
    sqlstm.sqhstl[3] = (unsigned long )203;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}




    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("CDatabaseMini::Get_Cust_Remark", CLog::TYPE_DEBUG, "id:%d, db_ret:%d, retcode:%d",id, db_ret, retcode);

    if( db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    if (retcode == 1)
    {
        return DB_ERROR;
    }

    strncpy(time,(char*)var_time.arr,32);
    strncpy(remark,(char*)var_remark.arr,MAX_CUST_REMAKE_LEN);

    return DB_SUCCESS;
}




int CDatabaseMini::Get_Cust_Num(uint32 id, char* btime, char* etime, uint32& nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        /* VARCHAR var_btime[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } var_btime;

        /* VARCHAR var_etime[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } var_etime;

        unsigned int nID, nCount;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    strncpy((char*)var_btime.arr, btime,32);
    var_btime.len = (short)strlen(btime);

    strncpy((char*)var_etime.arr, etime,32);
    var_etime.len = (short)strlen(etime);

    nID=id;
    nCount=nRetCount;

    int db_ret, iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.GetCustNum(:nID,:var_btime,:var_etime,:nCount,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetCustNum ( :nID , :var_btime , \
:var_etime , :nCount , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3490;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_btime;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_etime;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&nCount;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    if (retcode == 1)
        return DB_ERROR;

    nRetCount=nCount;
    return DB_SUCCESS;
}

int CDatabaseMini::Get_Cust_Info(uint32 id, char* btime, char* etime, uint32 count, uint16 start_pos, uint16 iNeedCustCount, uint8 bDirect, XT_GET_NEAR_COMM_CUST_ACK::TagCommInfo* CliInfo, uint32& nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32],var_btime[32],var_etime[32],var_account[40],var_conntime[32],var_orderid[64],var_comment[128]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

struct { unsigned short len; unsigned char arr[32]; } var_btime;

struct { unsigned short len; unsigned char arr[32]; } var_etime;

struct { unsigned short len; unsigned char arr[40]; } var_account;

struct { unsigned short len; unsigned char arr[32]; } var_conntime;

struct { unsigned short len; unsigned char arr[64]; } var_orderid;

struct { unsigned short len; unsigned char arr[128]; } var_comment;

        unsigned int nID,nMaxCount,nPos,nCount,nDirect;
        int retcode;
        SQL_CURSOR cur_cliInfo;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    strncpy((char*)var_btime.arr, btime,32);
    var_btime.len = (short)strlen(btime);

    strncpy((char*)var_etime.arr, etime,32);
    var_etime.len = (short)strlen(etime);

    nID=id;
    nMaxCount=count;
    nPos=start_pos;
    nCount=iNeedCustCount;
    nDirect=bDirect;
    SET_INIT_NULL(var_account);
    SET_INIT_NULL(var_conntime);
    SET_INIT_NULL(var_orderid);
    SET_INIT_NULL(var_comment);

    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3529;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_Local_Pkg.GetCustInfo(:nID,:var_btime,:var_etime,:nMaxCount,:nPos,:nCount,:nDirect,:cur_cliInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetCustInfo ( :nID , :var_btime ,\
 :var_etime , :nMaxCount , :nPos , :nCount , :nDirect , :cur_cliInfo , :retco\
de ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3548;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_btime;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_etime;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&nMaxCount;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&nPos;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&nCount;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&nDirect;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqhstv[8] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[8] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[8] = (         int  )0;
    sqlstm.sqindv[8] = (         short *)0;
    sqlstm.sqinds[8] = (         int  )0;
    sqlstm.sqharm[8] = (unsigned long )0;
    sqlstm.sqadto[8] = (unsigned short )0;
    sqlstm.sqtdso[8] = (unsigned short )0;
    sqlstm.sqhstv[9] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[9] = (unsigned long )34;
    sqlstm.sqhsts[9] = (         int  )0;
    sqlstm.sqindv[9] = (         short *)0;
    sqlstm.sqinds[9] = (         int  )0;
    sqlstm.sqharm[9] = (unsigned long )0;
    sqlstm.sqadto[9] = (unsigned short )0;
    sqlstm.sqtdso[9] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3603;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("Get_Cust_Info",CLog::TYPE_DEBUG,"id:%d, db_ret:%d, retcode:%d ",id, db_ret, retcode);

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3622;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3641;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {
        /* EXEC SQL FETCH :cur_cliInfo INTO :var_account,:var_conntime,:var_orderid,:var_comment; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3660;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&var_account;
        sqlstm.sqhstl[1] = (unsigned long )42;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&var_conntime;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&var_orderid;
        sqlstm.sqhstl[3] = (unsigned long )66;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&var_comment;
        sqlstm.sqhstl[4] = (unsigned long )130;
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            nRetCount = iNum;
            break;
        }
        if (iNum >= nRetCount)
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            nRetCount = iNum;
            break;
        }
        SET_END_NULL(var_account);
        SET_END_NULL(var_conntime);
        SET_END_NULL(var_orderid);
        SET_END_NULL(var_comment);

        strncpy(CliInfo[iNum].szCommAccount,(char*)var_account.arr,MAX_CUST_ACCOUNT_LEN);
        strncpy(CliInfo[iNum].szCommTime,(char*)var_conntime.arr,MAX_CUST_TIME_LEN);
        strncpy(CliInfo[iNum].szTransInfo,(char*)var_orderid.arr,MAX_CUST_ORDER_LEN);
        strncpy(CliInfo[iNum].szRemarks,(char*)var_comment.arr,MAX_CUST_REMAKE_LEN);

        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3695;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3714;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::Modify_Group(uint32 iUserID, uint8 iGroupID, char *strGroupName)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_groupname[21]; */ 
struct { unsigned short len; unsigned char arr[21]; } var_groupname;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        unsigned int     nUserID;
        int     g_id;
        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 

    SET_INIT_NULL(var_groupname);
    nUserID = iUserID;
    g_id = iGroupID;
    if( strlen(strGroupName) > 20 )
        return DB_PARAM;
    var_groupname.len = (unsigned short)strlen(strGroupName);
    strncpy((char*)var_groupname.arr,strGroupName,MAX_GROUPNAME_LEN);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.ModifyGroup(:nUserID,:g_id,:var_groupname,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . ModifyGroup ( :nUserID , :g_id , \
:var_groupname , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3733;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nUserID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&g_id;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_groupname;
    sqlstm.sqhstl[2] = (unsigned long )23;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    if (retcode == DB_GROUP_EXIST)
        return DB_GROUP_EXIST;

    return DB_SUCCESS;
}

int CDatabaseMini::Delete_Group(uint32 iUserID, uint8 iGroupID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int     nUserID;
        int g_id;
        int      retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    nUserID = iUserID;
    g_id = iGroupID;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.DeleteGroup(:nUserID,:g_id,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . DeleteGroup ( :nUserID , :g_id , \
:retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3768;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nUserID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&g_id;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    return DB_SUCCESS;
}

int CDatabaseMini::Save_User_Login(uint32 userid,uint32 userip, uint16 userport, int serverno)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int clientno;
        unsigned int clientip;
        int thissrvno;
        short clientport;
        int      retcode;
        /* VARCHAR nowdate[24]; */ 
struct { unsigned short len; unsigned char arr[24]; } nowdate;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);
    SET_INIT_NULL(nowdate);

    if (userid ==0)
        return DB_PARAM;
    clientno = userid;
    clientip = userip;
    thissrvno = serverno;
    char strTime[20];
    time_t ntm;
    time(&ntm);
    struct tm *newtime;
    newtime = localtime(&ntm);
    sprintf(strTime, "%d-%d-%d", newtime->tm_year + 1900, newtime->tm_mon + 1, newtime->tm_mday);
    strncpy((char*)nowdate.arr, strTime,19);
    nowdate.len = (short)strlen((char*)nowdate.arr);
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveUserLogin(:clientno,:clientip,:clientport,:thissrvno,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveUserLogin ( :clientno , :clie\
ntip , :clientport , :thissrvno , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3799;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clientno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&clientip;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&clientport;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(short);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&thissrvno;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }


    return DB_SUCCESS;
}

int CDatabaseMini::Save_User_Logout(uint32 userid)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int clientno;
        int      retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    if (userid ==0)
        return DB_PARAM;
    clientno = userid;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveUserLogout(:clientno,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveUserLogout ( :clientno , :ret\
code ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3838;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clientno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    return DB_SUCCESS;
}

int CDatabaseMini::Update_All_Logout(int serverno)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        int v_serverno;
        int retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    SET_INIT_NULL(db_link_name);
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    v_serverno = serverno;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.UpdateAllLogout(:v_serverno,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . UpdateAllLogout ( :v_serverno , :\
retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3865;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&v_serverno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    return DB_SUCCESS;
}

int CDatabaseMini::Save_User_Action(uint32 userid,XT_USER_ACTION_AUDIT_REQ::Action *action,uint16 count)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int clientno,actionno;
        int actioncount;
        int      retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    if (userid <=0)
        return 1;

    clientno = userid;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    for(int i = 0; i < count; ++i)
    {
        actionno = action[i].OpeId;
        actioncount = action[i].count;

        /* EXEC SQL AT :db_link_name EXECUTE
        begin
          Mini_Local_Pkg.SaveUserAction(:clientno,:actionno,:actioncount,:retcode);
        end;
        END-EXEC; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "begin Mini_Local_Pkg . SaveUserAction ( :clientno , \
:actionno , :actioncount , :retcode ) ; end ;";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )3892;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&clientno;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&actionno;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&actioncount;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[4] = (unsigned long )34;
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 )
        {
            sql_error(sqlca, oraca);
            continue;
        }
    }

    return DB_SUCCESS;
}

int CDatabaseMini::Save_User_Timelen(uint32 userid, int logintm, int logouttm)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int        clientno,onlinetm;
        int      retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    clientno = userid;

    CTime intm(logintm);
    CTime outtm(logouttm);

    onlinetm = 0;

    if ( intm.GetDay() == outtm.GetDay())
    {
        onlinetm = (unsigned int)(logouttm - logintm)/60;   //按分钟记时
    }
    else
    {
        onlinetm = outtm.GetHour() * 60 + outtm.GetMinute();
        onlinetm = onlinetm + (24*60-intm.GetHour()*60-intm.GetMinute());
    }
    if(onlinetm ==0)
        return DB_SUCCESS;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveUserTimelen(:clientno,:onlinetm,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveUserTimelen ( :clientno , :on\
linetm , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3927;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clientno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&onlinetm;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret < 0 && db_ret != -1405) //出错
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    return DB_SUCCESS;
}

int CDatabaseMini::Save_Merchant_Login(uint32 userid,int logintm)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int merchantid,thisintm;
        int      retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    merchantid = userid;
    thisintm = logintm;
    if (userid ==0)
        return DB_PARAM;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveMerchantLogin(:merchantid,:thisintm,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveMerchantLogin ( :merchantid ,\
 :thisintm , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3958;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&merchantid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&thisintm;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )3989;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}



int CDatabaseMini::Save_Merchant_Logout(uint32 userid,int logouttm)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int merchantid,thisouttm;
        int      retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    merchantid = userid;
    thisouttm = logouttm;
    if (userid ==0)
        return DB_PARAM;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveMerchantLogout(:merchantid,:thisouttm,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveMerchantLogout ( :merchantid \
, :thisouttm , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )4008;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&merchantid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )4039;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}
int CDatabaseMini::Save_User_OnlineTime(uint32 clientno,int logintm,int logouttm, int &money)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int        userid,lstouttm, thisintm, thisouttm;
        int                 sendmoney, daymoney;
        int                 countFlag;
        float               onlinetime, todayonlinetm;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    userid = clientno;
    thisintm = logintm;
    thisouttm = logouttm;
    sendmoney = DAY_SEND_MONEY;
    todayonlinetm = 0;
    countFlag = 0;
    money = 0;
    lstouttm = 0;
    todayonlinetm = 0;

    unsigned int onlinetm = (unsigned int)(logouttm - logintm);
    char buf[10];
    sprintf(buf, "%.1f", float(onlinetm)/60.0/60);  //六分钟记时
    float onlinetimelen = (float)atof(buf);
    if (onlinetimelen < 0.1)    //小时
        return DB_SUCCESS;
    onlinetime = onlinetimelen;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name
       SELECT LstLogoutTime, CountFlag, TodayLineTime INTO :lstouttm, :countFlag, :todayonlinetm
       FROM IM_USERSTAT
       WHERE UserId=:userid; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select LstLogoutTime ,CountFlag ,TodayLineTime into :b1,\
:b2,:b3  from IM_USERSTAT where UserId=:b4";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )4058;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&lstouttm;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&countFlag;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&todayonlinetm;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&userid;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret < 0 && db_ret != -1405) //出错
    {
        sql_error(sqlca, oraca);
        money = 0;
        return DB_ERROR;
    }
    if (db_ret == 1403)//没有该用户
    {
        if (onlinetimelen >= 2.0)
        {
            /* EXEC SQL AT :db_link_name INSERT INTO IM_USERSTAT (UserId,LstLoginTime,LstLogoutTime,TotalLineTime,
                 LoginCount, CountFlag,TotalMoney, TodayLineTime)
            values(:userid, :thisintm,:thisouttm,:onlinetime,1, 1, :sendmoney, :onlinetime); */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "insert into IM_USERSTAT (UserId,LstLoginTime,Lst\
LogoutTime,TotalLineTime,LoginCount,CountFlag,TotalMoney,TodayLineTime) value\
s (:b1,:b2,:b3,:b4,1,1,:b5,:b4)";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )4093;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&userid;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&thisintm;
            sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqhstv[2] = (unsigned char  *)&thisouttm;
            sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[2] = (         int  )0;
            sqlstm.sqindv[2] = (         short *)0;
            sqlstm.sqinds[2] = (         int  )0;
            sqlstm.sqharm[2] = (unsigned long )0;
            sqlstm.sqadto[2] = (unsigned short )0;
            sqlstm.sqtdso[2] = (unsigned short )0;
            sqlstm.sqhstv[3] = (unsigned char  *)&onlinetime;
            sqlstm.sqhstl[3] = (unsigned long )sizeof(float);
            sqlstm.sqhsts[3] = (         int  )0;
            sqlstm.sqindv[3] = (         short *)0;
            sqlstm.sqinds[3] = (         int  )0;
            sqlstm.sqharm[3] = (unsigned long )0;
            sqlstm.sqadto[3] = (unsigned short )0;
            sqlstm.sqtdso[3] = (unsigned short )0;
            sqlstm.sqhstv[4] = (unsigned char  *)&sendmoney;
            sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[4] = (         int  )0;
            sqlstm.sqindv[4] = (         short *)0;
            sqlstm.sqinds[4] = (         int  )0;
            sqlstm.sqharm[4] = (unsigned long )0;
            sqlstm.sqadto[4] = (unsigned short )0;
            sqlstm.sqtdso[4] = (unsigned short )0;
            sqlstm.sqhstv[5] = (unsigned char  *)&onlinetime;
            sqlstm.sqhstl[5] = (unsigned long )sizeof(float);
            sqlstm.sqhsts[5] = (         int  )0;
            sqlstm.sqindv[5] = (         short *)0;
            sqlstm.sqinds[5] = (         int  )0;
            sqlstm.sqharm[5] = (unsigned long )0;
            sqlstm.sqadto[5] = (unsigned short )0;
            sqlstm.sqtdso[5] = (unsigned short )0;
            sqlstm.sqhstv[6] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[6] = (unsigned long )34;
            sqlstm.sqhsts[6] = (         int  )0;
            sqlstm.sqindv[6] = (         short *)0;
            sqlstm.sqinds[6] = (         int  )0;
            sqlstm.sqharm[6] = (unsigned long )0;
            sqlstm.sqadto[6] = (unsigned short )0;
            sqlstm.sqtdso[6] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            db_ret = sqlca.sqlcode;
            if (conn_error(db_ret))
            {
                iReconnTimes=0;
                bReconn=ConnectDB();
                while(!bReconn)
                {
                    iReconnTimes++;
                    sleep(iReconnTimes%10);
                    bReconn=ConnectDB();
                }
                goto start;
            }

            if (db_ret < 0 ) //出错
            {
                sql_error(sqlca, oraca);
                money = 0;
                return DB_ERROR;
            }
            /* EXEC SQL AT :db_link_name COMMIT; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )4136;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            money = DAY_SEND_MONEY;
        }
        else
        {
            /* EXEC SQL AT :db_link_name INSERT INTO  IM_USERSTAT (UserId,LstLoginTime,LstLogoutTime,TotalLineTime,
                 LoginCount, TodayLineTime)
            values(:userid, :thisintm,:thisouttm,:onlinetime,1, :onlinetime); */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "insert into IM_USERSTAT (UserId,LstLoginTime,Lst\
LogoutTime,TotalLineTime,LoginCount,TodayLineTime) values (:b1,:b2,:b3,:b4,1,\
:b4)";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )4155;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&userid;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&thisintm;
            sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqhstv[2] = (unsigned char  *)&thisouttm;
            sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[2] = (         int  )0;
            sqlstm.sqindv[2] = (         short *)0;
            sqlstm.sqinds[2] = (         int  )0;
            sqlstm.sqharm[2] = (unsigned long )0;
            sqlstm.sqadto[2] = (unsigned short )0;
            sqlstm.sqtdso[2] = (unsigned short )0;
            sqlstm.sqhstv[3] = (unsigned char  *)&onlinetime;
            sqlstm.sqhstl[3] = (unsigned long )sizeof(float);
            sqlstm.sqhsts[3] = (         int  )0;
            sqlstm.sqindv[3] = (         short *)0;
            sqlstm.sqinds[3] = (         int  )0;
            sqlstm.sqharm[3] = (unsigned long )0;
            sqlstm.sqadto[3] = (unsigned short )0;
            sqlstm.sqtdso[3] = (unsigned short )0;
            sqlstm.sqhstv[4] = (unsigned char  *)&onlinetime;
            sqlstm.sqhstl[4] = (unsigned long )sizeof(float);
            sqlstm.sqhsts[4] = (         int  )0;
            sqlstm.sqindv[4] = (         short *)0;
            sqlstm.sqinds[4] = (         int  )0;
            sqlstm.sqharm[4] = (unsigned long )0;
            sqlstm.sqadto[4] = (unsigned short )0;
            sqlstm.sqtdso[4] = (unsigned short )0;
            sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[5] = (unsigned long )34;
            sqlstm.sqhsts[5] = (         int  )0;
            sqlstm.sqindv[5] = (         short *)0;
            sqlstm.sqinds[5] = (         int  )0;
            sqlstm.sqharm[5] = (unsigned long )0;
            sqlstm.sqadto[5] = (unsigned short )0;
            sqlstm.sqtdso[5] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            db_ret = sqlca.sqlcode;
            if (db_ret < 0 ) //出错
            {
                return DB_ERROR;
            }
            /* EXEC SQL AT :db_link_name COMMIT; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )4194;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        }

        return DB_SUCCESS;
    }

    if (lstouttm == 0)
        lstouttm = logouttm - 24*60*60;

    //用户登录过
    //上次登出时间与本次登出时间比较

    CTime lst(lstouttm);    //上次登出时间
    CTime logout(logouttm); //本次登出时间
    CTime login(logintm);   //本次登录时间


    //当天非第一次登出
    if (logout.GetYear() == lst.GetYear() && logout.GetMonth() == lst.GetMonth() && logout.GetDay() == lst.GetDay())//年月日相同
    {
        if (countFlag == 0)//当日未充金币
        {
            float tmlen = todayonlinetm + onlinetimelen;
            if ( tmlen >= 2.0)//当日在线时长超过两小时
            {
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET lstLoginTime=:thisintm,LstLogoutTime=:thisouttm,
                TotalLineTime = TotalLineTime+:onlinetime, LoginCount=LoginCount+1,
                CountFlag = 1,TotalMoney= TotalMoney + :sendmoney, TodayLineTime = TodayLineTime + :onlinetime
                WHERE UserId=:userid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set lstLoginTime=:b1,Lst\
LogoutTime=:b2,TotalLineTime=(TotalLineTime+:b3),LoginCount=(LoginCount+1),Co\
untFlag=1,TotalMoney=(TotalMoney+:b4),TodayLineTime=(TodayLineTime+:b3) where\
 UserId=:b6";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4213;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&thisintm;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqhstv[3] = (unsigned char  *)&sendmoney;
                sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[3] = (         int  )0;
                sqlstm.sqindv[3] = (         short *)0;
                sqlstm.sqinds[3] = (         int  )0;
                sqlstm.sqharm[3] = (unsigned long )0;
                sqlstm.sqadto[3] = (unsigned short )0;
                sqlstm.sqtdso[3] = (unsigned short )0;
                sqlstm.sqhstv[4] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[4] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[4] = (         int  )0;
                sqlstm.sqindv[4] = (         short *)0;
                sqlstm.sqinds[4] = (         int  )0;
                sqlstm.sqharm[4] = (unsigned long )0;
                sqlstm.sqadto[4] = (unsigned short )0;
                sqlstm.sqtdso[4] = (unsigned short )0;
                sqlstm.sqhstv[5] = (unsigned char  *)&userid;
                sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[5] = (         int  )0;
                sqlstm.sqindv[5] = (         short *)0;
                sqlstm.sqinds[5] = (         int  )0;
                sqlstm.sqharm[5] = (unsigned long )0;
                sqlstm.sqadto[5] = (unsigned short )0;
                sqlstm.sqtdso[5] = (unsigned short )0;
                sqlstm.sqhstv[6] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[6] = (unsigned long )34;
                sqlstm.sqhsts[6] = (         int  )0;
                sqlstm.sqindv[6] = (         short *)0;
                sqlstm.sqinds[6] = (         int  )0;
                sqlstm.sqharm[6] = (unsigned long )0;
                sqlstm.sqadto[6] = (unsigned short )0;
                sqlstm.sqtdso[6] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                db_ret = sqlca.sqlcode;
                if (db_ret < 0 ) //出错
                {
                    return DB_ERROR;
                }
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4256;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                money = DAY_SEND_MONEY;
            }
            else//不足两小时
            {
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET lstLoginTime=:thisintm,LstLogoutTime=:thisouttm,
                TotalLineTime = TotalLineTime+:onlinetime, LoginCount=LoginCount+1,
                CountFlag = 0, TodayLineTime = TodayLineTime + :onlinetime WHERE UserId=:userid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set lstLoginTime=:b1,Lst\
LogoutTime=:b2,TotalLineTime=(TotalLineTime+:b3),LoginCount=(LoginCount+1),Co\
untFlag=0,TodayLineTime=(TodayLineTime+:b3) where UserId=:b5";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4275;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&thisintm;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqhstv[3] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[3] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[3] = (         int  )0;
                sqlstm.sqindv[3] = (         short *)0;
                sqlstm.sqinds[3] = (         int  )0;
                sqlstm.sqharm[3] = (unsigned long )0;
                sqlstm.sqadto[3] = (unsigned short )0;
                sqlstm.sqtdso[3] = (unsigned short )0;
                sqlstm.sqhstv[4] = (unsigned char  *)&userid;
                sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[4] = (         int  )0;
                sqlstm.sqindv[4] = (         short *)0;
                sqlstm.sqinds[4] = (         int  )0;
                sqlstm.sqharm[4] = (unsigned long )0;
                sqlstm.sqadto[4] = (unsigned short )0;
                sqlstm.sqtdso[4] = (unsigned short )0;
                sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[5] = (unsigned long )34;
                sqlstm.sqhsts[5] = (         int  )0;
                sqlstm.sqindv[5] = (         short *)0;
                sqlstm.sqinds[5] = (         int  )0;
                sqlstm.sqharm[5] = (unsigned long )0;
                sqlstm.sqadto[5] = (unsigned short )0;
                sqlstm.sqtdso[5] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                db_ret = sqlca.sqlcode;
                if (db_ret < 0 ) //出错
                {
                    return DB_ERROR;
                }
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4314;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            }
        }
        else//已充金币
        {
            /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET lstLoginTime=:thisintm,LstLogoutTime=:thisouttm,
            TotalLineTime = TotalLineTime+:onlinetime, LoginCount=LoginCount+1,
            TodayLineTime = TodayLineTime + :onlinetime WHERE UserId=:userid; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "update IM_USERSTAT  set lstLoginTime=:b1,LstLogo\
utTime=:b2,TotalLineTime=(TotalLineTime+:b3),LoginCount=(LoginCount+1),TodayL\
ineTime=(TodayLineTime+:b3) where UserId=:b5";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )4333;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&thisintm;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
            sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqhstv[2] = (unsigned char  *)&onlinetime;
            sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
            sqlstm.sqhsts[2] = (         int  )0;
            sqlstm.sqindv[2] = (         short *)0;
            sqlstm.sqinds[2] = (         int  )0;
            sqlstm.sqharm[2] = (unsigned long )0;
            sqlstm.sqadto[2] = (unsigned short )0;
            sqlstm.sqtdso[2] = (unsigned short )0;
            sqlstm.sqhstv[3] = (unsigned char  *)&onlinetime;
            sqlstm.sqhstl[3] = (unsigned long )sizeof(float);
            sqlstm.sqhsts[3] = (         int  )0;
            sqlstm.sqindv[3] = (         short *)0;
            sqlstm.sqinds[3] = (         int  )0;
            sqlstm.sqharm[3] = (unsigned long )0;
            sqlstm.sqadto[3] = (unsigned short )0;
            sqlstm.sqtdso[3] = (unsigned short )0;
            sqlstm.sqhstv[4] = (unsigned char  *)&userid;
            sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[4] = (         int  )0;
            sqlstm.sqindv[4] = (         short *)0;
            sqlstm.sqinds[4] = (         int  )0;
            sqlstm.sqharm[4] = (unsigned long )0;
            sqlstm.sqadto[4] = (unsigned short )0;
            sqlstm.sqtdso[4] = (unsigned short )0;
            sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[5] = (unsigned long )34;
            sqlstm.sqhsts[5] = (         int  )0;
            sqlstm.sqindv[5] = (         short *)0;
            sqlstm.sqinds[5] = (         int  )0;
            sqlstm.sqharm[5] = (unsigned long )0;
            sqlstm.sqadto[5] = (unsigned short )0;
            sqlstm.sqtdso[5] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            db_ret = sqlca.sqlcode;
            if (db_ret < 0 ) //出错
            {
                return DB_ERROR;
            }
            /* EXEC SQL AT :db_link_name COMMIT; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )4372;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        }
        return DB_SUCCESS;

    }
    else//与上次登出年月日有一个不同 当天第一次登出。
    {
        if (logout.GetDay() == login.GetDay())//同一天登录登出,表示当天第一次上线离线(丢弃在线一个月)
        {
            if ( onlinetimelen >= 2.0)//本次在线时长超过两小时
            {
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET lstLoginTime=:thisintm,LstLogoutTime=:thisouttm,
                TotalLineTime = TotalLineTime+:onlinetime, LoginCount=LoginCount+1,
                CountFlag = 1,TotalMoney= TotalMoney + :sendmoney, TodayLineTime =  :onlinetime
                WHERE UserId=:userid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set lstLoginTime=:b1,Lst\
LogoutTime=:b2,TotalLineTime=(TotalLineTime+:b3),LoginCount=(LoginCount+1),Co\
untFlag=1,TotalMoney=(TotalMoney+:b4),TodayLineTime=:b3 where UserId=:b6";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4391;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&thisintm;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqhstv[3] = (unsigned char  *)&sendmoney;
                sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[3] = (         int  )0;
                sqlstm.sqindv[3] = (         short *)0;
                sqlstm.sqinds[3] = (         int  )0;
                sqlstm.sqharm[3] = (unsigned long )0;
                sqlstm.sqadto[3] = (unsigned short )0;
                sqlstm.sqtdso[3] = (unsigned short )0;
                sqlstm.sqhstv[4] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[4] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[4] = (         int  )0;
                sqlstm.sqindv[4] = (         short *)0;
                sqlstm.sqinds[4] = (         int  )0;
                sqlstm.sqharm[4] = (unsigned long )0;
                sqlstm.sqadto[4] = (unsigned short )0;
                sqlstm.sqtdso[4] = (unsigned short )0;
                sqlstm.sqhstv[5] = (unsigned char  *)&userid;
                sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[5] = (         int  )0;
                sqlstm.sqindv[5] = (         short *)0;
                sqlstm.sqinds[5] = (         int  )0;
                sqlstm.sqharm[5] = (unsigned long )0;
                sqlstm.sqadto[5] = (unsigned short )0;
                sqlstm.sqtdso[5] = (unsigned short )0;
                sqlstm.sqhstv[6] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[6] = (unsigned long )34;
                sqlstm.sqhsts[6] = (         int  )0;
                sqlstm.sqindv[6] = (         short *)0;
                sqlstm.sqinds[6] = (         int  )0;
                sqlstm.sqharm[6] = (unsigned long )0;
                sqlstm.sqadto[6] = (unsigned short )0;
                sqlstm.sqtdso[6] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                db_ret = sqlca.sqlcode;
                if (db_ret < 0 ) //出错
                {
                    return DB_ERROR;
                }
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4434;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                money = DAY_SEND_MONEY;
            }
            else//不足两小时
            {
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET lstLoginTime=:thisintm,LstLogoutTime=:thisouttm,
                TotalLineTime = TotalLineTime+:onlinetime, LoginCount=LoginCount+1,
                CountFlag = 0, TodayLineTime = :onlinetime WHERE UserId=:userid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set lstLoginTime=:b1,Lst\
LogoutTime=:b2,TotalLineTime=(TotalLineTime+:b3),LoginCount=(LoginCount+1),Co\
untFlag=0,TodayLineTime=:b3 where UserId=:b5";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4453;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&thisintm;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqhstv[3] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[3] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[3] = (         int  )0;
                sqlstm.sqindv[3] = (         short *)0;
                sqlstm.sqinds[3] = (         int  )0;
                sqlstm.sqharm[3] = (unsigned long )0;
                sqlstm.sqadto[3] = (unsigned short )0;
                sqlstm.sqtdso[3] = (unsigned short )0;
                sqlstm.sqhstv[4] = (unsigned char  *)&userid;
                sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[4] = (         int  )0;
                sqlstm.sqindv[4] = (         short *)0;
                sqlstm.sqinds[4] = (         int  )0;
                sqlstm.sqharm[4] = (unsigned long )0;
                sqlstm.sqadto[4] = (unsigned short )0;
                sqlstm.sqtdso[4] = (unsigned short )0;
                sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[5] = (unsigned long )34;
                sqlstm.sqhsts[5] = (         int  )0;
                sqlstm.sqindv[5] = (         short *)0;
                sqlstm.sqinds[5] = (         int  )0;
                sqlstm.sqharm[5] = (unsigned long )0;
                sqlstm.sqadto[5] = (unsigned short )0;
                sqlstm.sqtdso[5] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                db_ret = sqlca.sqlcode;
                if (db_ret < 0 ) //出错
                {
                    return DB_ERROR;
                }
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4492;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            }
            return DB_SUCCESS;
        }
        else//上下线不在同一天。
        {
            char buf[10];
            sprintf(buf, "%.1f", login.GetMinute()/60.0);
            float fintm = (float)atof(buf);
            fintm = float(24.0 -(float)login.GetHour()-fintm);//登录当天在线时长
            sprintf(buf, "%.1f", logout.GetMinute()/60.0);
            float fouttm = (float)atof(buf);
            fouttm = (float)logout.GetHour()+fouttm;//登出当天在线时长

            if (fintm >= 2.0)//登录当天在线时长超过两小时
            {
                if (login.GetYear() == lst.GetYear() && login.GetMonth() == lst.GetMonth() && login.GetDay() == lst.GetDay())//当天有登出过
                {
                    if (countFlag == 0)//前一天未充金币
                    {
                        /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET TotalMoney= TotalMoney + :sendmoney
                        WHERE UserId=:userid; */ 

{
                        struct sqlexd sqlstm;
                        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                        sqlstm.sqlvsn = 12;
                        sqlstm.arrsiz = 15;
                        sqlstm.sqladtp = &sqladt;
                        sqlstm.sqltdsp = &sqltds;
                        sqlstm.stmt = "update IM_USERSTAT  set TotalMoney=(\
TotalMoney+:b1) where UserId=:b2";
                        sqlstm.iters = (unsigned int  )1;
                        sqlstm.offset = (unsigned int  )4511;
                        sqlstm.cud = sqlcud0;
                        sqlstm.sqlest = (unsigned char  *)&sqlca;
                        sqlstm.sqlety = (unsigned short)4352;
                        sqlstm.occurs = (unsigned int  )0;
                        sqlstm.sqhstv[0] = (unsigned char  *)&sendmoney;
                        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                        sqlstm.sqhsts[0] = (         int  )0;
                        sqlstm.sqindv[0] = (         short *)0;
                        sqlstm.sqinds[0] = (         int  )0;
                        sqlstm.sqharm[0] = (unsigned long )0;
                        sqlstm.sqadto[0] = (unsigned short )0;
                        sqlstm.sqtdso[0] = (unsigned short )0;
                        sqlstm.sqhstv[1] = (unsigned char  *)&userid;
                        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                        sqlstm.sqhsts[1] = (         int  )0;
                        sqlstm.sqindv[1] = (         short *)0;
                        sqlstm.sqinds[1] = (         int  )0;
                        sqlstm.sqharm[1] = (unsigned long )0;
                        sqlstm.sqadto[1] = (unsigned short )0;
                        sqlstm.sqtdso[1] = (unsigned short )0;
                        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
                        sqlstm.sqhstl[2] = (unsigned long )34;
                        sqlstm.sqhsts[2] = (         int  )0;
                        sqlstm.sqindv[2] = (         short *)0;
                        sqlstm.sqinds[2] = (         int  )0;
                        sqlstm.sqharm[2] = (unsigned long )0;
                        sqlstm.sqadto[2] = (unsigned short )0;
                        sqlstm.sqtdso[2] = (unsigned short )0;
                        sqlstm.sqphsv = sqlstm.sqhstv;
                        sqlstm.sqphsl = sqlstm.sqhstl;
                        sqlstm.sqphss = sqlstm.sqhsts;
                        sqlstm.sqpind = sqlstm.sqindv;
                        sqlstm.sqpins = sqlstm.sqinds;
                        sqlstm.sqparm = sqlstm.sqharm;
                        sqlstm.sqparc = sqlstm.sqharc;
                        sqlstm.sqpadto = sqlstm.sqadto;
                        sqlstm.sqptdso = sqlstm.sqtdso;
                        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                        db_ret = sqlca.sqlcode;
                        if (db_ret < 0 ) //出错
                        {
                            return DB_ERROR;
                        }
                        /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                        struct sqlexd sqlstm;
                        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                        sqlstm.sqlvsn = 12;
                        sqlstm.arrsiz = 15;
                        sqlstm.sqladtp = &sqladt;
                        sqlstm.sqltdsp = &sqltds;
                        sqlstm.iters = (unsigned int  )1;
                        sqlstm.offset = (unsigned int  )4538;
                        sqlstm.cud = sqlcud0;
                        sqlstm.sqlest = (unsigned char  *)&sqlca;
                        sqlstm.sqlety = (unsigned short)4352;
                        sqlstm.occurs = (unsigned int  )0;
                        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                        sqlstm.sqhstl[0] = (unsigned long )34;
                        sqlstm.sqhsts[0] = (         int  )0;
                        sqlstm.sqindv[0] = (         short *)0;
                        sqlstm.sqinds[0] = (         int  )0;
                        sqlstm.sqharm[0] = (unsigned long )0;
                        sqlstm.sqadto[0] = (unsigned short )0;
                        sqlstm.sqtdso[0] = (unsigned short )0;
                        sqlstm.sqphsv = sqlstm.sqhstv;
                        sqlstm.sqphsl = sqlstm.sqhstl;
                        sqlstm.sqphss = sqlstm.sqhsts;
                        sqlstm.sqpind = sqlstm.sqindv;
                        sqlstm.sqpins = sqlstm.sqinds;
                        sqlstm.sqparm = sqlstm.sqharm;
                        sqlstm.sqparc = sqlstm.sqharc;
                        sqlstm.sqpadto = sqlstm.sqadto;
                        sqlstm.sqptdso = sqlstm.sqtdso;
                        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                        money = DAY_SEND_MONEY;
                    }
                }
                else
                {
                    /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET TotalMoney= TotalMoney + :sendmoney
                    WHERE UserId=:userid; */ 

{
                    struct sqlexd sqlstm;
                    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                    sqlstm.sqlvsn = 12;
                    sqlstm.arrsiz = 15;
                    sqlstm.sqladtp = &sqladt;
                    sqlstm.sqltdsp = &sqltds;
                    sqlstm.stmt = "update IM_USERSTAT  set TotalMoney=(Tota\
lMoney+:b1) where UserId=:b2";
                    sqlstm.iters = (unsigned int  )1;
                    sqlstm.offset = (unsigned int  )4557;
                    sqlstm.cud = sqlcud0;
                    sqlstm.sqlest = (unsigned char  *)&sqlca;
                    sqlstm.sqlety = (unsigned short)4352;
                    sqlstm.occurs = (unsigned int  )0;
                    sqlstm.sqhstv[0] = (unsigned char  *)&sendmoney;
                    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                    sqlstm.sqhsts[0] = (         int  )0;
                    sqlstm.sqindv[0] = (         short *)0;
                    sqlstm.sqinds[0] = (         int  )0;
                    sqlstm.sqharm[0] = (unsigned long )0;
                    sqlstm.sqadto[0] = (unsigned short )0;
                    sqlstm.sqtdso[0] = (unsigned short )0;
                    sqlstm.sqhstv[1] = (unsigned char  *)&userid;
                    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                    sqlstm.sqhsts[1] = (         int  )0;
                    sqlstm.sqindv[1] = (         short *)0;
                    sqlstm.sqinds[1] = (         int  )0;
                    sqlstm.sqharm[1] = (unsigned long )0;
                    sqlstm.sqadto[1] = (unsigned short )0;
                    sqlstm.sqtdso[1] = (unsigned short )0;
                    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
                    sqlstm.sqhstl[2] = (unsigned long )34;
                    sqlstm.sqhsts[2] = (         int  )0;
                    sqlstm.sqindv[2] = (         short *)0;
                    sqlstm.sqinds[2] = (         int  )0;
                    sqlstm.sqharm[2] = (unsigned long )0;
                    sqlstm.sqadto[2] = (unsigned short )0;
                    sqlstm.sqtdso[2] = (unsigned short )0;
                    sqlstm.sqphsv = sqlstm.sqhstv;
                    sqlstm.sqphsl = sqlstm.sqhstl;
                    sqlstm.sqphss = sqlstm.sqhsts;
                    sqlstm.sqpind = sqlstm.sqindv;
                    sqlstm.sqpins = sqlstm.sqinds;
                    sqlstm.sqparm = sqlstm.sqharm;
                    sqlstm.sqparc = sqlstm.sqharc;
                    sqlstm.sqpadto = sqlstm.sqadto;
                    sqlstm.sqptdso = sqlstm.sqtdso;
                    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                    db_ret = sqlca.sqlcode;
                    if (db_ret < 0 ) //出错
                    {
                        return DB_ERROR;
                    }
                    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                    struct sqlexd sqlstm;
                    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                    sqlstm.sqlvsn = 12;
                    sqlstm.arrsiz = 15;
                    sqlstm.sqladtp = &sqladt;
                    sqlstm.sqltdsp = &sqltds;
                    sqlstm.iters = (unsigned int  )1;
                    sqlstm.offset = (unsigned int  )4584;
                    sqlstm.cud = sqlcud0;
                    sqlstm.sqlest = (unsigned char  *)&sqlca;
                    sqlstm.sqlety = (unsigned short)4352;
                    sqlstm.occurs = (unsigned int  )0;
                    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                    sqlstm.sqhstl[0] = (unsigned long )34;
                    sqlstm.sqhsts[0] = (         int  )0;
                    sqlstm.sqindv[0] = (         short *)0;
                    sqlstm.sqinds[0] = (         int  )0;
                    sqlstm.sqharm[0] = (unsigned long )0;
                    sqlstm.sqadto[0] = (unsigned short )0;
                    sqlstm.sqtdso[0] = (unsigned short )0;
                    sqlstm.sqphsv = sqlstm.sqhstv;
                    sqlstm.sqphsl = sqlstm.sqhstl;
                    sqlstm.sqphss = sqlstm.sqhsts;
                    sqlstm.sqpind = sqlstm.sqindv;
                    sqlstm.sqpins = sqlstm.sqinds;
                    sqlstm.sqparm = sqlstm.sqharm;
                    sqlstm.sqparc = sqlstm.sqharc;
                    sqlstm.sqpadto = sqlstm.sqadto;
                    sqlstm.sqptdso = sqlstm.sqtdso;
                    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                    money = DAY_SEND_MONEY;

                }
            }
            else//22点以后登录
            {
                if (login.GetYear() == lst.GetYear() && login.GetMonth() == lst.GetMonth() && login.GetDay() == lst.GetDay())//前一天有登出过
                {
                    if (countFlag == 0)//前一天未充金币
                    {
                        float tmlen = todayonlinetm + fintm;
                        if ( tmlen >= 2.0)//前一天在线时长累计超过两小时
                        {
                            /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET TotalMoney= TotalMoney + :sendmoney
                            WHERE UserId=:userid; */ 

{
                            struct sqlexd sqlstm;
                            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                            sqlstm.sqlvsn = 12;
                            sqlstm.arrsiz = 15;
                            sqlstm.sqladtp = &sqladt;
                            sqlstm.sqltdsp = &sqltds;
                            sqlstm.stmt = "update IM_USERSTAT  set TotalMon\
ey=(TotalMoney+:b1) where UserId=:b2";
                            sqlstm.iters = (unsigned int  )1;
                            sqlstm.offset = (unsigned int  )4603;
                            sqlstm.cud = sqlcud0;
                            sqlstm.sqlest = (unsigned char  *)&sqlca;
                            sqlstm.sqlety = (unsigned short)4352;
                            sqlstm.occurs = (unsigned int  )0;
                            sqlstm.sqhstv[0] = (unsigned char  *)&sendmoney;
                            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                            sqlstm.sqhsts[0] = (         int  )0;
                            sqlstm.sqindv[0] = (         short *)0;
                            sqlstm.sqinds[0] = (         int  )0;
                            sqlstm.sqharm[0] = (unsigned long )0;
                            sqlstm.sqadto[0] = (unsigned short )0;
                            sqlstm.sqtdso[0] = (unsigned short )0;
                            sqlstm.sqhstv[1] = (unsigned char  *)&userid;
                            sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                            sqlstm.sqhsts[1] = (         int  )0;
                            sqlstm.sqindv[1] = (         short *)0;
                            sqlstm.sqinds[1] = (         int  )0;
                            sqlstm.sqharm[1] = (unsigned long )0;
                            sqlstm.sqadto[1] = (unsigned short )0;
                            sqlstm.sqtdso[1] = (unsigned short )0;
                            sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
                            sqlstm.sqhstl[2] = (unsigned long )34;
                            sqlstm.sqhsts[2] = (         int  )0;
                            sqlstm.sqindv[2] = (         short *)0;
                            sqlstm.sqinds[2] = (         int  )0;
                            sqlstm.sqharm[2] = (unsigned long )0;
                            sqlstm.sqadto[2] = (unsigned short )0;
                            sqlstm.sqtdso[2] = (unsigned short )0;
                            sqlstm.sqphsv = sqlstm.sqhstv;
                            sqlstm.sqphsl = sqlstm.sqhstl;
                            sqlstm.sqphss = sqlstm.sqhsts;
                            sqlstm.sqpind = sqlstm.sqindv;
                            sqlstm.sqpins = sqlstm.sqinds;
                            sqlstm.sqparm = sqlstm.sqharm;
                            sqlstm.sqparc = sqlstm.sqharc;
                            sqlstm.sqpadto = sqlstm.sqadto;
                            sqlstm.sqptdso = sqlstm.sqtdso;
                            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                            db_ret = sqlca.sqlcode;
                            if (db_ret < 0 ) //出错
                            {
                                return DB_ERROR;
                            }
                            /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                            struct sqlexd sqlstm;
                            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                            sqlstm.sqlvsn = 12;
                            sqlstm.arrsiz = 15;
                            sqlstm.sqladtp = &sqladt;
                            sqlstm.sqltdsp = &sqltds;
                            sqlstm.iters = (unsigned int  )1;
                            sqlstm.offset = (unsigned int  )4630;
                            sqlstm.cud = sqlcud0;
                            sqlstm.sqlest = (unsigned char  *)&sqlca;
                            sqlstm.sqlety = (unsigned short)4352;
                            sqlstm.occurs = (unsigned int  )0;
                            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                            sqlstm.sqhstl[0] = (unsigned long )34;
                            sqlstm.sqhsts[0] = (         int  )0;
                            sqlstm.sqindv[0] = (         short *)0;
                            sqlstm.sqinds[0] = (         int  )0;
                            sqlstm.sqharm[0] = (unsigned long )0;
                            sqlstm.sqadto[0] = (unsigned short )0;
                            sqlstm.sqtdso[0] = (unsigned short )0;
                            sqlstm.sqphsv = sqlstm.sqhstv;
                            sqlstm.sqphsl = sqlstm.sqhstl;
                            sqlstm.sqphss = sqlstm.sqhsts;
                            sqlstm.sqpind = sqlstm.sqindv;
                            sqlstm.sqpins = sqlstm.sqinds;
                            sqlstm.sqparm = sqlstm.sqharm;
                            sqlstm.sqparc = sqlstm.sqharc;
                            sqlstm.sqpadto = sqlstm.sqadto;
                            sqlstm.sqptdso = sqlstm.sqtdso;
                            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                            money = DAY_SEND_MONEY;//登入当天发送的金币
                        }
                    }
                }
            }


            float tmlen = onlinetimelen-fintm-fouttm;//除登入登出天在线时间

            int day = int(tmlen)/24;//登录登出间隔天数
            if (day != 0)
            {
                daymoney = sendmoney * day;
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET TotalMoney= TotalMoney + :daymoney
                WHERE UserId=:userid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set TotalMoney=(TotalMon\
ey+:b1) where UserId=:b2";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4649;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&daymoney;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&userid;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[2] = (unsigned long )34;
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                db_ret = sqlca.sqlcode;
                if (db_ret < 0 ) //出错
                {
                    return DB_SUCCESS;
                }
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4676;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                money = money  + daymoney;

            }
            onlinetime = fouttm;
            if( fouttm >= 2.0)//登出当天在线时长超过两小时
            {
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET lstLoginTime=:thisintm,LstLogoutTime=:thisouttm,
                TotalLineTime = TotalLineTime+:onlinetime, LoginCount=LoginCount+1,
                CountFlag = 1,TotalMoney= TotalMoney + :sendmoney, TodayLineTime =  :onlinetime
                WHERE UserId=:userid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set lstLoginTime=:b1,Lst\
LogoutTime=:b2,TotalLineTime=(TotalLineTime+:b3),LoginCount=(LoginCount+1),Co\
untFlag=1,TotalMoney=(TotalMoney+:b4),TodayLineTime=:b3 where UserId=:b6";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4695;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&thisintm;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqhstv[3] = (unsigned char  *)&sendmoney;
                sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[3] = (         int  )0;
                sqlstm.sqindv[3] = (         short *)0;
                sqlstm.sqinds[3] = (         int  )0;
                sqlstm.sqharm[3] = (unsigned long )0;
                sqlstm.sqadto[3] = (unsigned short )0;
                sqlstm.sqtdso[3] = (unsigned short )0;
                sqlstm.sqhstv[4] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[4] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[4] = (         int  )0;
                sqlstm.sqindv[4] = (         short *)0;
                sqlstm.sqinds[4] = (         int  )0;
                sqlstm.sqharm[4] = (unsigned long )0;
                sqlstm.sqadto[4] = (unsigned short )0;
                sqlstm.sqtdso[4] = (unsigned short )0;
                sqlstm.sqhstv[5] = (unsigned char  *)&userid;
                sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[5] = (         int  )0;
                sqlstm.sqindv[5] = (         short *)0;
                sqlstm.sqinds[5] = (         int  )0;
                sqlstm.sqharm[5] = (unsigned long )0;
                sqlstm.sqadto[5] = (unsigned short )0;
                sqlstm.sqtdso[5] = (unsigned short )0;
                sqlstm.sqhstv[6] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[6] = (unsigned long )34;
                sqlstm.sqhsts[6] = (         int  )0;
                sqlstm.sqindv[6] = (         short *)0;
                sqlstm.sqinds[6] = (         int  )0;
                sqlstm.sqharm[6] = (unsigned long )0;
                sqlstm.sqadto[6] = (unsigned short )0;
                sqlstm.sqtdso[6] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                db_ret = sqlca.sqlcode;
                if (db_ret < 0 ) //出错
                {
                    return DB_SUCCESS;
                }
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4738;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                money = money  + DAY_SEND_MONEY;
            }
            else//不足两小时
            {
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET lstLoginTime=:thisintm,LstLogoutTime=:thisouttm,
                TotalLineTime = TotalLineTime+:onlinetime, LoginCount=LoginCount+1,
                CountFlag = 0, TodayLineTime = :onlinetime WHERE UserId=:userid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set lstLoginTime=:b1,Lst\
LogoutTime=:b2,TotalLineTime=(TotalLineTime+:b3),LoginCount=(LoginCount+1),Co\
untFlag=0,TodayLineTime=:b3 where UserId=:b5";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4757;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&thisintm;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&thisouttm;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[2] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqhstv[3] = (unsigned char  *)&onlinetime;
                sqlstm.sqhstl[3] = (unsigned long )sizeof(float);
                sqlstm.sqhsts[3] = (         int  )0;
                sqlstm.sqindv[3] = (         short *)0;
                sqlstm.sqinds[3] = (         int  )0;
                sqlstm.sqharm[3] = (unsigned long )0;
                sqlstm.sqadto[3] = (unsigned short )0;
                sqlstm.sqtdso[3] = (unsigned short )0;
                sqlstm.sqhstv[4] = (unsigned char  *)&userid;
                sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[4] = (         int  )0;
                sqlstm.sqindv[4] = (         short *)0;
                sqlstm.sqinds[4] = (         int  )0;
                sqlstm.sqharm[4] = (unsigned long )0;
                sqlstm.sqadto[4] = (unsigned short )0;
                sqlstm.sqtdso[4] = (unsigned short )0;
                sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[5] = (unsigned long )34;
                sqlstm.sqhsts[5] = (         int  )0;
                sqlstm.sqindv[5] = (         short *)0;
                sqlstm.sqinds[5] = (         int  )0;
                sqlstm.sqharm[5] = (unsigned long )0;
                sqlstm.sqadto[5] = (unsigned short )0;
                sqlstm.sqtdso[5] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                db_ret = sqlca.sqlcode;
                if (db_ret < 0 ) //出错
                {
                    return DB_SUCCESS;
                }
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )4796;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            }
        }
    }

    return DB_SUCCESS;
}

int CDatabaseMini::Save_User_RecvFamilyMsgID(uint32 uid, uint32 cid, uint32 mid)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int  clusterid,clientid,msgid;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    clusterid = cid;
    clientid=uid;
    msgid = mid;
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveUserRecvFamilyMsg(:clusterid,:clientid,:msgid,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveUserRecvFamilyMsg ( :clusteri\
d , :clientid , :msgid , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )4815;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clusterid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&clientid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&msgid;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    return DB_SUCCESS;
}


int CDatabaseMini::Get_User_FamilyMsgID(uint32 userID, uint32 familyID, uint32 &msgID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int      clusterid,mid,clientno;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int  retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    clientno=userID;
    clusterid = familyID;
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);
    int db_ret;
    int iReconnTimes;
    bool bReconn;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.GetUserFamilyMsgID(:clientno,:clusterid,:mid,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetUserFamilyMsgID ( :clientno , \
:clusterid , :mid , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )4850;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clientno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&clusterid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&mid;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 && db_ret != -1405)
    {
        mid = 0;
        sql_error(sqlca, oraca);
    }

    if (db_ret == 1403 || retcode == 1403 || db_ret == -1405)
        mid = 0;

    msgID = mid;
    return DB_SUCCESS;
}

int CDatabaseMini::Delete_All_Offline_Msg(uint32 userID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int     recv;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 

    recv = userID;
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.DeleteAllOfflineMsg(:recv,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . DeleteAllOfflineMsg ( :recv , :re\
tcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )4885;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&recv;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
    }
    return DB_SUCCESS;
}

int CDatabaseMini::Get_Family_Offline_Msg(uint32 userID, uint32 familyID, uint32 &msgID, ST_OFFLINE_MSG *pFamilyMsg, uint8 &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw *lvr;
        unsigned int     origin,time,msglen,msgid,int_tmp;
        short   msgtype;
        OCIBlobLocator *blob;
        unsigned int amt,offset,bufsize,clusid,msgno;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    amt = 0;
    offset=1;
    bufsize = MAX_MSG_LEN;
    clusid = familyID;
    msgid = msgID;
    unsigned int nowmid=msgid;
    int db_ret;
    msgID = 0;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    if (nRetCount == 0)
    {
        /* EXEC SQL AT :db_link_name SELECT COUNT(MsgId) INTO :int_tmp
        FROM  IM_CLUSTERTALKMSG
        WHERE ClusterId= :clusid AND MsgId > :msgid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select count(MsgId) into :b1  from IM_CLUSTERTALKMSG\
 where (ClusterId=:b2 and MsgId>:b3)";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )4912;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&clusid;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&msgid;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[3] = (unsigned long )34;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 )
        {
            sql_error(sqlca, oraca);
            return DB_ERROR;
        }
        nRetCount = int_tmp;
        return DB_SUCCESS;
    }

    /* EXEC SQL AT :db_link_name DECLARE cur_getfamilymsg CURSOR FOR
       SELECT MsgId,SENDER,SENDTIME,MSGTYPE,MSGLEN,MSG
       FROM  IM_CLUSTERTALKMSG WHERE ClusterId= :clusid AND MsgId > :msgid ORDER BY MsgId; */ 


    /* EXEC SQL OPEN cur_getfamilymsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = sq0120;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )4943;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqcmod = (unsigned int )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clusid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&msgid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_getfamilymsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )4970;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0  && db_ret != -1405)
    {

        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE cur_getfamilymsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )4989;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5008;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_getfamilymsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5031;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret == 1403 || (db_ret < 0  && db_ret != -1405 ))
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5050;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL CLOSE cur_getfamilymsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5073;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    lvr = (long_varraw *)malloc(sizeof(unsigned int) + bufsize);
    lvr->len = bufsize;

    int iNum = 0;
    for(;;)
    {
        msglen=0;
        amt = 0;
        offset=1;
        bufsize = MAX_MSG_LEN;
        /* EXEC SQL FETCH cur_getfamilymsg INTO :msgno,:origin,:time,:msgtype,:msglen,:blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5092;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&msgno;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&origin;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&time;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&msgtype;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&blob;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[6] = (unsigned long )34;
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            /* EXEC SQL CLOSE cur_getfamilymsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5135;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if ((db_ret < 0 && db_ret != -1405)|| db_ret == 1403 || iNum >= nRetCount)
        {
            if (db_ret != 1403)
                sql_error(sqlca, oraca);

            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5154;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL CLOSE cur_getfamilymsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5177;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            free(lvr);
            msgID = nowmid;
            nRetCount = iNum;
            return DB_SUCCESS;
        }

        pFamilyMsg[iNum].msgid      = msgno;
        pFamilyMsg[iNum].recvID     = userID;
        pFamilyMsg[iNum].sendID     = origin;
        pFamilyMsg[iNum].tm         = (unsigned int)time;
        pFamilyMsg[iNum].msgtype    = (unsigned short)msgtype;
        pFamilyMsg[iNum].msglen     = msglen + 1;


        /* EXEC SQL AT :db_link_name LOB READ :amt FROM :blob AT :offset INTO :lvr WITH LENGTH :msglen; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5196;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&amt;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&blob;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&offset;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)lvr;
        sqlstm.sqhstl[3] = (unsigned long )4;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[5] = (unsigned long )34;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        if (sqlca.sqlcode == 1403 )
        {
            memcpy((char*)pFamilyMsg[iNum].msg,lvr->buf,msglen + 1);
            memset(lvr->buf, 0, msglen);
            nowmid = msgno;
        }
        ++iNum;
    }

    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5235;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL CLOSE cur_getfamilymsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5258;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    free(lvr);
    return DB_SUCCESS;
}

int CDatabaseMini::Get_Family_Offline_SysMsg(uint32 userID, uint32 familyID,ST_OFFLINE_MSG *pFamilyMsg, uint8 &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw *lvr;
        unsigned int     sendno,time,msglen, int_tmp;
        short   msgtype;
        OCIBlobLocator *blob;
        unsigned int amt,offset,bufsize;
        unsigned int clusid;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    //unsigned int nowmid=0;
    amt = 0;
    offset=1;
    bufsize = MAX_MSG_LEN;
    clusid = familyID;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    if (nRetCount == 0)
    {
        /* EXEC SQL AT :db_link_name SELECT COUNT(MsgId) INTO :int_tmp
        FROM IM_CLUSTERSYSMSG
        WHERE ClusterId= :clusid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select count(MsgId) into :b1  from IM_CLUSTERSYSMSG \
where ClusterId=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5277;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&clusid;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 )
        {
            sql_error(sqlca, oraca);
            return DB_ERROR;
        }
        nRetCount = int_tmp;
        return DB_SUCCESS;
    }

    /* EXEC SQL AT :db_link_name DECLARE cur_familysysmsg CURSOR FOR
       SELECT MsgId,SendTime,MsgType,MsgLen,MSG
       FROM   IM_CLUSTERSYSMSG WHERE ClusterId= :clusid; */ 

    /* EXEC SQL OPEN cur_familysysmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = sq0122;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5304;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqcmod = (unsigned int )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clusid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5327;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5346;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5365;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5388;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret == 1403 || db_ret < 0)
    {
        if (db_ret != 1403)
            sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5407;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5430;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    lvr = (long_varraw *)malloc(sizeof(unsigned int) + bufsize);
    lvr->len = bufsize;

    int iNum = 0;
    for(;;)
    {
        amt = 0;
        offset=1;
        bufsize = MAX_MSG_LEN;
        /* EXEC SQL FETCH cur_familysysmsg INTO :sendno,:time,:msgtype,:msglen,:blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5449;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&sendno;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&time;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&msgtype;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&blob;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[5] = (unsigned long )34;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5488;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if ( db_ret < 0 || db_ret == 1403 || iNum >= nRetCount)
        {
            if (db_ret != 1403)
                sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5507;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            free(lvr);
            /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5530;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            if (iNum > 0)
            {
                /* EXEC SQL AT :db_link_name DELETE FROM IM_CLUSTERSYSMSG WHERE  ClusterId = :clusid; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "delete  from IM_CLUSTERSYSMSG  where Cluster\
Id=:b1";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )5549;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&clusid;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[1] = (unsigned long )34;
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}

//清除验证记录
                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )5572;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            }
            nRetCount = iNum;
            return DB_SUCCESS;
        }

        pFamilyMsg[iNum].recvID     = userID;
        pFamilyMsg[iNum].sendID     = sendno;
        pFamilyMsg[iNum].tm         = (unsigned int)time;
        pFamilyMsg[iNum].msgtype    = (unsigned short)msgtype;
        pFamilyMsg[iNum].msglen     = msglen + 1;


        /* EXEC SQL AT :db_link_name LOB READ :amt FROM :blob AT :offset INTO :lvr WITH LENGTH :msglen; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5591;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&amt;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&blob;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&offset;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)lvr;
        sqlstm.sqhstl[3] = (unsigned long )4;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[5] = (unsigned long )34;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        if (sqlca.sqlcode == 1403 )
        {
            memcpy((char*)pFamilyMsg[iNum].msg,lvr->buf,msglen + 1);
        }
        ++iNum;
    }

    /* EXEC SQL AT :db_link_name DELETE FROM IM_CLUSTERSYSMSG WHERE  ClusterId = :clusid; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "delete  from IM_CLUSTERSYSMSG  where ClusterId=:b1";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5630;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&clusid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}

//清除验证记录


    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5653;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5676;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    free(lvr);
    return DB_SUCCESS;
}

/* 获取某个用户的离线聊天信息 */
int  CDatabaseMini::Get_User_Offline_Msg(uint32 userID,ST_OFFLINE_MSG *pFamilyMsg, uint8 &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw *lvr;
        unsigned int     recv,origin,time,msglen, int_tmp;
        short   msgtype;
        OCIBlobLocator *blob;
        unsigned int amt,offset,bufsize;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    amt = 0;
    offset=1;
    bufsize = MAX_MSG_LEN;

    recv = userID;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    if (nRetCount == 0)
    {
        /* EXEC SQL AT :db_link_name SELECT COUNT(Sender) INTO :int_tmp
        FROM  IM_OFFLINETALKMSG WHERE Receiver= :recv; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select count(Sender) into :b1  from IM_OFFLINETALKMS\
G where Receiver=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5695;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&recv;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 )
        {
            sql_error(sqlca, oraca);
            return DB_ERROR;
        }
        nRetCount = int_tmp;
        return DB_SUCCESS;
    }

    /* EXEC SQL AT :db_link_name DECLARE cur_getusermsg CURSOR FOR
       SELECT Sender,
        (cast(cast(SendTime as timestamp) at time zone 'gmt' as date)-to_date('19700101 00:00:00','yyyymmdd hh24:mi:ss'))*24*60*
    60 as SendTime, MsgType,MsgLen,MSG
       FROM  IM_OFFLINETALKMSG WHERE Receiver= :recv order by SendTime; */ 

    /* EXEC SQL OPEN cur_getusermsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = sq0127;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5722;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqcmod = (unsigned int )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&recv;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5745;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5764;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )5783;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5806;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5825;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5848;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    lvr = (long_varraw *)malloc(sizeof(unsigned int) + bufsize);
    lvr->len = bufsize;

    int iNum = 0;

    for(;;)
    {
        amt = 0;
        offset=1;
        bufsize = MAX_MSG_LEN;

        /* EXEC SQL FETCH cur_getusermsg INTO :origin,:time,:msgtype,:msglen,:blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5867;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&origin;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&time;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&msgtype;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&blob;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[5] = (unsigned long )34;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            /* EXEC SQL CLOSE cur_getusermsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5906;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if (( db_ret < 0  && db_ret != -1405)|| db_ret == 1403 || iNum >= nRetCount)
        {
            if (db_ret != 1403)
                sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5925;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL CLOSE cur_getusermsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )5948;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            free(lvr);
            nRetCount = iNum;
            return DB_SUCCESS;
        }

        pFamilyMsg[iNum].recvID     = userID;
        pFamilyMsg[iNum].sendID     = origin;
        pFamilyMsg[iNum].tm         = (unsigned int)time;
        pFamilyMsg[iNum].msgtype    = (unsigned short)msgtype;
        pFamilyMsg[iNum].msglen     = msglen + 1;


        /* EXEC SQL AT :db_link_name LOB READ :amt FROM :blob AT :offset INTO :lvr WITH LENGTH :msglen; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )5967;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&amt;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&blob;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&offset;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)lvr;
        sqlstm.sqhstl[3] = (unsigned long )4;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[5] = (unsigned long )34;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        if (sqlca.sqlcode == 1403 )
        {
            memcpy((char*)pFamilyMsg[iNum].msg,lvr->buf,msglen + 1);
        }
        ++iNum;

    }

    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6006;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL CLOSE cur_getusermsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6029;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    free(lvr);
    return DB_SUCCESS;
}


//   获取某个用户的离线系统信息
int  CDatabaseMini::Get_User_Offline_SysMsg(uint32 userID,ST_OFFLINE_MSG *pFamilyMsg, uint8 &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw *lvr;
        unsigned int     recv,origin,time,msglen, int_tmp;
        short   msgtype;
        OCIBlobLocator *blob;
        unsigned int amt,offset,bufsize;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);


    amt = 0;
    offset=1;
    bufsize = MAX_MSG_LEN;

    recv = userID;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    if (nRetCount == 0)
    {
        /* EXEC SQL AT :db_link_name SELECT COUNT(Sender) INTO :int_tmp
        FROM  IM_OFFLINESYSMSG WHERE Receiver= :recv; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "select count(Sender) into :b1  from IM_OFFLINESYSMSG\
 where Receiver=:b2";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6048;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&int_tmp;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&recv;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if( db_ret < 0 )
        {
            sql_error(sqlca, oraca);
            return DB_ERROR;
        }
        nRetCount = int_tmp;
        return DB_SUCCESS;
    }

    /* EXEC SQL AT :db_link_name DECLARE cur_getusersysmsg CURSOR FOR
       SELECT Sender,SendTime,MsgType,MsgLen,MSG
       FROM   IM_OFFLINESYSMSG WHERE Receiver= :recv; */ 

    /* EXEC SQL OPEN cur_getusersysmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = sq0129;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6075;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqcmod = (unsigned int )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&recv;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6098;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0  && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6117;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6136;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6159;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret == 1403 || (db_ret < 0  && db_ret != -1405) )
    {
        if (db_ret != 1403)
            sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6178;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL CLOSE cur_familysysmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6201;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    lvr = (long_varraw *)malloc(sizeof(unsigned int) + bufsize);
    lvr->len = bufsize;

    int iNum = 0;

    for(;;)
    {
        amt = 0;
        offset=1;
        bufsize = MAX_MSG_LEN;
        /* EXEC SQL FETCH cur_getusersysmsg INTO :origin,:time,:msgtype,:msglen,:blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6220;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&origin;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&time;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&msgtype;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&blob;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[5] = (unsigned long )34;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            /* EXEC SQL CLOSE cur_getusersysmsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )6259;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if ( (db_ret < 0 && db_ret != -1405) || db_ret == 1403 || iNum >= nRetCount)
        {
            if (db_ret != 1403)
                sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )6278;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL CLOSE cur_getusersysmsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )6301;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            free(lvr);
            nRetCount = iNum;
            return DB_SUCCESS;
        }

        pFamilyMsg[iNum].recvID     = userID;
        pFamilyMsg[iNum].sendID     = origin;
        pFamilyMsg[iNum].tm         = (unsigned int)time;
        pFamilyMsg[iNum].msgtype    = (unsigned short)msgtype;
        pFamilyMsg[iNum].msglen     = msglen + 1;


        /* EXEC SQL AT :db_link_name LOB READ :amt FROM :blob AT :offset INTO :lvr WITH LENGTH :msglen; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6320;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&amt;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&blob;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&offset;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)lvr;
        sqlstm.sqhstl[3] = (unsigned long )4;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&msglen;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[5] = (unsigned long )34;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        if (sqlca.sqlcode == 1403 )
        {
            memcpy((char*)pFamilyMsg[iNum].msg,lvr->buf,msglen + 1);
        }
        ++iNum;
    }

    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6359;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL CLOSE cur_getusersysmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6382;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    free(lvr);
    return DB_SUCCESS;
}

//获取客户端系统消息（公告)
int CDatabaseMini::Get_Pub_Msg(uint32 userID,ST_WEB_MSG *pMsg, uint8 &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int     recv;
        unsigned int msgno, msgrecvid, timenow;
        /* VARCHAR var_msg[1401]; */ 
struct { unsigned short len; unsigned char arr[1401]; } var_msg;

        /* VARCHAR db_link_name[32],timesend[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

struct { unsigned short len; unsigned char arr[32]; } timesend;

    /* EXEC SQL END DECLARE SECTION; */ 


    SET_INIT_NULL(var_msg);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    var_msg.arr[0]='\0';
    var_msg.len=0;
    timesend.arr[0] = '\0';
    timesend.len = 0;
    msgrecvid = 0;
    msgno = 0;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


    recv = userID;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

start:
    /* EXEC SQL AT :db_link_name SELECT MsgID INTO :msgno FROM IM_USERSTAT WHERE UserId=:recv; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select MsgID into :b1  from IM_USERSTAT where UserId=:b2";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6401;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&msgno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&recv;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    if (db_ret == 1403)//没有该用户
    {
        msgno = 0;

        time_t t;
        time(&t);
        timenow = (unsigned int)t;
        /* EXEC SQL AT :db_link_name INSERT INTO  IM_USERSTAT (UserId,MSGID,LstLoginTime,LstLogoutTime)
        values(:recv, :msgno, :timenow,:timenow); */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "insert into IM_USERSTAT (UserId,MSGID,LstLoginTime,L\
stLogoutTime) values (:b1,:b2,:b3,:b3)";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6428;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&recv;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&msgno;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&timenow;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&timenow;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[4] = (unsigned long )34;
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (conn_error(db_ret))
        {
            iReconnTimes=0;
            bReconn=ConnectDB();
            while(!bReconn)
            {
                iReconnTimes++;
                sleep(iReconnTimes%10);
                bReconn=ConnectDB();
            }
            goto start;
        }

        if (db_ret < 0 ) //出错
        {
            sql_error(sqlca, oraca);
            return DB_ERROR;
        }
        /* EXEC SQL AT :db_link_name COMMIT; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6463;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    }

    /* EXEC SQL AT :db_link_name DECLARE cur_pubmsg CURSOR FOR
       SELECT Msgid, msg,TO_CHAR(PubTime,'YYYY/MM/DD HH24:MI:SS')
       FROM IM_SYSTEMMSG WHERE Msgid > :msgno AND ExpireTime>= sysdate ORDER BY MSGID; */ 

    /* EXEC SQL OPEN cur_pubmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = sq0133;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6482;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqcmod = (unsigned int )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&msgno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    int iNum = 0;
    for(;;)
    {
        /* EXEC SQL FETCH cur_pubmsg INTO :msgrecvid, :var_msg,:timesend; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6505;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&msgrecvid;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&var_msg;
        sqlstm.sqhstl[1] = (unsigned long )1403;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&timesend;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[3] = (unsigned long )34;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            /* EXEC SQL CLOSE cur_pubmsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )6536;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            if (iNum != 0)
            {
                /* EXEC SQL AT :db_link_name UPDATE IM_USERSTAT SET MSGID = :msgno WHERE UserId=:recv; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "update IM_USERSTAT  set MSGID=:b1 where User\
Id=:b2";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )6555;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&msgno;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&recv;
                sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[2] = (unsigned long )34;
                sqlstm.sqhsts[2] = (         int  )0;
                sqlstm.sqindv[2] = (         short *)0;
                sqlstm.sqinds[2] = (         int  )0;
                sqlstm.sqharm[2] = (unsigned long )0;
                sqlstm.sqadto[2] = (unsigned short )0;
                sqlstm.sqtdso[2] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                /* EXEC SQL AT :db_link_name COMMIT; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )6582;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            }
            nRetCount = iNum;
            return DB_SUCCESS;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL CLOSE cur_pubmsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )6601;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            nRetCount = iNum;
            return DB_SUCCESS;
        }
        msgno = msgrecvid;

        var_msg.arr[var_msg.len]='\0';
        timesend.arr[timesend.len] = '\0';

        pMsg[iNum].recID            = 0;
        pMsg[iNum].recvID       = recv;
        pMsg[iNum].sendID       = 0;
        pMsg[iNum].msgtype      = 0;
        //pMsg[iNum].msglen     = var_msg.len + 1;
        memcpy((char*)pMsg[iNum].msg,var_msg.arr,var_msg.len + 1);
        strncpy(pMsg[iNum].sendTime, (char*)timesend.arr,31);

        iNum++;
        memset(var_msg.arr, 0,var_msg.len);
        memset(timesend.arr, 0, timesend.len);
    }

    /* EXEC SQL CLOSE cur_pubmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6620;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::Save_OnlineUser_Num(uint32 onlinenum)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int     ionlinenum;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 



    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    ionlinenum = onlinenum;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


    int db_ret;
    int iReconnTimes;
    bool bReconn;

start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveOnlineNum(:ionlinenum,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveOnlineNum ( :ionlinenum , :re\
tcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6639;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&ionlinenum;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    return DB_SUCCESS;
}

int CDatabaseMini::TestContext(void)
{
//  DEF_ORASET;

//  EXEC SQL BEGIN DECLARE SECTION;
//      sql_context testctx[ 1 ];
//  EXEC SQL END DECLARE SECTION;
//
//  for (int i = 0; i < 1; ++i)
//  {
//      EXEC SQL CONTEXT ALLOCATE :testctx[i];
//  }
//  for (int i = 0; i < 1; ++i)
//  {
//      EXEC SQL CONTEXT USE :testctx[i];
//      EXEC SQL CONTEXT FREE :testctx[i];
//  }
    return 0;
}

//test blob procedure
int CDatabaseMini::Save_Family_RequestMsg2(const uint32 c_iFamilyID, uint32 iSenderID,uint32 iSendTime,const char *strMsg, int iMsgLen)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        long_varraw * lvr;
        unsigned int     nFamilyID, nSenderID, nSendTime, nMsgSeq;
        int nMsgLen, nMsgType;
        char*   pmsg;
        OCIBlobLocator *blob;
        unsigned int offset = 1; /* attention: typedef ub4 unsigned int */
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);


    nFamilyID = c_iFamilyID;
    nSenderID = iSenderID;
    nSendTime = iSendTime;
    nMsgLen = iMsgLen;
    nMsgType = CMD_CLUSTER_AUTH_REQ;
    pmsg = (char*)strMsg;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6666;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}




    lvr = (long_varraw *)malloc(sizeof(ub4) + nMsgLen);
    lvr->len = nMsgLen;
    memcpy(lvr->buf,pmsg,nMsgLen);
    /* EXEC SQL AT :db_link_name LOB WRITE ONE :nMsgLen
        FROM :lvr WITH LENGTH :nMsgLen INTO :blob AT :offset; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6689;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)lvr;
    sqlstm.sqhstl[1] = (unsigned long )4;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&blob;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&offset;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 || db_ret == 1403 )
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6728;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6747;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        free(lvr);
        return DB_ERROR;
    }
    free(lvr);


    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SaveFamilyRequestMsg(:nMsgSeq, :nFamilyID,:nSenderID,:nSendTime,:nMsgType,:nMsgLen,:blob,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SaveFamilyRequestMsg ( :nMsgSeq ,\
 :nFamilyID , :nSenderID , :nSendTime , :nMsgType , :nMsgLen , :blob , :retco\
de ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6770;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nMsgSeq;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&nFamilyID;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&nSenderID;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&nSendTime;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&nMsgType;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&nMsgLen;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&blob;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqhstv[8] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[8] = (unsigned long )34;
    sqlstm.sqhsts[8] = (         int  )0;
    sqlstm.sqindv[8] = (         short *)0;
    sqlstm.sqinds[8] = (         int  )0;
    sqlstm.sqharm[8] = (unsigned long )0;
    sqlstm.sqadto[8] = (unsigned short )0;
    sqlstm.sqtdso[8] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6821;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6844;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    return DB_SUCCESS;
}

int CDatabaseMini::SetWokuMsgRecvID(uint32 userID, uint8 Type, uint32 recID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int     recid, userid;
        int             type;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    recid = recID;
    userid = userID;
    type = Type;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.SetWokuMsgRecvID(:userid,:type,:recid,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . SetWokuMsgRecvID ( :userid , :typ\
e , :recid , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6863;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&userid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&type;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&recid;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret < 0 || db_ret == 1403)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    return DB_SUCCESS;
}

int CDatabaseMini::GetWokuMsgID(uint32 userID,uint32 &nOperationID,uint32 &nUserMsgID,uint32 &nSysMsgID,uint32 &nBroadcastID,uint32 &nUsercommentID,uint32 &nLogcommentID)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int     userid,OperationID,UserMsgID,SysMsgID,BroadcastID,UsercommentID,LogcommentID;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int      retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    userid = userID;
    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_Local_Pkg.GetWokuMsgID(:userid,:OperationID,:UserMsgID,:SysMsgID,:BroadcastID,:UsercommentID,:LogcommentID,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_Local_Pkg . GetWokuMsgID ( :userid , :Operati\
onID , :UserMsgID , :SysMsgID , :BroadcastID , :UsercommentID , :LogcommentID\
 , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6898;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&userid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&OperationID;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&UserMsgID;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&SysMsgID;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&BroadcastID;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&UsercommentID;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&LogcommentID;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqhstv[8] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[8] = (unsigned long )34;
    sqlstm.sqhsts[8] = (         int  )0;
    sqlstm.sqindv[8] = (         short *)0;
    sqlstm.sqinds[8] = (         int  )0;
    sqlstm.sqharm[8] = (unsigned long )0;
    sqlstm.sqadto[8] = (unsigned short )0;
    sqlstm.sqtdso[8] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if ((db_ret < 0 && db_ret != -1405)|| db_ret == 1403)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    if(retcode != 1403)
    {
        nOperationID = OperationID;
        nUserMsgID = UserMsgID;
        nSysMsgID = SysMsgID;
        nBroadcastID = BroadcastID;
        nUsercommentID = UsercommentID;
        nLogcommentID = LogcommentID;
    }
    return DB_SUCCESS;
}

/* 获取WEBIM互通消息(及离线消息) */
int  CDatabaseMini::Get_WebIM_Msg(int ServerNo,ST_WEBIM_MSG *pWebIMMsg, uint16 &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        int v_serverno;
        unsigned long v_msgid;
        unsigned int v_receiver, v_sender, v_sendtime, v_msglen, v_reqcount;
        unsigned int amt,offset, bufsize = MAX_MSG_LEN;
        short  v_msgtype;
        long_varraw *lvr;
        OCIBlobLocator *blob;
        /* varchar v_sendername[41], v_text[1401]; */ 
struct { unsigned short len; unsigned char arr[41]; } v_sendername;

struct { unsigned short len; unsigned char arr[1401]; } v_text;

        /* varchar db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    SET_INIT_NULL(db_link_name);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    v_serverno = ServerNo;
    v_reqcount = nRetCount;

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

    /* EXEC SQL AT :db_link_name ALLOCATE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6949;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



start:

    /* EXEC SQL AT :db_link_name DECLARE cur_webimmsg CURSOR FOR
       select t1.MsgId,t1.Receiver,t1.Sender,
       (cast(cast(t1.SendTime as timestamp) at time zone 'gmt' as date)-to_date('19700101 00:00:00','yyyymmdd hh24:mi:ss'))*24*60*60 as SendTime,
       t1.MsgType,t1.MsgLen,t1.Msg,t1.SenderName,t1.Text
       from IM_OFFLINETALKMSG t1, IM_USERONLINE t2
       where t2.ServerNo=:v_serverno and t2.status=1 and t1.Receiver=t2.UserId
       and rownum <= :v_reqcount
       order by t1.Receiver,t1.MsgId; */ 

    /* EXEC SQL OPEN cur_webimmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = sq0142;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )6972;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqcmod = (unsigned int )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&v_serverno;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&v_reqcount;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_webimmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )6999;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if( db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE cur_webimmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7018;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE cur_webimmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7037;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (db_ret < 0)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7056;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL CLOSE cur_webimmsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7079;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    lvr = (long_varraw *)malloc(sizeof(unsigned int) + bufsize);
    lvr->len = bufsize;

    int iNum = 0;

    for(;;)
    {
        amt = 0;
        offset = 1;
        bufsize = MAX_MSG_LEN;

        SET_INIT_NULL(v_sendername);
        SET_INIT_NULL(v_text);

        /* EXEC SQL FETCH cur_webimmsg INTO
        :v_msgid, :v_receiver, :v_sender, :v_sendtime,:v_msgtype,:v_msglen,:blob, :v_sendername, :v_text; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7098;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&v_msgid;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(long);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&v_receiver;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&v_sender;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&v_sendtime;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&v_msgtype;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(short);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&v_msglen;
        sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&blob;
        sqlstm.sqhstl[6] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&v_sendername;
        sqlstm.sqhstl[7] = (unsigned long )43;
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqhstv[8] = (unsigned char  *)&v_text;
        sqlstm.sqhstl[8] = (unsigned long )1403;
        sqlstm.sqhsts[8] = (         int  )0;
        sqlstm.sqindv[8] = (         short *)0;
        sqlstm.sqinds[8] = (         int  )0;
        sqlstm.sqharm[8] = (unsigned long )0;
        sqlstm.sqadto[8] = (unsigned short )0;
        sqlstm.sqtdso[8] = (unsigned short )0;
        sqlstm.sqhstv[9] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[9] = (unsigned long )34;
        sqlstm.sqhsts[9] = (         int  )0;
        sqlstm.sqindv[9] = (         short *)0;
        sqlstm.sqinds[9] = (         int  )0;
        sqlstm.sqharm[9] = (unsigned long )0;
        sqlstm.sqadto[9] = (unsigned short )0;
        sqlstm.sqtdso[9] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



        db_ret = sqlca.sqlcode;
        if (( db_ret < 0  && db_ret != -1405)|| db_ret == 1403 || iNum >= nRetCount)
        {
            if (db_ret != 1403)
                sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )7153;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL CLOSE cur_webimmsg; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )7176;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            free(lvr);
            /* EXEC SQL AT :db_link_name COMMIT; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )7195;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            nRetCount = iNum;
            return DB_SUCCESS;
        }

        pWebIMMsg[iNum].msgid   = v_msgid;
        pWebIMMsg[iNum].recvID  = v_receiver;
        pWebIMMsg[iNum].sendID  = v_sender;
        pWebIMMsg[iNum].tm      = (unsigned int)v_sendtime;
        pWebIMMsg[iNum].msgtype = (unsigned short)v_msgtype;
        pWebIMMsg[iNum].msglen  = v_msglen;
        strncpy(pWebIMMsg[iNum].from_nickname, (char*)v_sendername.arr, MAX_NICKNAME_LEN+1);
        strncpy(pWebIMMsg[iNum].msgtext, (char*)v_text.arr, MAX_MSG_LEN);

        if(v_msglen > 0)
        {
            /* EXEC SQL AT :db_link_name LOB READ :amt FROM :blob AT :offset INTO :lvr WITH LENGTH :v_msglen; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )7214;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&amt;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&blob;
            sqlstm.sqhstl[1] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqhstv[2] = (unsigned char  *)&offset;
            sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[2] = (         int  )0;
            sqlstm.sqindv[2] = (         short *)0;
            sqlstm.sqinds[2] = (         int  )0;
            sqlstm.sqharm[2] = (unsigned long )0;
            sqlstm.sqadto[2] = (unsigned short )0;
            sqlstm.sqtdso[2] = (unsigned short )0;
            sqlstm.sqhstv[3] = (unsigned char  *)lvr;
            sqlstm.sqhstl[3] = (unsigned long )4;
            sqlstm.sqhsts[3] = (         int  )0;
            sqlstm.sqindv[3] = (         short *)0;
            sqlstm.sqinds[3] = (         int  )0;
            sqlstm.sqharm[3] = (unsigned long )0;
            sqlstm.sqadto[3] = (unsigned short )0;
            sqlstm.sqtdso[3] = (unsigned short )0;
            sqlstm.sqhstv[4] = (unsigned char  *)&v_msglen;
            sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[4] = (         int  )0;
            sqlstm.sqindv[4] = (         short *)0;
            sqlstm.sqinds[4] = (         int  )0;
            sqlstm.sqharm[4] = (unsigned long )0;
            sqlstm.sqadto[4] = (unsigned short )0;
            sqlstm.sqtdso[4] = (unsigned short )0;
            sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[5] = (unsigned long )34;
            sqlstm.sqhsts[5] = (         int  )0;
            sqlstm.sqindv[5] = (         short *)0;
            sqlstm.sqinds[5] = (         int  )0;
            sqlstm.sqharm[5] = (unsigned long )0;
            sqlstm.sqadto[5] = (unsigned short )0;
            sqlstm.sqtdso[5] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            if (sqlca.sqlcode == 1403 )
            {
                memcpy((char*)pWebIMMsg[iNum].msg,lvr->buf,v_msglen);
            }
        }
        ++iNum;

        /* EXEC SQL AT :db_link_name insert into
        IM_OFFLINETALKMSG_ARC (
                msgid,receiver,sender,srcip,srcport,sendtime,msgtype,msglen,msg,
                receivername,sendername,readtime,status,text)
            select
                msgid,receiver,sender,srcip,srcport,sendtime,msgtype,msglen,msg,
                receivername,sendername,sysdate,1,text
            from IM_OFFLINETALKMSG where msgid=:v_msgid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "insert into IM_OFFLINETALKMSG_ARC (msgid,receiver,se\
nder,srcip,srcport,sendtime,msgtype,msglen,msg,receivername,sendername,readti\
me,status,text)select msgid ,receiver ,sender ,srcip ,srcport ,sendtime ,msgt\
ype ,msglen ,msg ,receivername ,sendername ,sysdate ,1 ,text  from IM_OFFLINE\
TALKMSG where msgid=:b1";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7253;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&v_msgid;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(long);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name delete from IM_OFFLINETALKMSG where msgid=:v_msgid; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "delete  from IM_OFFLINETALKMSG  where msgid=:b1";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7276;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&v_msgid;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(long);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        LPONLINE_USER_INFO lpUser = CAppManager::GetInstance().GetAppNetWork().FindOnlineUser(v_receiver);
        if(lpUser == NULL)
        {
            /* EXEC SQL AT :db_link_name UPDATE IM_USERONLINE SET STATUS=0 WHERE USERId= :v_receiver; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "update IM_USERONLINE  set STATUS=0 where USERId=\
:b1";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )7299;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&v_receiver;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            db_ret = sqlca.sqlcode;
            if (db_ret < 0 )
            {
                /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.stmt = "";
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )7322;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&blob;
                sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[1] = (unsigned long )34;
                sqlstm.sqhsts[1] = (         int  )0;
                sqlstm.sqindv[1] = (         short *)0;
                sqlstm.sqinds[1] = (         int  )0;
                sqlstm.sqharm[1] = (unsigned long )0;
                sqlstm.sqadto[1] = (unsigned short )0;
                sqlstm.sqtdso[1] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                /* EXEC SQL CLOSE cur_webimmsg; */ 

{
                struct sqlexd sqlstm;
                sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
                sqlstm.sqlvsn = 12;
                sqlstm.arrsiz = 15;
                sqlstm.sqladtp = &sqladt;
                sqlstm.sqltdsp = &sqltds;
                sqlstm.iters = (unsigned int  )1;
                sqlstm.offset = (unsigned int  )7345;
                sqlstm.cud = sqlcud0;
                sqlstm.sqlest = (unsigned char  *)&sqlca;
                sqlstm.sqlety = (unsigned short)4352;
                sqlstm.occurs = (unsigned int  )0;
                sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
                sqlstm.sqhstl[0] = (unsigned long )34;
                sqlstm.sqhsts[0] = (         int  )0;
                sqlstm.sqindv[0] = (         short *)0;
                sqlstm.sqinds[0] = (         int  )0;
                sqlstm.sqharm[0] = (unsigned long )0;
                sqlstm.sqadto[0] = (unsigned short )0;
                sqlstm.sqtdso[0] = (unsigned short )0;
                sqlstm.sqphsv = sqlstm.sqhstv;
                sqlstm.sqphsl = sqlstm.sqhstl;
                sqlstm.sqphss = sqlstm.sqhsts;
                sqlstm.sqpind = sqlstm.sqindv;
                sqlstm.sqpins = sqlstm.sqinds;
                sqlstm.sqparm = sqlstm.sqharm;
                sqlstm.sqparc = sqlstm.sqharc;
                sqlstm.sqpadto = sqlstm.sqadto;
                sqlstm.sqptdso = sqlstm.sqtdso;
                sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


                free(lvr);
                return DB_ERROR;
            }
        }
    }
    /* EXEC SQL AT :db_link_name FREE :blob; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7364;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL CLOSE cur_webimmsg; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7387;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    free(lvr);
    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7406;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}








void ForDisableBuildWarningMini()
{
    unsigned int nTest =  sqlstm.sqlvsn;
    nTest++;
}
int CDatabaseMini::Modify_CS_Pwd(uint32 id, char* pwd)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_pwd[61]; */ 
struct { unsigned short len; unsigned char arr[61]; } var_pwd;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        unsigned int nID;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 

    nID = id;

    var_pwd.len = (unsigned short)strlen(pwd);
    strncpy((char*)var_pwd.arr,pwd,MAX_PASSWORD_LEN);
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.ModifyCSPwd(:nID,:var_pwd,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . ModifyCSPwd ( :nID , :var_pwd , :r\
etcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7425;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_pwd;
    sqlstm.sqhstl[1] = (unsigned long )63;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    if (retcode == 1)
        return DB_ERROR;

    return DB_SUCCESS;
}
int CDatabaseMini::Import_CS_Req(char *username,int permission,int receptionlimit,char *importname,uint32 &userid,uint32 importtime)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_username[121],var_importname[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } var_username;

struct { unsigned short len; unsigned char arr[121]; } var_importname;

        int i_permission, i_receptionlimit;
        unsigned int i_userid,i_importtime;
        int retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    i_userid = 0;
    i_permission = permission;
    i_receptionlimit =receptionlimit;
    i_importtime = importtime;

    SET_INIT_NULL(var_username);
    SET_INIT_NULL(var_importname);

    strncpy((char*)var_username.arr,username,MAX_USERNAME_LEN);
    var_username.len = (short)strlen((char *)var_username.arr);
    strncpy((char*)var_importname.arr,importname,MAX_USERNAME_LEN);
    var_importname.len = (short)strlen((char *)var_importname.arr);
    int db_ret;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

    int iReconnTimes;
    bool bReconn;

start:

    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.ImportCSReq(:var_username,:i_permission,:i_receptionlimit,:var_importname,:i_userid,:i_importtime,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . ImportCSReq ( :var_username , :i_p\
ermission , :i_receptionlimit , :var_importname , :i_userid , :i_importtime ,\
 :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7456;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&var_username;
    sqlstm.sqhstl[0] = (unsigned long )123;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&i_permission;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&i_receptionlimit;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&var_importname;
    sqlstm.sqhstl[3] = (unsigned long )123;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&i_userid;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&i_importtime;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[7] = (unsigned long )34;
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    CLog::Log("Import_CS_Req",CLog::TYPE_IMPORTANT,"i_userid:%d,var_username:%s,i_permission:%d,i_receptionlimit:%d,var_importname:%s,i_importtime:%d,db_ret:%d",
              i_userid,var_importname.arr,i_permission,i_receptionlimit,var_importname.arr,i_importtime,db_ret);
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if (retcode == 1403 || db_ret == 1403 || db_ret == -1405)
    {
        return DB_NOUSER;
    }

    if (db_ret >= 0)
    {
        CLog::Log("Import_CS_Req",CLog::TYPE_IMPORTANT,"i_userid:%d,db_ret:%d",i_userid,db_ret);
        userid = i_userid;
        SET_END_NULL(var_username);
        SET_END_NULL(var_importname);
        return DB_SUCCESS;
    }
    return DB_ERROR;

}

int CDatabaseMini::Modify_CS_Req(char* username, char* csRealName,int receptionLimit,char *password,uint32& importtime,uint32 csid,int permission)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_username[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } var_username;

        /* VARCHAR var_csRealName[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } var_csRealName;

        /* VARCHAR var_password[64]; */ 
struct { unsigned short len; unsigned char arr[64]; } var_password;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int i_receptionLimit;
        int i_permission;
        unsigned int i_csid;
        unsigned int i_importtime;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    i_receptionLimit = receptionLimit;
    i_importtime = importtime;
    i_permission = permission;
    i_csid = csid;


    var_username.len = (unsigned short)strlen(username);
    strncpy((char*)var_username.arr,username,MAX_USERNAME_LEN);

    var_csRealName.len = (unsigned short)strlen(csRealName);
    strncpy((char*)var_csRealName.arr,csRealName,MAX_USERNAME_LEN);

    var_password.len = (unsigned short)strlen(password);
    strncpy((char*)var_password.arr,password,MAX_PASSWORD_LEN);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.ModifyCSReq(:i_receptionLimit,:var_username,:var_csRealName,:var_password,:i_importtime,:i_csid,:i_permission,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . ModifyCSReq ( :i_receptionLimit , \
:var_username , :var_csRealName , :var_password , :i_importtime , :i_csid , :\
i_permission , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7503;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&i_receptionLimit;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_username;
    sqlstm.sqhstl[1] = (unsigned long )123;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_csRealName;
    sqlstm.sqhstl[2] = (unsigned long )123;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&var_password;
    sqlstm.sqhstl[3] = (unsigned long )66;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&i_importtime;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&i_csid;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&i_permission;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqhstv[8] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[8] = (unsigned long )34;
    sqlstm.sqhsts[8] = (         int  )0;
    sqlstm.sqindv[8] = (         short *)0;
    sqlstm.sqinds[8] = (         int  )0;
    sqlstm.sqharm[8] = (unsigned long )0;
    sqlstm.sqadto[8] = (unsigned short )0;
    sqlstm.sqtdso[8] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    if (retcode == 1)
        return DB_ERROR;
    importtime = i_importtime;

    return DB_SUCCESS;
}


int CDatabaseMini::Modify_CS_Status(char* username, int status)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR var_username[121],db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[121]; } var_username;

struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int i_status,retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    i_status = status;
    var_username.len = (unsigned short)strlen(username);
    strncpy((char*)var_username.arr,username,MAX_USERNAME_LEN);

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    int db_ret;
    int iReconnTimes;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.ModifyCSStatusReq(:var_username,:i_status,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . ModifyCSStatusReq ( :var_username \
, :i_status , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7554;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&var_username;
    sqlstm.sqhstl[0] = (unsigned long )123;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&i_status;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    if (retcode == 1)
        return DB_ERROR;

    return DB_SUCCESS;
}



int CDatabaseMini::Get_Vaild_CS_List(XT_CS_INFO * CSList, int &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR CSrealname[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } CSrealname;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        unsigned int Id=0;
        unsigned int CSId=0;
        int iNum = 0;

        SQL_CURSOR cur_CSlist;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    if (nRetCount <= 0)
        return DB_PARAM;
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    SET_INIT_NULL(CSrealname);
    int db_ret = 0;
    int iReconnTimes;
    bool bReconn;
    /* EXEC SQL ALLOCATE :cur_CSlist; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7585;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 



start:

    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.GetVaildCS_20160106(:cur_CSlist,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . GetVaildCS_20160106 ( :cur_CSlist \
, :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7604;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_CSlist; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7631;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("GetVaildCS",CLog::TYPE_IMPORTANT,"db_ret:%d, retcode:%d", db_ret, retcode);

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_CSlist; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7650;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE :cur_CSlist; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7669;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }


    for(;;)
    {
        /* EXEC SQL FETCH :cur_CSlist INTO :CSrealname,:Id,:CSId; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7688;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&CSrealname;
        sqlstm.sqhstl[1] = (unsigned long )123;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&Id;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&CSId;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            nRetCount = iNum;
            break;
        }
        if (iNum >= nRetCount)
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            nRetCount = iNum;
            break;
        }
        SET_END_NULL(CSrealname);
        strncpy(CSList[iNum].realname,(const char *)(CSrealname.arr),MAX_USERNAME_LEN);
        CSList[iNum].id= Id;
        CSList[iNum].csid= CSId;
        CLog::Log("GetVaildCS",CLog::TYPE_IMPORTANT,"iNum:%d,realname:%s", iNum, CSList[iNum].realname);
        ++iNum;

        SET_INIT_NULL(CSrealname);
        Id=0;
        CSId=0;
    }
    /* EXEC SQL CLOSE :cur_CSlist; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7719;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_CSlist; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7738;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSlist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}


int CDatabaseMini::Qurery_CS_Info(XT_CS_INFO * CSInfoList,char *username, char *importname, char *realname, int status,uint32 begintime,uint32 endtime,int &nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR CSusername[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } CSusername;

        /* VARCHAR CSrealname[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } CSrealname;

        /* VARCHAR CSimportname[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } CSimportname;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int iNum = 0;
        int CSstatus = 0;
        int CSpermission=0;
        int CSreceptionlimit = 0;
        unsigned int CSbegintime=0;
        unsigned int CSendtime=0;
        unsigned int CSimporttime =0;
        SQL_CURSOR cur_CSInfolist;
        int retcode;
    /* EXEC SQL END DECLARE SECTION; */ 


    if (nRetCount <= 0)
        return DB_PARAM;
    SET_INIT_NULL(CSusername);
    SET_INIT_NULL(CSrealname);
    SET_INIT_NULL(CSimportname);
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    strncpy((char*)CSusername.arr, username,MAX_USERNAME_LEN);
    CSusername.len = (short)strlen((char*)CSusername.arr);

    strncpy((char*)CSrealname.arr, realname,MAX_USERNAME_LEN);
    CSrealname.len = (short)strlen((char*)CSrealname.arr);

    strncpy((char*)CSimportname.arr, importname,MAX_USERNAME_LEN);
    CSimportname.len = (short)strlen((char*)CSimportname.arr);
    CSstatus = status;
    CSbegintime = begintime;
    CSendtime = endtime;
    CLog::Log("QureryCSInfo",CLog::TYPE_IMPORTANT,"username:%s,realname:%s,importname:%s,status:%d,CSbegintime:%d,CSendtime:%d",
              (char*)CSusername.arr,(char*)CSrealname.arr,(char*)CSimportname.arr,CSstatus,CSbegintime,CSendtime);


    int db_ret = 0;
    int iReconnTimes;
    bool bReconn;
    /* EXEC SQL ALLOCATE :cur_CSInfolist; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7757;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 



start:


    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.QureryCSInfo(:cur_CSInfolist,:CSusername,:CSimportname,:CSrealname,:CSstatus,:CSbegintime,:CSendtime,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . QureryCSInfo ( :cur_CSInfolist , :\
CSusername , :CSimportname , :CSrealname , :CSstatus , :CSbegintime , :CSendt\
ime , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7776;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&CSusername;
    sqlstm.sqhstl[1] = (unsigned long )123;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&CSimportname;
    sqlstm.sqhstl[2] = (unsigned long )123;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&CSrealname;
    sqlstm.sqhstl[3] = (unsigned long )123;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&CSstatus;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&CSbegintime;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&CSendtime;
    sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqhstv[7] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[7] = (         int  )0;
    sqlstm.sqindv[7] = (         short *)0;
    sqlstm.sqinds[7] = (         int  )0;
    sqlstm.sqharm[7] = (unsigned long )0;
    sqlstm.sqadto[7] = (unsigned short )0;
    sqlstm.sqtdso[7] = (unsigned short )0;
    sqlstm.sqhstv[8] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[8] = (unsigned long )34;
    sqlstm.sqhsts[8] = (         int  )0;
    sqlstm.sqindv[8] = (         short *)0;
    sqlstm.sqinds[8] = (         int  )0;
    sqlstm.sqharm[8] = (unsigned long )0;
    sqlstm.sqadto[8] = (unsigned short )0;
    sqlstm.sqtdso[8] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_CSInfolist; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7827;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("QureryCSInfo",CLog::TYPE_IMPORTANT,"CSusername:%s,db_ret:%d, retcode:%d", CSusername.arr,db_ret, retcode);

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_CSInfolist; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7846;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE :cur_CSInfolist; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7865;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }


    for(;;)
    {

        /* EXEC SQL FETCH :cur_CSInfolist INTO :CSusername,:CSpermission,:CSimportname,:CSimporttime,:CSrealname,:CSstatus,:CSreceptionlimit; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )7884;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&CSusername;
        sqlstm.sqhstl[1] = (unsigned long )123;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&CSpermission;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&CSimportname;
        sqlstm.sqhstl[3] = (unsigned long )123;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&CSimporttime;
        sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqhstv[5] = (unsigned char  *)&CSrealname;
        sqlstm.sqhstl[5] = (unsigned long )123;
        sqlstm.sqhsts[5] = (         int  )0;
        sqlstm.sqindv[5] = (         short *)0;
        sqlstm.sqinds[5] = (         int  )0;
        sqlstm.sqharm[5] = (unsigned long )0;
        sqlstm.sqadto[5] = (unsigned short )0;
        sqlstm.sqtdso[5] = (unsigned short )0;
        sqlstm.sqhstv[6] = (unsigned char  *)&CSstatus;
        sqlstm.sqhstl[6] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[6] = (         int  )0;
        sqlstm.sqindv[6] = (         short *)0;
        sqlstm.sqinds[6] = (         int  )0;
        sqlstm.sqharm[6] = (unsigned long )0;
        sqlstm.sqadto[6] = (unsigned short )0;
        sqlstm.sqtdso[6] = (unsigned short )0;
        sqlstm.sqhstv[7] = (unsigned char  *)&CSreceptionlimit;
        sqlstm.sqhstl[7] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[7] = (         int  )0;
        sqlstm.sqindv[7] = (         short *)0;
        sqlstm.sqinds[7] = (         int  )0;
        sqlstm.sqharm[7] = (unsigned long )0;
        sqlstm.sqadto[7] = (unsigned short )0;
        sqlstm.sqtdso[7] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



        db_ret = sqlca.sqlcode;
        CLog::Log("QureryCSInfo",CLog::TYPE_IMPORTANT,"db_ret:%d", db_ret);
        if (db_ret == 1403 )
        {
            nRetCount = iNum;
            break;
        }
        if (iNum >= nRetCount)
        {
            CLog::Log("QureryCSInfo",CLog::TYPE_IMPORTANT,"iNum:%d",iNum);
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            nRetCount = iNum;
            CLog::Log("QureryCSInfo",CLog::TYPE_IMPORTANT,"db_ret:%d",db_ret);
            break;
        }

        SET_END_NULL(CSusername);
        SET_END_NULL(CSrealname);
        SET_END_NULL(CSimportname);

        if (CSusername.len > 0)
            strncpy(CSInfoList[iNum].username,(const char *)(CSusername.arr),MAX_USERNAME_LEN);
        CSInfoList[iNum].permission = CSpermission;
        if (CSimportname.len > 0)
            strncpy(CSInfoList[iNum].importname,(const char *)(CSimportname.arr),MAX_USERNAME_LEN);

        CSInfoList[iNum].importtime = CSimporttime;
        if (CSrealname.len > 0)
            strncpy(CSInfoList[iNum].realname,(const char *)(CSrealname.arr),MAX_USERNAME_LEN);

        CSInfoList[iNum].status = CSstatus;
        CSInfoList[iNum].receptionlimit = CSreceptionlimit;


        CLog::Log("QureryCSInfo",CLog::TYPE_IMPORTANT,"iNum:%d,username:%s,permission:%d,importname:%s,importtime:%d,realname:%s,status:%d,receptionlimit:%d",
                  iNum, CSInfoList[iNum].username,CSInfoList[iNum].permission,CSInfoList[iNum].importname,CSInfoList[iNum].importtime,CSInfoList[iNum].realname,CSInfoList[iNum].status,CSInfoList[iNum].receptionlimit);
        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_CSInfolist; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7931;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_CSInfolist; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7950;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_CSInfolist;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::CS_Get_Group_Account(uint32 groupId,vector<uint32> &userlist )
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int nGroupId;
        unsigned int n_UserNode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int retcode;
        SQL_CURSOR cur_cliInfo;
    /* EXEC SQL END DECLARE SECTION; */ 



    nGroupId=groupId;


    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7969;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.GetCSGroupMemFlow(:nGroupId,:cur_cliInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . GetCSGroupMemFlow ( :nGroupId , :c\
ur_cliInfo , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )7988;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nGroupId;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8019;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("CS_Get_Group_Account",CLog::TYPE_DEBUG,"id:%d, db_ret:%d, retcode:%d ",nGroupId, db_ret, retcode);

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8038;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8057;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {
        /* EXEC SQL FETCH :cur_cliInfo INTO :n_UserNode; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8076;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&n_UserNode;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            break;
        }
        // userlist[iNum] = n_UserNode;
        userlist.push_back(n_UserNode);
        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8099;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8118;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::CS_Get_Groups(uint32 userid,vector<uint32> &groups )
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int nUserId;
        unsigned int n_GroupNode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int retcode;
        SQL_CURSOR cur_cliInfo;
    /* EXEC SQL END DECLARE SECTION; */ 



    nUserId=userid;


    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8137;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.GetCSGroups(:nUserId,:cur_cliInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . GetCSGroups ( :nUserId , :cur_cliI\
nfo , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8156;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nUserId;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8187;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("CS_Get_Groups",CLog::TYPE_DEBUG,"id:%d, db_ret:%d, retcode:%d ",nUserId, db_ret, retcode);

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8206;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8225;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {
        /* EXEC SQL FETCH :cur_cliInfo INTO :n_GroupNode; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8244;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&n_GroupNode;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            break;
        }
        // userlist[iNum] = n_UserNode;
        groups.push_back(n_GroupNode);
        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8267;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8286;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}


int CDatabaseMini::CS_Get_RecptionLimit(uint32 iUserID,uint32 &RecpLimit)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int      n_iUserID,n_RecpLimit;
        int  retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    n_iUserID=iUserID;
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);
    int db_ret;
    int iReconnTimes;
    bool bReconn;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.GetCSRecpLimit(:n_iUserID,:n_RecpLimit,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . GetCSRecpLimit ( :n_iUserID , :n_R\
ecpLimit , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8305;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&n_iUserID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&n_RecpLimit;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("CS_Get_RecptionLimit",CLog::TYPE_DEBUG,"id:%d, db_ret:%d, retcode:%d ",iUserID, db_ret, retcode);

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    if (retcode == 1)
        return DB_ERROR;

    RecpLimit = n_RecpLimit;
    return DB_SUCCESS;
}


int CDatabaseMini::CS_Get_Group_Friend(uint32 iUserID,vector<csTeam_t>&teamInfo)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int niUserID;
        unsigned int nFriendId,nTeamId;
        int nPermission;
        int retcode;
        SQL_CURSOR cur_cliInfo;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    csTeam_t csTeamInfo;
    niUserID=iUserID;

    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8336;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.GetCSFriend(:niUserID,:cur_cliInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . GetCSFriend ( :niUserID , :cur_cli\
Info , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8355;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&niUserID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8386;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("CS_Get_Group_Friend",CLog::TYPE_DEBUG,"id:%d, db_ret:%d, retcode:%d ",iUserID, db_ret, retcode);

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8405;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_cliInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8424;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    for(;;)
    {
        /* EXEC SQL FETCH :cur_cliInfo INTO :nFriendId,:nTeamId,:nPermission; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8443;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&nFriendId;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&nTeamId;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&nPermission;
        sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            break;
        }

        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            break;
        }
        memset(&csTeamInfo,0,sizeof(csTeam_t));
        csTeamInfo.teamid = nTeamId;
        csTeamInfo.userid = nFriendId;
        csTeamInfo.team_permission = nPermission;
        teamInfo.push_back(csTeamInfo);
        // teamInfo[iNum].teamid = nTeamId;
        // teamInfo[iNum].userid = nFriendId;

        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8474;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_cliInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8493;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_cliInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::Get_CS_Info(uint32 iUserID, XT_SERVER_CS_GET_ACK &lpAck)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int nUserID;
        /* VARCHAR  var_username[121]; */ 
struct { unsigned short len; unsigned char arr[121]; } var_username;

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        int var_state,var_maxRecConsult,var_permission;
        int retcode;


    /* EXEC SQL END DECLARE SECTION; */ 

    SET_INIT_NULL(var_username);

    var_state = 0;
    var_maxRecConsult = 0;
    var_permission = 0;
    retcode = 0;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    nUserID = iUserID;
    int db_ret;
    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 

    int iReconnTimes;
    bool bReconn;

start:
    /* EXEC SQL AT :db_link_name EXECUTE
       begin
        Mini_User_Pkg.GetCSInfo(:nUserID,:var_username,:var_state,:var_maxRecConsult,:var_permission,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . GetCSInfo ( :nUserID , :var_userna\
me , :var_state , :var_maxRecConsult , :var_permission , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8512;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&nUserID;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&var_username;
    sqlstm.sqhstl[1] = (unsigned long )123;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&var_state;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&var_maxRecConsult;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&var_permission;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[5] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqhstv[6] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[6] = (unsigned long )34;
    sqlstm.sqhsts[6] = (         int  )0;
    sqlstm.sqindv[6] = (         short *)0;
    sqlstm.sqinds[6] = (         int  )0;
    sqlstm.sqharm[6] = (unsigned long )0;
    sqlstm.sqadto[6] = (unsigned short )0;
    sqlstm.sqtdso[6] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    SET_END_NULL(var_username);

    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    CLog::Log("CDatabaseWeb::Get_CS_Info", CLog::TYPE_IMPORTANT, "id:%d, db_ret:%d, retcode:%d",nUserID, db_ret, retcode);

    if (db_ret == 1403 || retcode == 1403)
    {
        return DB_NOUSER;
    }

    if( db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }

    lpAck.m_nID     = nUserID;  // 0 用户id
    strncpy(lpAck.m_CSname, (char*)var_username.arr,MAX_USERNAME_LEN) ; // 3 用户名

    lpAck.m_State   = var_state;
    lpAck.m_MaxRecConsult   = var_maxRecConsult;
    lpAck.m_permission = var_permission;

    return DB_SUCCESS;
}


int CDatabaseMini::WebLastMsgReq(XT_WEB_BUSI_LAST_MSG_REQ* msgReq,XT_WEB_BUSI_LAST_MSG_ACK::BusiLastList * msgInfo,uint32& nRetCount)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32],var_nickName[41]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

struct { unsigned short len; unsigned char arr[41]; } var_nickName;

        /* VARCHAR var_lastMsg[1315]; */ 
struct { unsigned short len; unsigned char arr[1315]; } var_lastMsg;

        unsigned int sid,msgnum,subAccountID,lastMsgTime;
        int retcode;
        SQL_CURSOR cur_msgInfo;
    /* EXEC SQL END DECLARE SECTION; */ 



    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    sid=msgReq->id;
    msgnum=msgReq->msgnum;

    SET_INIT_NULL(var_nickName);
    SET_INIT_NULL(var_lastMsg);

    int db_ret, iReconnTimes;
    uint32 iNum = 0;
    bool bReconn;

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL ALLOCATE :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8555;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.WebLastMsgReq(:sid,:msgnum,:cur_msgInfo,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . WebLastMsgReq ( :sid , :msgnum , :\
cur_msgInfo , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8574;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&sid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&msgnum;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[4] = (unsigned long )34;
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8609;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }

    if(db_ret < 0 && db_ret != -1405)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8628;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL FREE  :cur_msgInfo; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8647;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }


    for(;;)
    {
        /* EXEC SQL FETCH :cur_msgInfo INTO :subAccountID,:lastMsgTime,:var_nickName,:var_lastMsg; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8666;
        sqlstm.selerr = (unsigned short)1;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqfoff = (         int )0;
        sqlstm.sqfmod = (unsigned int )2;
        sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&subAccountID;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&lastMsgTime;
        sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqhstv[3] = (unsigned char  *)&var_nickName;
        sqlstm.sqhstl[3] = (unsigned long )43;
        sqlstm.sqhsts[3] = (         int  )0;
        sqlstm.sqindv[3] = (         short *)0;
        sqlstm.sqinds[3] = (         int  )0;
        sqlstm.sqharm[3] = (unsigned long )0;
        sqlstm.sqadto[3] = (unsigned short )0;
        sqlstm.sqtdso[3] = (unsigned short )0;
        sqlstm.sqhstv[4] = (unsigned char  *)&var_lastMsg;
        sqlstm.sqhstl[4] = (unsigned long )1317;
        sqlstm.sqhsts[4] = (         int  )0;
        sqlstm.sqindv[4] = (         short *)0;
        sqlstm.sqinds[4] = (         int  )0;
        sqlstm.sqharm[4] = (unsigned long )0;
        sqlstm.sqadto[4] = (unsigned short )0;
        sqlstm.sqtdso[4] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if (db_ret == 1403 )
        {
            nRetCount = iNum;
            break;
        }
        if (iNum >= nRetCount)
        {
            break;
        }
        if( db_ret < 0 && db_ret != -1405 )
        {
            sql_error(sqlca, oraca);
            nRetCount = iNum;
            break;
        }
        msgInfo[iNum].subAccountID = subAccountID;
        msgInfo[iNum].lastMsgTime = lastMsgTime;

        SET_END_NULL(var_lastMsg);
        SET_END_NULL(var_nickName);

        strncpy(msgInfo[iNum].nickname,(char*)var_nickName.arr,MAX_NICKNAME_LEN+1);
        strncpy(msgInfo[iNum].lastMsg,(char*)var_lastMsg.arr,1315);

        ++iNum;
    }
    /* EXEC SQL CLOSE :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8701;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL FREE  :cur_msgInfo; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8720;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&cur_msgInfo;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    return DB_SUCCESS;
}

int CDatabaseMini::Get_Userid_Map_CSid(uint32 userid,uint32 &csid)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        unsigned int iuserid,icsid;
        int retcode;
        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

    /* EXEC SQL END DECLARE SECTION; */ 


    iuserid=userid;

    int db_ret, iReconnTimes;
    bool bReconn;

    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen((char*)db_link_name.arr);

    /* EXEC SQL CONTEXT USE :m_ctx[m_nMyContextid]; */ 


start:
    /* EXEC SQL AT :db_link_name EXECUTE
    begin
      Mini_User_Pkg.getUseridMapCSid(:iuserid,:icsid,:retcode);
    end;
    END-EXEC; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "begin Mini_User_Pkg . getUseridMapCSid ( :iuserid , :ics\
id , :retcode ) ; end ;";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8739;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&iuserid;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&icsid;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&retcode;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[3] = (unsigned long )34;
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    db_ret = sqlca.sqlcode;
    if (conn_error(db_ret))
    {
        iReconnTimes=0;
        bReconn=ConnectDB();
        while(!bReconn)
        {
            iReconnTimes++;
            sleep(iReconnTimes%10);
            bReconn=ConnectDB();
        }
        goto start;
    }
    CLog::Log("Get_Userid_Map_CSid",CLog::TYPE_DEBUG,"userid:%d, csid:%d, db_ret:%d, retcode:%d ",iuserid, icsid, db_ret, retcode);

    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        return DB_ERROR;
    }
    if (retcode == 1)
        return DB_ERROR;

    csid = icsid;
    return DB_SUCCESS;
}

// 插入一条消息推送数据
int CDatabaseMini::InsertMsgNotify(const char *pUuid, const std::vector<uint32> &vecUserID, const string &buffer, int nBufferType)
{
    DEF_ORASET;
    /* EXEC SQL BEGIN DECLARE SECTION; */ 

        /* VARCHAR db_link_name[32]; */ 
struct { unsigned short len; unsigned char arr[32]; } db_link_name;

        /* VARCHAR uuid[30]; */ 
struct { unsigned short len; unsigned char arr[30]; } uuid;

        OCIBlobLocator *blob_buffer;
        int NewCharbufLen;
        int ClobLen, WriteAmt, Offset;
        unsigned char NewCharbuf[5000];
        /* EXEC SQL VAR NewCharbuf IS RAW(5000) ; */ 

    /* EXEC SQL END DECLARE SECTION; */ 


	
    strncpy((char*)db_link_name.arr, m_Connect,32);
    db_link_name.len = (short)strlen(m_Connect);

    SET_INIT_NULL(uuid);
    strncpy((char*)uuid.arr, pUuid, strlen(pUuid));
    uuid.len = (short)strlen(pUuid);

    int db_ret;

    /* EXEC SQL AT :db_link_name ALLOCATE :blob_buffer; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8770;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    // 写入表IM_MSGNOTIFY
    // 先插入空的blob
    /* EXEC SQL AT :db_link_name INSERT INTO IM_MSGNOTIFY(UUID,BUF) VALUES (:uuid, :uuid/oempty_clob()o/); */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "insert into IM_MSGNOTIFY (UUID,BUF) values (:b1,:b1)";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8793;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&uuid;
    sqlstm.sqhstl[0] = (unsigned long )32;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&uuid;
    sqlstm.sqhstl[1] = (unsigned long )32;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob_buffer; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8820;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8843;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }


	/* EXEC SQL AT :db_link_name COMMIT; */ 

{
 struct sqlexd sqlstm;
 sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
 sqlstm.sqlvsn = 12;
 sqlstm.arrsiz = 15;
 sqlstm.sqladtp = &sqladt;
 sqlstm.sqltdsp = &sqltds;
 sqlstm.iters = (unsigned int  )1;
 sqlstm.offset = (unsigned int  )8862;
 sqlstm.cud = sqlcud0;
 sqlstm.sqlest = (unsigned char  *)&sqlca;
 sqlstm.sqlety = (unsigned short)4352;
 sqlstm.occurs = (unsigned int  )0;
 sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
 sqlstm.sqhstl[0] = (unsigned long )34;
 sqlstm.sqhsts[0] = (         int  )0;
 sqlstm.sqindv[0] = (         short *)0;
 sqlstm.sqinds[0] = (         int  )0;
 sqlstm.sqharm[0] = (unsigned long )0;
 sqlstm.sqadto[0] = (unsigned short )0;
 sqlstm.sqtdso[0] = (unsigned short )0;
 sqlstm.sqphsv = sqlstm.sqhstv;
 sqlstm.sqphsl = sqlstm.sqhstl;
 sqlstm.sqphss = sqlstm.sqhsts;
 sqlstm.sqpind = sqlstm.sqindv;
 sqlstm.sqpins = sqlstm.sqinds;
 sqlstm.sqparm = sqlstm.sqharm;
 sqlstm.sqparc = sqlstm.sqharc;
 sqlstm.sqpadto = sqlstm.sqadto;
 sqlstm.sqptdso = sqlstm.sqtdso;
 sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name FREE :blob_buffer; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8881;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    return DB_SUCCESS;

    
    // 再写入blob
    /* EXEC SQL AT :db_link_name SELECT BUF INTO :blob_buffer FROM IM_MSGNOTIFY WHERE UUID = :uuid FOR UPDATE; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "select BUF into :b1  from IM_MSGNOTIFY where UUID=:b2 fo\
r update ";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8904;
    sqlstm.selerr = (unsigned short)1;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&uuid;
    sqlstm.sqhstl[1] = (unsigned long )32;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob_buffer; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8931;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )8954;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return DB_ERROR;
    }

    NewCharbufLen = buffer.length();
    memcpy(NewCharbuf, buffer.c_str(), NewCharbufLen);

    /* EXEC SQL AT :db_link_name LOB DESCRIBE :blob_buffer GET LENGTH INTO :ClobLen; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )8973;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&ClobLen;
    sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[2] = (unsigned long )34;
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob_buffer; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )9000;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )9023;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return db_ret;
    }

    WriteAmt = NewCharbufLen;
    Offset = ClobLen + 1;

    /* EXEC SQL AT :db_link_name LOB WRITE ONE :WriteAmt FROM :NewCharbuf
      WITH LENGTH :NewCharbufLen INTO :blob_buffer AT :Offset; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )9042;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&WriteAmt;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)NewCharbuf;
    sqlstm.sqhstl[1] = (unsigned long )5000;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqhstv[2] = (unsigned char  *)&NewCharbufLen;
    sqlstm.sqhstl[2] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[2] = (         int  )0;
    sqlstm.sqindv[2] = (         short *)0;
    sqlstm.sqinds[2] = (         int  )0;
    sqlstm.sqharm[2] = (unsigned long )0;
    sqlstm.sqadto[2] = (unsigned short )0;
    sqlstm.sqtdso[2] = (unsigned short )0;
    sqlstm.sqhstv[3] = (unsigned char  *)&blob_buffer;
    sqlstm.sqhstl[3] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[3] = (         int  )0;
    sqlstm.sqindv[3] = (         short *)0;
    sqlstm.sqinds[3] = (         int  )0;
    sqlstm.sqharm[3] = (unsigned long )0;
    sqlstm.sqadto[3] = (unsigned short )0;
    sqlstm.sqtdso[3] = (unsigned short )0;
    sqlstm.sqhstv[4] = (unsigned char  *)&Offset;
    sqlstm.sqhstl[4] = (unsigned long )sizeof(int);
    sqlstm.sqhsts[4] = (         int  )0;
    sqlstm.sqindv[4] = (         short *)0;
    sqlstm.sqinds[4] = (         int  )0;
    sqlstm.sqharm[4] = (unsigned long )0;
    sqlstm.sqadto[4] = (unsigned short )0;
    sqlstm.sqtdso[4] = (unsigned short )0;
    sqlstm.sqhstv[5] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[5] = (unsigned long )34;
    sqlstm.sqhsts[5] = (         int  )0;
    sqlstm.sqindv[5] = (         short *)0;
    sqlstm.sqinds[5] = (         int  )0;
    sqlstm.sqharm[5] = (unsigned long )0;
    sqlstm.sqadto[5] = (unsigned short )0;
    sqlstm.sqtdso[5] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    db_ret = sqlca.sqlcode;
    if(db_ret == 1403 || db_ret < 0)
    {
        sql_error(sqlca, oraca);
        /* EXEC SQL AT :db_link_name FREE :blob_buffer; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )9081;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
        sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[1] = (unsigned long )34;
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )9104;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[0] = (unsigned long )34;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        return db_ret;
    }

    // 写入表IM_USER_WITH_MSGNOTIFY
    for(int i = 0; i < (int)vecUserID.size(); ++i)
    {
        int userid = (int)vecUserID[i];
        /* EXEC SQL AT :db_link_name INSERT INTO IM_USER_WITH_MSGNOTIFY VALUES (:uuid, :userid); */ 

{
        struct sqlexd sqlstm;
        sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
        sqlstm.sqlvsn = 12;
        sqlstm.arrsiz = 15;
        sqlstm.sqladtp = &sqladt;
        sqlstm.sqltdsp = &sqltds;
        sqlstm.stmt = "insert into IM_USER_WITH_MSGNOTIFY  values (:b1,:b2)";
        sqlstm.iters = (unsigned int  )1;
        sqlstm.offset = (unsigned int  )9123;
        sqlstm.cud = sqlcud0;
        sqlstm.sqlest = (unsigned char  *)&sqlca;
        sqlstm.sqlety = (unsigned short)4352;
        sqlstm.occurs = (unsigned int  )0;
        sqlstm.sqhstv[0] = (unsigned char  *)&uuid;
        sqlstm.sqhstl[0] = (unsigned long )32;
        sqlstm.sqhsts[0] = (         int  )0;
        sqlstm.sqindv[0] = (         short *)0;
        sqlstm.sqinds[0] = (         int  )0;
        sqlstm.sqharm[0] = (unsigned long )0;
        sqlstm.sqadto[0] = (unsigned short )0;
        sqlstm.sqtdso[0] = (unsigned short )0;
        sqlstm.sqhstv[1] = (unsigned char  *)&userid;
        sqlstm.sqhstl[1] = (unsigned long )sizeof(int);
        sqlstm.sqhsts[1] = (         int  )0;
        sqlstm.sqindv[1] = (         short *)0;
        sqlstm.sqinds[1] = (         int  )0;
        sqlstm.sqharm[1] = (unsigned long )0;
        sqlstm.sqadto[1] = (unsigned short )0;
        sqlstm.sqtdso[1] = (unsigned short )0;
        sqlstm.sqhstv[2] = (unsigned char  *)&db_link_name;
        sqlstm.sqhstl[2] = (unsigned long )34;
        sqlstm.sqhsts[2] = (         int  )0;
        sqlstm.sqindv[2] = (         short *)0;
        sqlstm.sqinds[2] = (         int  )0;
        sqlstm.sqharm[2] = (unsigned long )0;
        sqlstm.sqadto[2] = (unsigned short )0;
        sqlstm.sqtdso[2] = (unsigned short )0;
        sqlstm.sqphsv = sqlstm.sqhstv;
        sqlstm.sqphsl = sqlstm.sqhstl;
        sqlstm.sqphss = sqlstm.sqhsts;
        sqlstm.sqpind = sqlstm.sqindv;
        sqlstm.sqpins = sqlstm.sqinds;
        sqlstm.sqparm = sqlstm.sqharm;
        sqlstm.sqparc = sqlstm.sqharc;
        sqlstm.sqpadto = sqlstm.sqadto;
        sqlstm.sqptdso = sqlstm.sqtdso;
        sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


        db_ret = sqlca.sqlcode;
        if(db_ret == 1403 || db_ret < 0)
        {
            sql_error(sqlca, oraca);
            /* EXEC SQL AT :db_link_name FREE :blob_buffer; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.stmt = "";
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )9150;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
            sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[1] = (unsigned long )34;
            sqlstm.sqhsts[1] = (         int  )0;
            sqlstm.sqindv[1] = (         short *)0;
            sqlstm.sqinds[1] = (         int  )0;
            sqlstm.sqharm[1] = (unsigned long )0;
            sqlstm.sqadto[1] = (unsigned short )0;
            sqlstm.sqtdso[1] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            /* EXEC SQL AT :db_link_name ROLLBACK; */ 

{
            struct sqlexd sqlstm;
            sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
            sqlstm.sqlvsn = 12;
            sqlstm.arrsiz = 15;
            sqlstm.sqladtp = &sqladt;
            sqlstm.sqltdsp = &sqltds;
            sqlstm.iters = (unsigned int  )1;
            sqlstm.offset = (unsigned int  )9173;
            sqlstm.cud = sqlcud0;
            sqlstm.sqlest = (unsigned char  *)&sqlca;
            sqlstm.sqlety = (unsigned short)4352;
            sqlstm.occurs = (unsigned int  )0;
            sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
            sqlstm.sqhstl[0] = (unsigned long )34;
            sqlstm.sqhsts[0] = (         int  )0;
            sqlstm.sqindv[0] = (         short *)0;
            sqlstm.sqinds[0] = (         int  )0;
            sqlstm.sqharm[0] = (unsigned long )0;
            sqlstm.sqadto[0] = (unsigned short )0;
            sqlstm.sqtdso[0] = (unsigned short )0;
            sqlstm.sqphsv = sqlstm.sqhstv;
            sqlstm.sqphsl = sqlstm.sqhstl;
            sqlstm.sqphss = sqlstm.sqhsts;
            sqlstm.sqpind = sqlstm.sqindv;
            sqlstm.sqpins = sqlstm.sqinds;
            sqlstm.sqparm = sqlstm.sqharm;
            sqlstm.sqparc = sqlstm.sqharc;
            sqlstm.sqpadto = sqlstm.sqadto;
            sqlstm.sqptdso = sqlstm.sqtdso;
            sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


            return db_ret;
        }
    }

    /* EXEC SQL AT :db_link_name COMMIT; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )9192;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[0] = (unsigned long )34;
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}


    /* EXEC SQL AT :db_link_name FREE :blob_buffer; */ 

{
    struct sqlexd sqlstm;
    sqlorat(&m_ctx[m_nMyContextid], &sqlctx, &oraca);
    sqlstm.sqlvsn = 12;
    sqlstm.arrsiz = 15;
    sqlstm.sqladtp = &sqladt;
    sqlstm.sqltdsp = &sqltds;
    sqlstm.stmt = "";
    sqlstm.iters = (unsigned int  )1;
    sqlstm.offset = (unsigned int  )9211;
    sqlstm.cud = sqlcud0;
    sqlstm.sqlest = (unsigned char  *)&sqlca;
    sqlstm.sqlety = (unsigned short)4352;
    sqlstm.occurs = (unsigned int  )0;
    sqlstm.sqhstv[0] = (unsigned char  *)&blob_buffer;
    sqlstm.sqhstl[0] = (unsigned long )sizeof(void *);
    sqlstm.sqhsts[0] = (         int  )0;
    sqlstm.sqindv[0] = (         short *)0;
    sqlstm.sqinds[0] = (         int  )0;
    sqlstm.sqharm[0] = (unsigned long )0;
    sqlstm.sqadto[0] = (unsigned short )0;
    sqlstm.sqtdso[0] = (unsigned short )0;
    sqlstm.sqhstv[1] = (unsigned char  *)&db_link_name;
    sqlstm.sqhstl[1] = (unsigned long )34;
    sqlstm.sqhsts[1] = (         int  )0;
    sqlstm.sqindv[1] = (         short *)0;
    sqlstm.sqinds[1] = (         int  )0;
    sqlstm.sqharm[1] = (unsigned long )0;
    sqlstm.sqadto[1] = (unsigned short )0;
    sqlstm.sqtdso[1] = (unsigned short )0;
    sqlstm.sqphsv = sqlstm.sqhstv;
    sqlstm.sqphsl = sqlstm.sqhstl;
    sqlstm.sqphss = sqlstm.sqhsts;
    sqlstm.sqpind = sqlstm.sqindv;
    sqlstm.sqpins = sqlstm.sqinds;
    sqlstm.sqparm = sqlstm.sqharm;
    sqlstm.sqparc = sqlstm.sqharc;
    sqlstm.sqpadto = sqlstm.sqadto;
    sqlstm.sqptdso = sqlstm.sqtdso;
    sqlcxt(&m_ctx[m_nMyContextid], &sqlctx, &sqlstm, &sqlfpn);
}



    return DB_SUCCESS;
}
